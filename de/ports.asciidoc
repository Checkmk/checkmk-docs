// -*- coding: utf-8 -*-
include::global_attr.adoc[]
= Von {CMK} genutzte Ports
:revdate: draft
:title: Von {CMK} genutzte Ports
:description: {CMK} nutzt für die Kommunikation einige Ports, diesen müssen freigegeben sein.

{related-start}
xref:install_packages#[Grundsätzliches zur Installation von {CMK}]
xref:wato#[Die Konfiguration von {CMK}]
xref:wato_monitoringagents#[Monitoring-Agenten]
{related-end}


== Übersicht der wesentlichen Ports

Damit {CMK} die konfigurierten Hosts und Services überwachen kann, ist unter anderem der reibungsfreie Zugriff auf einige Ports nötig.
Diese müssen gegebenenfalls in der Firewall freigegeben werden.
Es sind jedoch nicht immer alle Ports notwendig.
Abhängig von der Konfiguration können einige davon entfallen.

Neben der Hilfe bei der Firewallkonfiguration soll diese Liste einen Überblick verschaffen, welche Ports beim Einsatz von {CMK} in Container-Umgebungen an den Port des jeweiligen Containers gebunden werden müssen.

== Ports im regulären Monitoring

[#host_incoming_cmk_outgoing]
=== Eingehende Ports auf dem überwachten Host (erreichbar durch {CMK}-Server)

Die folgenden Ports auf überwachten Hosts müssen vom {CMK}-Server oder den für einen Host im Monitoring zuständigen Remote-Instanzen aus erreichbar sein.

[cols="10,10,~,~",options="header"]
|===
|Port |Protokoll |Bezeichnung |ergänzende Informationen
|161 |UDP |xref:glossar#snmp[Simple Network Management Protocol (SNMP)]|Via SNMP überwachte Hosts erhalten über diesen Port die Anforderung `GET-REQUEST`
|6556 |TCP |xref:glossar#agent[Agent] |Via {CMK}-Agent überwachte Hosts werden über diesen Port abgefragt, die Kommunikation erfolgt im xref:agent_linux_legacy#[Klartext] oder xref:wato_monitoringagents#[TLS verschlüsselt]
| | |eventuell weitere Ports |z. B. für xref:glossar#active_check[aktive Checks] |
|===

Die Überwachung mit Spezialagenten kann erfordern, andere/weitere Ports zu öffnen.
So benötigt der  xref:datasource_programs#specialagents[Spezialagent] für VMware ESXi (auch NetApp und viele weitere) die Öffnung des Ports 443 auf dem ESXi Server.

[#cmk_incoming_host_outgoing]
=== Eingehende Ports auf dem {CMK}-Server (erreichbar durch überwachte Hosts)

Die folgenden Ports auf dem {CMK}-Server, beziehungsweise den Remote-Instanzen müssen für die Hosts im Monitoring erreichbar sein, wenn volle Funktionalität gewünscht ist.

[cols="10,10,~,~",options="header"]
|===
|Port |Protokoll |Bezeichnung |ergänzende Informationen
|80 |TCP |HTTP (Hypertext Transfer Protocol) |Agent Updater (xref:wato_monitoringagents#bakery[Agentenbäckerei])
|161 |UDP |xref:glossar#snmp[Simple Network Management Protocol (SNMP)]|Via SNMP überwachte Hosts senden an diesen Port die angeforderten Daten (`GET-RESPONSE`)
|162 |TCP |Simple Network Management Protocol Trap (SNMPTRAP) EC |Empfang von xref:ec#snmp[SNMP-Traps (Event Console)]
|443 |TCP |HTTPS (Hypertext Transfer Protocol over SSL/TLS) |Agent Updater (xref:wato_monitoringagents#bakery[Agentenbäckerei]), unverschlüsselte Alternative Port 80
|514 |TCP und UDP |xref:ec#syslogfacility[Syslog (EC)] |Empfang von Syslog-Nachrichten (Event Console)
|6559 |UDP | link:https://checkmk.com/werk/8350[Echtzeitprüfungen^] | Empfang von UDP-Paketen für die Echtzeitprüfungen einzelner Dienste (selten verwendet)
|8000 |TCP |Agent Controller TLS-Registrierung |Wenn mehrere Instanzen auf einem Host laufen, sind eventuell weitere Ports (8001, 8002…) nötig
|===

Die TLS-Registrierung von Agenten nutzt zudem das REST-API auf Port 80/443 zur Discovery des Registrierungs-Ports (meist TCP 8000).
Sind diese nicht erreichbar, kann der Port per xref:agent_linux#networkrequirements[Kommandozeilenoption] angegeben werden.

== Ports im verteilten Monitoring

[#remote_incoming_cmk_outgoing]
=== Eingehende Ports auf Remote-Instanzen (erreichbar durch den {CMK}-Server)

Die folgenden Ports auf Remote-Instanzen müssen durch den als Zentralinstanz arbeitenden {CMK}-Server erreichbar sein.

[cols="10,10,~,~",options="header"]
|===
|Port |Protokoll|Bezeichnung |ergänzende Informationen
|80 |TCP |HTTPS (Hypertext Transfer Protocol) |Synchronisierung im xref:glossar#distributed_monitoring[verteilten Monitoring]
|443 |TCP |HTTPS (Hypertext Transfer Protocol over SSL/TLS) |Synchronisierung im verteilten Monitoring, unverschlüsselte Alternative Port 80
|6555 |TCP | Notification Spooler | Der xref:distributed_monitoring#notifications[Notification Spooler] dient dem zentralen Versand von Benachrichtigungen (Verbindungsaufbau durch Zentralinstanz)
|6557 |TCP |xref:livestatus#[Livestatus] |Wenn mehrere Instanzen auf einem Host laufen, sind eventuell weitere Ports nötig
|===

[#cmk_incoming_remote_outgoing]
=== Eingehende Ports auf dem {CMK}-Server (erreichbar durch Remote-Instanz)

Die folgenden Ports auf dem {CMK}-Server müssen durch die zugeordneten Remote-Instanzen erreichbar sein, wenn der volle Funktionsumfang des verteilten Monitorings genutzt werden soll.

[cols="10,10,~,~",options="header"]
|===
|Port |Protokoll |Bezeichnung |ergänzende Informationen
|80 |TCP |HTTP (Hypertext Transfer Protocol) |Für xref:wato_monitoringagents#bakery[Agentenbäckerei] und xref:dcd#[dynamische Host-Konfiguration]
|443 |TCP |HTTPS (Hypertext Transfer Protocol over SSL/TLS) |Für xref:wato_monitoringagents#bakery[Agentenbäckerei] und xref:dcd#[dynamische Host-Konfiguration], unverschlüsselte Alternative Port 80
|6555 |TCP | Notification Spooler | Der xref:distributed_monitoring#notifications[Notification Spooler] dient dem zentralen Versand von Benachrichtigungen (Verbindungsaufbau durch Remote-Instanzen)
|===

Prinzipiell ist verteiltes Monitoring ohne weitere Hilfsmittel wie Tunneling bereits möglich, wenn die Zentralinstanz eine Verbindung zu den Remote-Instanzen herstellen kann. Die Erreichbarkeit der Zentralinstanz durch Remote-Instanzen ist nur für optionale Funktionalität (z.B. Agent Bakery) erforderlich.

[#loopback]
== Lokale Ports auf dem {CMK}-Server

Die folgenden Ports werden vom {CMK}-Server (respektive den Remote-Instanzen) lokal genutzt.

[cols="10,10,~,~",options="header"]
|===
|Port |Protokoll |Bezeichnung |ergänzende Informationen
|5000 |TCP | HTTP Site Apache |Jede {CMK}-Site verfügt über einen eigenen Apache, auf den der extern aufrufbare Apache als Reverse Proxy zugreift, weitere Sites verwenden Port 5001 usw.
|6558 |TCP | |Statusanschluss der Event Console
|===

[#appliance_cluster]
== Am {CMK} Appliance Cluster benötigte Ports

// These two sentences are stolen from appliance_usage.asciidoc – 
// when translating you might copy and paste from there as well
Sie können zwei Checkmk-Appliances ("Knoten") zu einem xref:appliance_usage#_failover_cluster[Failover-Cluster] zusammenschließen.
Dabei werden alle Konfigurationen und Daten zwischen den beiden Geräten abgeglichen.

Die folgenden Ports müssen von beiden Knoten aus ein- und ausgehend freigegeben sein.

[cols="10,10,~,~",options="header"]
|===
|Port |Protokoll |Bezeichnung |ergänzende Informationen
|80 |TCP |HTTP (Hypertext Transfer Protocol) |für den Webconf-Zugang
|443 |TCP |HTTPS (Hypertext Transfer Protocol over SSL/TLS) |für den Webconf-Zugang, unverschlüsselte Alternative Port 80
|3121 |TCP |Pacemaker |für Pacemaker
|4321 |UDP |Corosync |für Corosync
|4323 |UDP |Corosync |für Corosync
|7789 |TCP |DRBD |für die DRBD Synchronisierung
|===

[#misc_ports]
== Weitere Ports

Eventuell benötigen Sie, vom {CMK}-Server ausgehend, einige weitere Ports:

* SMTP zur Versendung von Benachrichtigungen vom {CMK}-Server über Mail (je nach Konfiguration des Mailservers Port 25, 465 oder 587 TCP)
* NTP Zeitsynchronisation (Port 123 UDP)
* DNS (Port 53 UDP)
* LDAP Authentifizierung (LDAP (Port 389 TCP) oder LDAPS (Port 636 TCP))
