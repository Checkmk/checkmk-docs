// -*- coding: utf-8 -*-
include::global_attr.adoc[]

[#folder_network_scan]
== Netzwerk-Scan für Ordner durchführen

=== Prinzip

{CMK} bietet die Möglichkeit Ihr Netzwerk - oder auch nur Teile davon - automatisch und regelmäßig nach (neuen) Hosts zu durchsuchen.
Dieser Netzwerk-Scan wird auf Ebene der Ordner in der Host-Verwaltung von {CMK} eingerichtet.
Im Hintergrund läuft dafür minütlich ein Cronjob, um alle Ordner dahingehend zu prüfen, ob wieder ein entsprechender Scan ansteht.
Der Cronjob prüft dafür die beiden Einstellungen [.guihint]#Scan interval# und [.guihint]#Time allowed#.
Wenn das Intervall abgelaufen ist und der Server sich innerhalb der für den Scan erlaubten Zeitspanne befindet, wird der Scan gestartet.
//SK: Das stimmt nicht ganz, weil dann der Scan gestartet wird, der im Vergleich mit anderen anstehenden Scans am längsten wartet.
Sofern Sie die [.guihint]#Time allowed# nicht verändern, würde ein neu eingerichteter Netzwerk-Scan also innerhalb einer Minute nach dem Klick auf [.guihint]#Save# starten.

Sobald ein Scan startet passieren im Grunde drei Dinge:

. {CMK} ermittelt zuerst die IP-Adressen, die gescannt werden sollen. Zusätzlich zu den eingestellten Adressen und Adressbereichen, ist es wichtig zu wissen, dass niemals bereits bekannte Adressen gescannt werden.
. Die so ermittelten Adressen werden nun gepingt. Wenn es auf einer Adresse eine Antwort auf diesen Ping gibt, wird versucht einen Hostname zu ermitteln.
. Zuletzt werden die Hosts in dem Ordner erzeugt. Dabei werden alle Hosts mit Namen, die es bereits in Ihrer Site gibt, ausgelassen.


=== Netzwerk-Scan einrichten

Wie oben bereits angesprochen, wird der Netzwerk-Scan auf Ebene der Ordner eingerichtet.
Öffnen Sie zuerst [.guihint]#Setup > Hosts > Hosts#, navigieren Sie anschließend in einen beliebigen Ordner oder verbleiben Sie im Ordner [.guihint]#Main#.
Über das Menü [.guihint]#Folder > Properties# finden Sie den Kasten [.guihint]#Network Scan#.

image::wato_host_network_scan_new.png[alt="Deaktivierter Kasten _Network Scan_ in den Eigenschaften eines Ordners".]

Aktivieren Sie den Netzwerk-Scan über die entsprechende Checkbox.

image::wato_host_network_scan_activated.png[alt="Aktivierter aber unkonfigurieter Abschnitt _Network Scan_".]

Legen Sie anschließend bei [.guihint]#IP ranges to scan# die IP-Adressen fest, welche {CMK} für Sie automatisch überwachen soll.
Für diese Festlegung haben Sie die Wahl zwischen einzelnen IP-Adressen, IP-Bereichen und ganzen Netzwerken.
Wir empfehlen die Adressbereiche nicht zu groß zu wählen, da es ansonsten zu sehr langen Laufzeiten des Netzwerk-Scans kommen kann.
Bei der Wahl eines Netzwerks empfehlen wir die Netzmaske von /21 nicht zu unterschreiten, was 2048 IP-Adressen entspricht.
Die Anzahl von 2048 IP-Adressen sollten Sie auch bei Auswahl über [.guihint]#IP-Range# nicht überschreiten.
Dies kann natürlich nur eine grobe Empfehlung sein, da ihr (Firmen-)Netzwerk womöglich mit größeren Adressbereichen problemlos klarkommt.

Über die folgende Option [.guihint]#IP ranges to exclude# können Sie aus dem oberhalb konfigurierten Adressbereich Teile ausnehmen.
Die Option bietet sich auch an, um bereits bekannte und überwachte Hosts bzw. IP-Adressen aus dem Netzwerk-Scan auszuschließen.
So können Sie verhindern, dass Dubletten von Hosts angelegt werden.

Mit den folgenden beiden Optionen [.guihint]#Scan interval# und [.guihint]#Time allowed# können Sie festlegen, wie häufig der Scan laufen soll und zu welchen Zeit Sie dies erlauben möchten.

Mit die wichtigste Überlegung bei der Einrichtung des Netzwerk-Scans ist, wie Sie mit gefundenen Hosts umgehen wollen.
Hierbei fällt der Option [.guihint]#Set criticality host tag# eine zentrale Rolle zu:

* Standardmäßig ist [.guihint]#Do not monitor this host# ausgewählt.
Dies legt fest, dass die gefundenen Hosts erst einmal nur in die xref:wato_hosts#[Host-Verwaltung] aufgenommen werden.
Ein Monitoring findet so also erst einmal nicht statt.
Ein Ansatz könnte hier sein, die gefundenen Hosts _manuell_ in Ihre bestehende Host-Struktur zu überführen -- zum Beispiel mit Hilfe der Funktion [.guihint]#Move this host to another folder.#
Nach dem Verschieben, müssen Sie dann noch das Host-Merkmal [.guihint]#Criticality# anpassen oder entfernen.
Bei einer größeren Zahl von Hosts können Sie hierfür die Funktion [.guihint]#Remove explicit attribute settings# in [.guihint]#Setup > Hosts > Hosts# verwenden.

* Wählen Sie stattdessen hier als Host-Merkmal [.guihint]#Productive system# aus, werden die gefundenen Hosts - bei entsprechender Konfiguration mit dem Regelsatz xref:wato_services#discovery_auto[[.guihint]#Periodic service discovery#] - auch direkt ins Monitoring aufgenommen.

Beachten Sie vor Verwendung des Netzwerk-Scan auch die folgenden grundsätzlichen Überlegungen:

* Der Scan läuft über einen Ping ab.
Das bedeutet auch, dass Geräte, die nur über SNMP überwacht werden können, zwar womöglich gefunden werden, aber nicht automatisch überwacht werden, da die [.guihint]#SNMP credentials# nicht konfiguriert sind.
* Bei neuen Windows-Hosts ist ohne eine entsprechende Konfiguration durch z.B. Gruppenrichtlinien der sogenannte _Echo Request_ in der Firewall deaktiviert.
Solche Windows-Hosts werden dem Scan also nicht antworten und somit auch nicht gefunden.
* {CMK} kann Ihnen zu den gefundenen Hosts nur dann saubere Daten liefern, wenn Ihr Netzwerk und Ihre Site entsprechend konfiguriert ist.
Wiedersprüchliche Einträge im DNS und Ihrer Checkmk-Site können zu Dubletten führen, d.h., Sie werden womöglich Hosts über den Netzwerk-Scan finden, welche unter anderen Namen bereits durch {CMK} überwacht werden.
