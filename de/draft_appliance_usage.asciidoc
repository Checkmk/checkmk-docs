// -*- coding: utf-8 -*-
include::global_attr.adoc[]
= Appliance einrichten und nutzen
:revdate: draft
:title: Appliance einrichten und nutzen
:description: Anleitung zur Einrichtung der physischen und virtuellen {CMK} Appliances.

{related-start}
xref:appliance_usage[Appliance einrichten und nutzen] 
xref:appliance_rack_config[Besonderheiten der Appliance auf Racks]
xref:checkmk_getting_started[Schnelleinstieg ins Monitoring]
{related-end}

== Einführung
In diesem Artikel finden Sie alle Informationen rund um die Einrichtung und Nutzung sowohl der virtuellen als auch der physischen Appliance.
Zwei größere Themen werden in separaten Artikeln abgehandelt: xref:appliance_backup#[Backups] und xref:appliance_cluster#[Cluster.]
In einem weiteren Artikel gehen wir auf die xref:appliance_rack1_config#[Hardware-spezifischen Aspekte] der Racks ein.

Wir beginnen hier mit dem Erststart der Appliance -- die virtuelle Appliance muss also bereits xref:introduction_virt1#[installiert] beziehungsweise das Rack xref:appliance_rack1_config#[angeschlossen] sein.
Wenn Sie einfach möglichst zügig zu dem Punkt kommen wollen, an dem Sie sich ganz normal im Browser bei {CMK} anmelden können, greifen Sie am besten auf unsere Schnellstart-Anleitungen für das xref:appliance_rack1_quick_start#[Rack] beziehungsweise xref:appliance_virt1_quick_star#[virt1] zurück.


[#basic_config]
== Grundeinrichtung


[#init_start]
=== Initialisierung beim Erststart

Während des ersten Starts erscheint zunächst eine Meldung zur Auswahl der gewünschten Sprache:

image::cma_boot_preinit_language_2.png[]

Diese Sprache wird für das gesamte Gerät gespeichert.
Im Anschluss erscheint eine Meldung, die zur Intialisierung des Datenmediums (bei Racks des RAIDs) auffordert:

image::cma_boot_preinit_init_uservol_2.png[]

Bestätigen Sie diesen Dialog und warten Sie, bis der Prozess abgeschlossen ist.
An der lokalen Konsole wird anschließend die Statusansicht angezeigt:

image::cma_console_welcome_2.png[]

Diese Ansicht zeigt Ihnen allgemeine Statusinformationen und die wichtigsten Konfigurationsoptionen Ihres Geräts an.


[#network_access_config]
=== Netzwerk- und Zugriffskonfiguration via Konsole

Von der Statusansicht aus erreichen Sie das Konfigurationsmenü über die Taste `F1`:

image::cma_console_config_2.png[]

Für die Inbetriebnahme des Geräts müssen Sie nun die Netzwerkkonfiguration einstellen und das Gerätepasswort festlegen.

[#network_config]
[discrete]
==== Netzwerkkonfiguration

Über den Punkt [.guihint]#Network Configuration# richten Sie zunächst das Netzwerk ein. 
Dazu werden nacheinander die IP-Adresse, Netzmaske und das optionale Standard-Gateway abgefragt.

In den meisten Fällen soll das Gerät auch auf Netzwerkgeräte außerhalb des eigenen Netzwerksegments zugreifen können. 
Hierfür muss das Standard-Gateway ebenfalls konfiguriert werden.

Nach der Eingabe dieser Werte wird die Konfiguration aktiviert. 
Damit ist das Gerät sofort unter der angegebenen IP-Adresse über das Netzwerk erreichbar. 
Dies können Sie z.B. mit einem `ping` von einem anderen Gerät im Netzwerk testen.

[#network_access]
[discrete]
==== Web-Oberfläche aktivieren

Der Großteil der Konfiguration des Geräts wird über die Web-Oberfläche erledigt. 
Der Zugriff darauf ist durch das Gerätepasswort geschützt, das Sie zunächst festlegen müssen.
Im Auslieferungszustand ist kein solches Passwort gesetzt, also auch kein Zugriff auf die Web-Oberfläche möglich. 

Wählen Sie im Konfigurationsmenü [.guihint]#Device Password,# um das Gerätepasswort festzulegen. 
Das Passwort muss mindestens 8 Zeichen lang sein und mindestens einen Kleinbuchstaben, einen Großbuchstaben und eine Ziffer enthalten.

Anschließend wählen Sie aus dem Konfigurationsmenü die Option [.guihint]#Web Configuration,# um die Web-Oberfläche zu aktivieren.

Wenn Sie diese Schritte abgeschlossen haben, sehen Sie die veränderte Statusansicht der Konsole:

image::cma_console_welcome_basic_2.png[]

Im Kasten [.guihint]#Device Infos# steht die konfigurierte IP-Adresse und im Kasten [.guihint]#Access# steht [.guihint]#Web Configuration: on#.
Wenn Sie das Gerät bereits korrekt mit Ihrem Netzwerk verbunden haben, sehen Sie im Kasten [.guihint]#Status# auch, dass die Netzwerkverbindung aktiv ist: [.guihint]#LAN: UP#.

[discrete]
==== Zugriff auf die Konsole schützen

Beim Start der Appliance ist Ihnen vielleicht aufgefallen, dass es keine Passwortabfrage gab. 
Jeder mit physischem Zugriff auf das Rack oder die Management-Oberfläche der Virtualisierungslösung könnte die Grundeinstellungen über die Konsole ändern. 

Sie sollten daher den Passwortschutz im Konfigurationsmenü über den Menüpunkt [.guihint]#Console Login# aktivieren.
Bei eingeschaltetem Schutz wird das Gerätepasswort abgefragt, bevor die Statusansicht angezeigt wird und Einstellungen verändert werden können.

Anschließend sehen Sie in der Statusansicht im Kasten [.guihint]#Access# den Eintrag [.guihint]#Console Login: on#.

image::cma_console_welcome_console_login_2.png[]


[#basic_settings_webconf]
=== Grundeinstellungen in der Web-Oberfläche

Nachdem Sie durch die bisherige Konfiguration den Zugriff auf die Web-Oberfläche freigeschaltet haben, können Sie diese nun über einen beliebigen Rechner im Netzwerk öffnen.
Dazu geben Sie in die Adresszeile des Browsers die Appliance-URL ein, hier etwa `\http://192.168.178.60/`. 
Anschließend sehen Sie den Anmeldedialog der Web-Oberfläche:

image::cma_webconf_login_2.png[width=50%]

Nachdem Sie sich mit dem vorher festgelegten Gerätepasswort angemeldet haben, öffnet sich das Hauptmenü, aus dem Sie alle Funktionen der Web-Oberfläche erreichen können.

[{image-border}]
image::cma_webconf_index_2.png[]

Wählen Sie [.guihint]#Device Settings,# um die wichtigsten Einstellungen des Geräts einzusehen und bei Bedarf zu ändern:

image::cma_webconf_settings_2.png[]

Per Klick auf den Parameternamen gelangen Sie zur jeweiligen Seite zum Anpassen dieser Einstellung.

Sofern in Ihrer Umgebung vorhanden, sollten Sie nun zunächst einen oder mehrere DNS-Server konfigurieren, damit die Auflösung von Host-Namen genutzt werden kann. 
Wenn in Ihrer Umgebung ein oder mehrere NTP-Server für die Zeitsynchronisation zur Verfügung stehen, geben Sie diese über IP-Adressen oder Host-Namen unter [.guihint]#NTP Servers# ein.

Wenn von Ihrem Gerät aus E-Mails verschickt werden sollen, z.B. Benachrichtigungen bei Problemen, müssen Sie die Option [.guihint]#Outgoing Emails# konfigurieren. 
Dazu tragen Sie den für dieses Gerät zuständigen SMTP-Relay-Server und eventuell dafür benötigte Zugangsdaten ein. 
An diesen Server werden alle E-Mails geschickt, die auf dem Gerät erzeugt werden.
Sie können unter dieser Einstellung auch konfigurieren, dass alle E-Mails, die vom Betriebssystem des Geräts erzeugt werden, z.B. bei kritischen Fehlern, an eine separate E-Mail-Adresse geschickt werden sollen.

image::cma_webconf_settings_3.png[]

Damit ist die Grundkonfiguration des Geräts abgeschlossen.
Sie können mit der xref:manage_cmk[Installation der {CMK}-Software] und der xref:site_management[Einrichtung der ersten Monitoring-Instanz] fortfahren oder weitere Geräteeinstellungen vornehmen.

// ML: Früher Kapitel 5
[#cma_webconf_system_settings]
== Geräteeinstellungen
Alle folgenden Einstellungen finden Sie im Bereich [.guihint]#Device Settings.#

=== Sprache anpassen

Während der xref:appliance_usage[Grundkonfiguration] haben Sie die Sprache Ihres Geräts festgelegt.
Diese können Sie jederzeit sowohl über die Konfiguration der Konsole, als auch über die Geräteeinstellungen in der Web-Oberfläche anpassen.
Wie auch alle sonstigen Einstellungen in diesem Dialog, werden Änderungen durch das Speichern sofort wirksam.

=== Standard-Webseite ändern

Wenn Sie im Browser die URL der Appliance ohne weitere Pfadangaben aufrufen, gelangen Sie standardmäßig auf deren Startseite.
Über [.guihint]#HTTP access without URL brings you to# können Sie alternativ eine installierte Monitoring-Instanz auswählen, auf die umgeleitet werden soll.
Die Appliance-Startseite erreichen Sie dann über die URL samt Pfadangabe, also zum Beispiel `192.168.178.60/webconf`.

=== Host- und Domainnamen konfigurieren

Host- und Domainnamen dienen der Identifikation eines Computers im Netzwerk.
Diese Namen werden beispielsweise beim Versenden von E-Mails zum Bilden der Absenderadresse genutzt.
Außerdem werden alle Logeinträge, die an einen Syslog-Server gesendet werden, mit den konfigurierten Hostnamen als Quellhost ergänzt, um die Einträge leichter zuordnen zu können.


=== Namensauflösung konfigurieren

Häufig werden auch zum Monitoring statt IP-Adressen die Hostnamen oder FQDNs (Fully Qualified Domain Names) genutzt.
In den meisten Umgebungen werden DNS-Server zum Übersetzen von IP-Adressen zu Hostnamen und umgekehrt eingesetzt.

Um die Namensauflösung auf Ihrem Gerät nutzen zu können, müssen Sie die IP-Adressen mindestens eines DNS-Servers Ihrer Umgebung konfigurieren.
Wir empfehlen, mindestens zwei DNS-Server einzutragen.

Nur wenn Sie diese Option konfiguriert haben, können Sie z.B. bei der Konfiguration der NTP- oder Mailserver Host- und Domainnamen verwenden.

=== Zeitsynchronisation konfigurieren

Die Systemzeit des Geräts wird an vielen Stellen, z.B. zum Erfassen von Messwerten oder Schreiben von Logdateien, genutzt.
Daher ist eine stabile Systemzeit sehr wichtig.
Diese wird am Besten durch die Nutzung eines Zeitsynchronisationsdiensts (NTP) sichergestellt.

Zum Aktivieren der Synchronisation, tragen Sie die Hostadresse mindestens eines (vorzugsweise nicht virtuellen) Zeitservers unter [.guihint]#NTP-Server# ein.

=== Syslog-Einträge weiterleiten

Auf dem Gerät werden durch das Betriebssystem und einige dauerhaft laufende Prozesse Logmeldungen erzeugt, die per Syslog zunächst in ein lokales Log geschrieben werden.
Diese Einträge können Sie auch an einen Syslog-Server schicken lassen, um sie dort auszuwerten, zu filtern oder zu archivieren.

Wählen Sie zur Konfiguration der Weiterleitung den Punkt [.guihint]#Syslog.#

Im folgenden Dialog können Sie nun einstellen, welches Protokoll Sie zur Weiterleitung verwenden wollen.
Syslog über UDP ist weiter verbreitet, allerdings nicht so zuverlässig wie über TCP.
Wenn Ihr Syslog-Server also beide Protokolle unterstützt, empfehlen wir TCP.

Weiterhin müssen Sie noch die Hostadresse des Syslog-Servers konfigurieren, der die Logmeldungen annehmen soll.

=== Ausgehende E-Mails konfigurieren

Damit Sie von dem Gerät aus E-Mails verschicken können, z.B. bei Ereignissen während des Monitorings, muss die Weiterleitung der Mails an einen Ihrer Mailserver über [.guihint]#Outgoing Emails# konfiguriert werden.

Dazu muss mindestens die Hostadresse Ihres Mailservers als [.guihint]#SMTP Relay Host# gesetzt werden.
Dieser Server nimmt die E-Mails von Ihrem Gerät an und leitet sie weiter.

Die Konfiguration des SMTP-Relay-Servers ist allerdings nur ausreichend, solange Ihr Mailserver E-Mails über anonymes SMTP akzeptiert.
Wenn Ihr Mailserver eine Authentifizierung voraussetzt, dann müssen Sie unter [.guihint]#Authentication# die passende Loginmethode aktivieren und passende Zugangsdaten eingeben.

Sollten Sie selbst nach der Konfiguration keine E-Mails erreichen, lohnt ein Blick in das Systemlog des Geräts.
Hier werden alle Versuche, Mails zu verschicken, protokolliert.

Das Gerät selbst kann Systemmails verschicken, wenn es kritische Probleme gibt, z.B. ein Job nicht ausgeführt werden kann oder ein Hardwareproblem erkannt wurde.
Um diese E-Mails zu empfangen, müssen Sie über [.guihint]#Send local system mails to# eine E-Mail-Adresse konfigurieren, an die diese Mails verschickt werden sollen.

Letztlich können Sie noch die Transportverschlüsselung via TLS aktivieren und manuell eine Standard-Absenderadresse setzen.

=== Zugriff auf {CMK}-Agenten anpassen

Auf dem Gerät ist ein {CMK}-Agent installiert, der in der Grundeinstellung nur vom Gerät selbst abgefragt werden kann.
So können Sie die Appliance selbst in eine auf ihr laufende Monitoring-Instanz aufnehmen.

Es ist ebenfalls möglich, den {CMK}-Agenten von einem entfernten Gerät aus erreichbar zu machen, so dass die lokale Appliance auch von einem anderen {CMK}-System überwacht werden kann, z.B. in einer verteilten Umgebung von einem zentralen Server.
Hierzu können Sie eine Liste von IP-Adressen konfigurieren, die den {CMK}-Agenten kontaktieren dürfen.

=== Netzwerkkonfiguration anpassen

Die grundlegende Netzwerkkonfiguration für die Standard-Netzwerkschnittstelle haben Sie während der Inbetriebnahme über die Konsole erledigt.
Sie können diese Einstellungen über [.guihint]#Device Settings > Network Settings# aufrufen und nachträglich ändern.
Zudem lässt sich an dieser Stelle eine *IPv6-Adresse* hinzufügen.

image::appliance_network_simple.png[]

Bei diesen Einstellungen handelt es sich um den _einfachen Modus,_ wie Sie am Titel des Dialog erkennen können: [.guihint]#Edit Simple Network Settings.#
Über den Knopf [.guihint]#Advanced Mode# aktivieren Sie den _erweiterten Modus,_ der Ihnen Zugriff auf alle verfügbaren Netzwerkschnittstellen und Bonding-Funktionen gewährt.

Die erweiterte Konfiguration kann Ihnen helfen, die Verfügbarkeit des Monitorings über Redundanzen zu erhöhen.
Sie ist zudem Ausgangspunkt für die Konfiguration eines Clusters und wird daher im xref:appliance_cluster#[Cluster-Artikel] ausführlich beschrieben.

// ML: Vorher hier: Kapitel 2 - Installation von CMK; jetzt als draft_appliance_cmk_install.asciidoc für Handbuch-Kapitel 2.
// ML: Als Include realisiert und daher hier UND einzeln Handbuch-Kapitel 2.

[#manage_cmk]
== {CMK}-Versionen verwalten

include::include_appliance_cmk_install.asciidoc[]

[#site_management]
== Monitoring-Instanzen verwalten


[#create_site]
=== Instanz erstellen

Wählen Sie im Hauptmenü der Web-Oberfläche [.guihint]#Site Management.# 
Auf dieser Seite haben Sie Zugriff auf alle Monitoring-Instanzen dieses Geräts, können die Instanzen konfigurieren, aktualisieren, löschen -- und neue anlegen.

Beim ersten Zugriff ist die Seite noch leer.
Zum Erstellen Ihrer ersten Instanz klicken Sie den Knopf [.guihint]#Create New Site.#
Auf der folgenden Seite können Sie die initiale Konfiguration der Instanz festlegen:

image::cma_webconf_site_create_2.png[]

Tragen Sie hier zunächst eine ID (_Unique site ID_) ein, die der eindeutigen Identifikation der Instanz dient. 
Die ID darf nur Buchstaben, Ziffern, Bindestriche (`-`) und Unterstriche (`_`) enthalten, muss mit einem Buchstaben oder Unterstrich beginnen und darf maximal 16 Zeichen lang sein.

Wählen Sie dann die {CMK}-Version, mit der die Instanz erstellt werden soll. 
Es werden Ihnen alle Versionen angeboten, die in der xref:manage_cmk[Verwaltung der {CMK}-Software-Versionen] installiert sind.

Abschließend legen Sie noch den Benutzernamen des {CMK}-Administrators und ein Passwort fest.
Alle weiteren Einstellungen können Sie zunächst unverändert lassen und bei Bedarf später anpassen.

Klicken Sie [.guihint]#Create Site# um die Instanz zu erstellen.
Dies kann einige Sekunden dauern. 
Nachdem die Instanz angelegt und gestartet wurde, werden auf der Seite alle Instanzen aufgelistet:

image::cma_webconf_site_list_2.png[]

Die Liste ist kurz und zeigt momentan nur die soeben erstellte Instanz mit der ID [.guihint]#mysite# und ihrem Status, hier [.guihint]#running.#
Mit dem Knopf ganz rechts in der Spalte [.guihint]#Control# können Sie die Instanz stoppen bzw. starten. 
Ganz links in der Spalte [.guihint]#Actions# werden Symbole für die möglichen Aktionen gezeigt, die Sie auf die Instanz anwenden können, von links nach rechts: Bearbeiten, Aktualisieren, Umbenennen, Klonen, Löschen und Anmelden.

Sie können sich jetzt an der gestarteten Instanz anmelden, wahlweise indem Sie auf die Instanz-ID klicken oder in der Adresszeile Ihres Webbrowsers die URL der Instanz aufrufen, in unserem Beispiel: `\http://192.168.178.60/mysite`. 
Im Anmeldedialog der Instanz geben Sie die Zugangsdaten ein, die Sie beim Erstellen der Instanz festgelegt haben.

Nach der Anmeldung können Sie {CMK} wie gewohnt einrichten -- die ersten Schritte sind im Artikel zum xref:checkmk_getting_started#[Schnelleinstieg ins Monitoring] beschrieben.

In allen Instanzen der Appliance ist für alle Administratoren in der xref:user_interface#sidebar[Seitenleiste] das Snapin [.guihint]#{CMK} Appliance# verfügbar:

image::cma_site_sidebar_2.png[width=50%, align=center]

Mit den Einträgen dieses Snapins können Sie stets aus einer Instanz zur Web-Oberfläche der Appliance wechseln.


[#update_site]
=== Instanz updaten

Beim Update einer Instanz wird diese auf eine neue {CMK}-Software-Version aktualisiert. 
Installieren Sie zuerst die gewünschte neue Version, wie es im Kapitel zur xref:manage_cmk[Verwaltung der {CMK} Software-Versionen] beschrieben ist.

*Achtung:* Bei Aktualisierungen auf neue {CMK}-Major-Versionen sollten Sie den xref:update_major#[zugehörigen Artikel] beachten.
Wichtig ist hier, dass Sie immer nur auf die nächste Major-Version aktualisieren und keine überspringen.

Lassen Sie sich dann auf der Web-Oberfläche der Appliance die Instanzen auflisten ([.guihint]#Main Menu > Site Management#):

[{image-border}]
image::cma_webconf_site_list_2.png[]

Sorgen Sie dafür, dass die Instanz nicht läuft, d.h. ist der [.guihint]#Status# gleich [.guihint]#running,# stoppen Sie die Instanz ([.guihint]#Control > Stop#). 
Klicken Sie anschließend unter [.guihint]#Actions# auf das Update-Symbol icon:icon_cma_site_update[].

Auf der folgenden Seite werden Ihnen die möglichen Zielversionen für das Update aufgelistet:

[{image-border}]
image::cma_site_update_1.png[]

Wählen Sie hinter [.guihint]#Target Check_MK version# die Zielversion aus und klicken Sie dann auf [.guihint]#Update now.#
Nach kurzer Zeit werden die Meldungen zum Update angezeigt: 

image::cma_site_update_2.png[]

Mit dem Knopf [.guihint]#Back# kehren Sie zurück zur Liste der Instanzen, nun mit der aktualisierten Versionsinformation.
Sie können die Instanz nun wieder starten.

*Hinweis:* Das Update einer Instanz in der Appliance folgt dem gleichen Prinzip wie das Update auf einem regulären Linux-Server.
Bei Problemen, Fehlermeldungen oder Konflikten erhalten Sie im Artikel xref:update#detailed[Updates und Upgrades] genaue Informationen zum Update-Prozess.


[#migrate_site]
=== Instanz migrieren

Es kommt häufig vor, dass eine bereits auf einem anderen Linux-System laufende Instanz auf eine {CMK}-Appliance migriert werden soll. 
Die {CMK}-Appliance bietet hierzu eine Funktion an, mit der Sie diese  Migration durchführen können.

Folgende Voraussetzungen müssen erfüllt sein:

* Sie benötigen eine Netzwerkverbindung zwischen dem Quellsystem und Ihrem Gerät als Zielsystem.
* Die {CMK}-Version der Quellinstanz muss auf Ihrem Gerät installiert sein (Architekturwechsel von 32-bit auf 64-bit ist möglich).
* Die Quellinstanz muss während der Migration gestoppt sein.

In der Web-Oberfläche finden Sie unter dem Punkt [.guihint]#Site Management# den Knopf [.guihint]#Migrate Site,# der Sie zu dieser Seite führt:

image::cma_webconf_site_migrate_start_2.png[]

Auf dieser Seite müssen Sie zunächst unter [.guihint]#Source Host# die Host-Adresse (Host-Name, DNS-Name oder IP-Adresse) des Quellsystems angeben. 
Außerdem geben Sie die ID der zu migrierenden Instanz unter [.guihint]#Source site ID# an.

Die Migration der Instanz erfolgt über SSH. 
Sie benötigen hierzu die Zugangsdaten für einen Benutzer, der sich auf dem Quellsystem anmelden kann und berechtigt ist, auf alle Dateien der Instanz zuzugreifen. 
Hierzu können Sie den `root`-Benutzer des Quellsystems verwenden -- oder den Instanzbenutzer, falls ein Passwort für den Instanzbenutzer festgelegt ist.

Optional können Sie nun noch wählen, ob Sie für die Zielinstanz auf Ihrem Gerät eine neue Instanz-ID verwenden oder die Original-ID unverändert lassen wollen.

Weiterhin können Sie festlegen, dass Sie die Performance-Daten (Messwerte bzw. Graphen) und die historischen Daten der Ereignisse des Monitorings bei der Migration _nicht_ mit übertragen wollen. 
Dies kann sinnvoll sein, wenn Sie kein 1:1-Abbild der Instanz brauchen, sondern diese nur, z.B. zu Testzwecken, duplizieren wollen.

Nachdem Sie die Parameter ausgefüllt und mit [.guihint]#Start# bestätigt haben, wird Ihnen der Fortschritt der Migration angezeigt:

image::cma_webconf_site_migrate_progress_2.png[]

Nach Abschluss der Migration können Sie die Migrationsverwaltung über den Knopf [.guihint]#Complete# verlassen. 
Sie landen wieder in der Instanzverwaltung und können die importierte Instanz wie gewohnt starten und verwalten:

[{image-border}]
image::cma_webconf_site_migrate_complete_2.png[]

[#cma_webconf_firmware]
== Firmware verwalten

Sie können die Software Ihres Geräts, d.h. die Firmware der Appliance, im laufenden Betrieb auf eine neuere Version aktualisieren. 

Die Firmware der Appliance können Sie als CFW-Datei auf der xref:https://checkmk.com/de/download[Download-Seite^] herunterladen. 

*Hinweis:* Achten Sie darauf, dass Sie die Firmware passend zur installierten Edition Ihrer Appliance auswählen. 
Ein Update von der {FE} auf eine Vollversion der {EE} ist natürlich ebenfalls möglich.

Nachdem Sie die CFW-Datei heruntergeladen haben, wählen Sie im Hauptmenü [.guihint]#Firmware Update# und auf der folgenden Seite mit dem Dateiauswahldialog die CFW-Datei von Ihrer Festplatte:

[{image-border}]
image::cma_webconf_firmware_upload_2.png[]

Bestätigen Sie mit einem Klick auf [.guihint]#Upload & Install.#
Nun wird die Firmware auf Ihr Gerät hochgeladen, was je nach Netzwerkverbindung einige Minuten dauern kann.

Nachdem die Datei als gültige Firmware erkannt wurde, wird Ihnen der [.guihint]#Confirm Firmware Update#-Dialog zur Bestätigung des Firmware-Updates angezeigt. 
Dabei erscheinen, je nach Versionsunterschieden der aktuellen und der zu installierenden Version, verschiedene Meldungen, die Sie über die Behandlung Ihrer Daten während des Updates informieren:

* Änderung der ersten Stelle (_major release_) der Versionsnummer: Sie müssen die Daten Ihres Geräts manuell sichern und nach dem Update wieder einspielen. Ein Update ohne Datenmigration ist nicht möglich.
* Update auf höhere Nummer in der zweiten Stelle (_minor release_): Das Update kann ohne Datenmigration durchgeführt werden. Eine vorherige Sicherung wird trotzdem empfohlen.
* Änderung der dritten Stelle (_patch_) der Versionsnummer: Das Update kann ohne eine Datenmigration durchgeführt werden. Eine vorherige Sicherung wird trotzdem empfohlen.

Sie können an dieser Stelle den Dialog mit [.guihint]#No# abbrechen und zuerst eine gegebenenfalls notwendige Datensicherung durchführen.

*Wichtig:* Wenn Sie den [.guihint]#Confirm Firmware Update#-Dialog aber mit [.guihint]#Yes!# bestätigen, wird das Gerät *sofort* neu gestartet! 

Beim Neustart wird die ausgewählte Firmware installiert. 
Der Neustart dauert dadurch deutlich länger als sonst, jedoch in der Regel weniger als 10 Minuten. 
Anschließend wird automatisch ein weiterer Neustart ausgeführt, womit das Firmware-Update abgeschlossen ist. 
Die Statusansicht der Konsole zeigt die neu installierte Firmware-Version an.

Hinweis zum *Major-Update:* Wenn Sie die Firmware von 1.4 auf 1.5 aktualisieren, müssen Sie auch alle installierten {CMK}-Versionen wahlweise aktualisieren oder in der gleichen Version (aber für eine neuere Plattform) reinstallieren.
Der Grund: Die 1.5 basiert auf einer neuen Debian-Version.
Unter [.guihint]#Site Management# können Sie prüfen, ob Versionen inkompatibel sind.
Inkompatible Versionen lassen sich nicht mehr starten.

[{image-border}]
image::cma_sites_incompatible_versions.png[Inkompatible Versionen]


// ML: Früher hier: Geräteeinstellungen

// ML: Früher Kapitel 8
== Gerät zurücksetzen/neustarten
=== Neustarten/Herunterfahren

Das Gerät können Sie sowohl über die Web-Oberfläche als auch über die Konsole neu starten bzw. herunterfahren.

In der Web-Oberfläche finden Sie die Menüpunkte [.guihint]#Reboot Device# und [.guihint]#Shutdown Device# unterhalb des Punkts [.guihint]#Control Device# im
Hauptmenü.
Das Gerät führt die Aktion unmittelbar nach der Auswahl des Befehls aus.

[{image-border}]
image::cma_webconf_control_2.png[]

In der Konsole erreichen Sie das Menü zur Steuerung des Geräts durch einen
Druck auf `F2`.

image::cma_console_actions_2.png[]

*Warnung:* Wenn Sie die physische Appliance herunterfahren, benötigen Sie für einen Neustart entweder physischen Zugang, um die Stromzufuhr zu trennen und wieder anzuschließen, oder ein aktiviertes xref:appliance_rack_config#ipmi[Management-Interface.]


=== Werkskonfiguration wiederherstellen

Sie können Ihr Gerät auf die Werkseinstellungen zurücksetzen.
Das bedeutet, dass alle Änderungen, die Sie am Gerät vorgenommen haben, z.B. Ihre Geräteeinstellungen, Monitoringkonfiguration oder die erfassten Statistiken und Logs, gelöscht werden.
Beim Zurücksetzen der Einstellungen bleibt die aktuell installierte Firmware-Version erhalten, die bei der Auslieferung des Geräts installierte Firmware wird nicht wiederhergestellt.

Diese Aktion können Sie auf der Konsole durchführen.
Drücken Sie dazu in der Statusansicht die Taste `F2`, wählen Sie im folgenden Dialog [.guihint]#Factory Reset# und bestätigen Sie den darauf folgenden Dialog mit [.guihint]#yes.#
Nun werden Ihre Daten vom Gerät gelöscht und direkt im Anschluss wird ein Neustart ausgeführt.
Das Gerät startet nun mit einer frischen Konfiguration.

*Wichtig:* Die Einstellungen zum Management-Interface der physischen Appliance sind persistent, bleiben also auch beim Zurücksetzen auf die Werkseinstellungen erhalten.
Damit ist sichergestellt, dass Sie später keinen physischen Zugriff mehr auf das Rack benötigen.

// ML: Früher Kapitel 10
[#cma_mounts]
== Einbinden von Netzwerkdateisystemen

Wenn Sie eine xref:appliance_backup#[Datensicherung] auf eine Netzwerkfreigabe machen möchten, müssen Sie zunächst das gewünschte Netzwerkdateisystem konfigurieren.

Aktuell werden die Netzwerkdateisysteme NFS in Version 3 und Windows-Netzwerkfreigaben (Samba bzw. CIFS) sowie SSHFS (SFTP) unterstützt.

Wählen Sie aus dem Hauptmenü der Web-Oberfläche den Punkt [.guihint]#Manage mounts# und legen Sie von dort aus ein neues Dateisystem über [.guihint]#New mount# an.
Geben Sie hier eine ID ein, die später zur Identifizierung des Dateisystems genutzt wird.

image::cma_de_mount_new_2.png[]

Wählen Sie dann, ob und wie das Dateisystem eingebunden werden soll.
Empfohlen wird hier das automatische Einbinden bei Zugriff bzw. automatische Aushängen bei Inaktivität.

Konfigurieren Sie dann noch, welchen Freigabetyp Sie einbinden wollen.
Je nach Typ werden dann noch entsprechende Einstellungen benötigt, beispielsweise Netzwerkadressen, Login-Daten oder exportierte Pfade für NFS.


Nach dem Speichern sehen Sie in der Dateisystemverwaltung das soeben konfigurierte Dateisystem und den aktuellen Zustand.
Mit einem Klick auf den Stecker können Sie nun das Dateisystem manuell einhängen, um zu testen, ob die Konfiguration korrekt ist.

image::cma_de_mount_list_2.png[]

Sollte es Probleme geben, können Sie eventuelle Fehlermeldungen im Systemlog finden.


[#ssh]
== Remote-Zugriff über SSH

=== Zugriffsoptionen

Sie können verschiedene Zugriffsarten über das Fernwartungsprotokoll SSH aktivieren.
Grundsätzlich werden

* der Zugriff auf die Konsole und
* der direkte Login in die Instanzen

unterstützt.
Der Zugriff auf den Systembenutzer _root_ ist zwar möglich, wird aber nicht empfohlen bzw. supportet, da es hiermit sehr einfach möglich ist, die Konfiguration oder die Software zu beschädigen.

=== Instanzlogin über SSH aktivieren

Sie können den Zugriff auf die Kommandozeile der einzelnen Monitoring-Instanzen aktivieren.
Hiermit können Sie die gesamte Umgebung der Instanz einsehen und steuern.

Dieser Zugriff wird über die xref:appliance_usage#site_management[Instanzverwaltung] gesteuert.
Im Einstellungsdialog jeder einzelnen Instanz können Sie den Zugriff aktivieren und deaktivieren sowie ein Passwort zum Schutz des Zugriffs festlegen.

image::cma_webconf_site_edit_pw_2.png[]

=== Konsole über SSH aktivieren

Es ist möglich, den Zugriff auf die textbasierte Konfigurationsumgebung des Geräts (Konsole) über das Netzwerk zu aktivieren.
Damit können Sie die Grundkonfiguration des Geräts auch ohne direkten Zugriff auf das Gerät einsehen und anpassen.

Sie können den Zugriff über den Konfigurationsdialog der Konsole freischalten.
Wählen Sie dazu den Menüpunkt [.guihint]#Console via SSH.#

image::cma_console_config_ssh_console_2.png[]

Wenn Sie die Option aktivieren, werden Sie zur Eingabe eines Passworts aufgefordert.
Dieses Passwort müssen Sie eingeben, wenn Sie sich mit dem Benutzernamen `setup` per SSH verbinden.
Direkt nach dem Bestätigen dieses Dialogs wird der Zugriff automatisch freigeschaltet.

Sie können sich nun als Nutzer `setup` mit Hilfe eines SSH-Clients (z.B. PuTTY) mit dem Gerät verbinden.

Ob der Zugriff aktuell freigeschaltet ist, können Sie in der Statusansicht der Konsole im Kasten [.guihint]#Access# sehen.

=== root-Zugriff über SSH aktivieren

Es ist möglich, den Zugriff als Systembenutzer `root` auf das Gerät zu aktivieren.
Nach der Initialisierung des Geräts ist dieser Zugriff jedoch deaktiviert.
Einmal aktiviert, können Sie sich als Benutzer `root` über SSH am Gerät anmelden.
Als `root` landen Sie jedoch nicht im Menü der Appliance, sondern schlicht auf der Kommandozeile.

*Warnung:* Befehle, die Sie als `root` auf dem Gerät ausführen, können nicht nur Ihre Daten, sondern auch das ausgelieferte System nachhaltig verändern oder beschädigen.
Wir haften nicht für Veränderungen, die Sie auf diese Art vorgenommen haben.
Aktivieren und verwenden Sie den Benutzer `root` nur, wenn Sie sich sicher sind, was Sie tun und nur zu Diagnosezwecken.

Sie können den Zugriff über den Konfigurationsdialog der Konsole freischalten.
Wählen Sie dazu den Menüpunkt [.guihint]#Root Access via SSH.#

image::cma_console_config_ssh_root_1_2.png[]

Anschließend setzen Sie die Option auf [.guihint]#enable.#

image::cma_console_config_ssh_root_2_2.png[]

Sobald Sie die Option aktivieren, werden Sie zur Eingabe eines Passworts aufgefordert.
Dieses Passwort müssen Sie eingeben, wenn Sie sich als Benutzer `root` per SSH verbinden.
Direkt nach dem Bestätigen dieses Dialogs wird der Zugriff automatisch freigeschaltet.

image::cma_console_config_ssh_root_3_2.png[]

Sie können sich nun als Nutzer `root` mit Hilfe eines SSH-Clients mit dem Gerät verbinden.

Ob der Zugriff aktuell freigeschaltet ist, können Sie in der Statusansicht der Konsole im Kasten [.guihint]#Access# sehen.


[#ssl]
== Appliance-GUI per TLS absichern

=== Zugriff über TLS einrichten

Im Auslieferungszustand läuft der Zugriff auf die Web-Oberfläche Ihres Geräts über HTTP im Klartext.
Sie können diesen Zugriff per HTTPS (TLS) absichern, so dass die Daten zwischen Ihrem Browser und dem Gerät verschlüsselt übertragen werden.

Die Konfiguration erreichen Sie über den Knopf [.guihint]#Web Access# in den [.guihint]#Device Settings.#

=== Zertifikat installieren

Um den Datenverkehr verschlüsseln zu können, benötigt das Gerät zunächst ein Zertifikat und einen privaten Schlüssel.
Sie haben nun mehrere Möglichkeiten, wie Sie das Zertifikat installieren können:

* Neues Zertifikat erstellen und mit einer Zertifikatsregistrierungsanforderung von einer Zertifizierungsstelle signieren lassen.
* Existierenden privaten Schlüssel und Zertifikat hochladen.

// ML: Self-Signed von Chrome/Firefox gekappt, erstmal auskommentiert, MS legt CMK-Ticket an, dass die Option raus kann.
////
* Neues Zertifikat erstellen und selbst signieren.
////

Je nachdem, wie Ihre Anforderungen und Möglichkeiten sind, können Sie eine der obigen Optionen wählen.
Zertifikate, die von Zertifizierungsstellen signiert sind, haben im Allgemeinen den Vorteil, dass Clients beim Zugriff automatisch verifizieren können, dass die Gegenstelle (das Gerät) authentisch ist.
Dies ist für offizielle Zertifizierungsstellen in der Regel sichergestellt.

Wenn ein Nutzer auf die Web-Oberfläche per HTTPS zugreift und das Zertifikat von einer Zertifizierungsstelle signiert ist, der er nicht vertraut, führt das zunächst zu einer Warnung im Webbrowser.

[discrete]
==== Neues Zertifikat erstellen und signieren lassen

Um ein neues Zertifikat zu erstellen, wählen Sie die Option [.guihint]#New Certificate.#
Im folgenden Dialog geben Sie nun Informationen zu Gerät und Betreiber ein, die dann in dem Zertifikat hinterlegt werden und sowohl von der Zertifizierungsstelle als auch später von Clients genutzt werden können, um das Zertifikat zu verifizieren.

image::cma_webconf_ssl_csr_2.png[]

Nachdem Sie den Dialog mit [.guihint]#Save# bestätigt haben, gelangen Sie wieder zur Startseite des Bereichs [.guihint]#Web Access# und können die Datei zur Zertifikatsregistrierungsanforderung (CSR) herunterladen.
Diese Datei müssen Sie Ihrer Zertifizierungsstelle zur Verfügung stellen.
Anschließend bekommen Sie von Ihrer Zertifizierungsstelle ein signiertes Zertifikat und ggf. eine Zertifikatskette (oft bestehend aus Intermediate- und/oder
Root-Zertifikaten).
Diese erhalten Sie üblicherweise in Form von _.pem_- oder _.crt-Dateien._

image::cma_webconf_ssl_upload_2.png[]

Das signierte Zertifikat können Sie nun über den Dialog [.guihint]#Upload Certificate# auf das Gerät übertragen.
Wenn Sie eine Zertifikatskette erhalten haben, können Sie diese ebenfalls über den Dialog hochladen.

Nachdem Sie den Dialog mit [.guihint]#Upload# bestätigt haben, können Sie mit der Konfiguration der Zugriffswege fortfahren.


// ML: Self-Signed haben Chrome und Firefox kürzlich gekappt, MS legt CMK-Ticket an, dass das raus kann.
////
[discrete]
==== Neues Zertifikat erstellen und selbst signieren

Um ein neues Zertifikat zu erstellen, wählen Sie die Option [.guihint]#New Certificate.#
Im folgenden Dialog geben Sie nun Informationen zu Gerät und Betreiber ein, die dann in dem Zertifikat hinterlegt werden und später von Clients genutzt werden können, um das Zertifikat zu verifizieren.

image::cma_webconf_ssl_self_signed_2.png[]

Beim letzten Punkt [.guihint]#Signing method# wählen Sie nun [.guihint]#Create a self signed certificate#.
Anschließend haben Sie noch die Möglichkeit, die maximale Laufzeit des Zertifikats zu bestimmen.

Nach dieser Laufzeit müssen Sie ein neues Zertifikat erzeugen.
Dies sollte allerdings rechtzeitig vor Ablauf passieren, damit es keine Probleme beim Zugriff auf Ihr Gerät gibt.

Nachdem Sie den Dialog mit [.guihint]#Save# bestätigt haben, können Sie mit der Konfiguration der Zugriffswege fortfahren.
////

[discrete]
==== Existierendes Zertifikat hochladen

Wenn Sie ein existierendes Zertifikat und einen privaten Schlüssel besitzen, die Sie zur Absicherung des HTTPS-Verkehrs nutzen wollen, können Sie diese Dateien über den Dialog [.guihint]#Upload Certificate# auf Ihr Gerät übertragen.

Nachdem Sie den Dialog mit [.guihint]#Upload# bestätigt haben, können Sie mit der Konfiguration der Zugriffswege fortfahren.


=== Zugriffswege konfigurieren

Nachdem Sie ein Zertifikat installiert haben, können Sie die Zugriffswege nun entsprechend Ihrer Anforderungen konfigurieren.

Wenn Sie den Zugriff auf Ihr Gerät per HTTPS absichern wollen, empfiehlt sich die Option [.guihint]#HTTPS enforced (incl. redirect from HTTP to HTTPS).#
Das Gerät antwortet nur per HTTPS, leitet allerdings alle eingehenden HTTP-Anfragen auf HTTPS um.
Nutzer, die versehentlich direkt oder über Bookmarks per HTTP auf die Web-Oberfläche zugreifen, werden also automatisch auf HTTPS umgeleietet.

Wenn es Ihnen sehr wichtig ist, dass keine einzige Anfrage im Klartext über das Netz geht, können Sie die Option [.guihint]#HTTPS only# wählen.
Nutzer, die per HTTP zugreifen, erhalten mit dieser Einstellung eine Fehlermeldung.

Sie können außerdem beide Protokolle über [.guihint]#HTTP and HTTPS# gleichzeitig aktivieren.
Allerdings ist diese Einstellung nur in Ausnahmefällen, zu Migrationszwecken oder zum Testen, empfehlenswert.

Sollten Sie HTTPS einmal deaktivieren wollen, so können Sie dies mit der Option [.guihint]#HTTP only# erreichen.

=== Aktuelle Konfiguration/Zertifikate anzeigen

Auf der Seite zur Konfiguration der Zugriffswege können Sie jederzeit die aktuell aktiven Zugriffswege sowie Informationen zum aktuellen Zertifikat einsehen.

//SK: Dieses Bild wurde schon vorzeitig ersetzt, weil das bisherige Bild größer als 1 MB war.
image::cma_webconf_ssl_info_2.png[]





// ML: Vorher hier: Backup - jetzt in NEU appliance_backup.asciidoc


// ML: früher hier Netzlaufwerke - jetzt weiter oben

// ML: früher hier Failover Cluster - NEU in appliance_cluster.asciidoc


// ML: früher hier SMS - jetzt in NEU appliance_rack1.asciidoc

// ml: Vorher: rack-Besonderheiten. Jetzt: in appliance_rack1.asciidoc (neu)


== Fehlerdiagnose

=== Logs

Trotz sorgfältiger Tests ist es nicht auszuschließen, dass es zu unvorhergesehenen Fehlern kommt, die ohne Blick auf das Betriebssystem nur schwer zu diagnostizieren sind.

Eine Möglichkeit ist, die Logeinträge, die auf dem System erzeugt werden, per Syslog an einen Syslog-Server schicken zu lassen.
Allerdings werden die Logeinträge der einzelnen Monitoring-Instanzen nicht per Syslog verarbeitet, so dass diese nicht weitergeleitet werden und nur am Gerät eingesehen werden können.

Um die Fehlerdiagnose auf dem Gerät zu vereinfachen, existiert eine Ansicht zum Anzeigen diverser Logdateien des Geräts.
Diese erreichen Sie über den Menüpunkt [.guihint]#View Log Files# im Hauptmenü der Web-Oberfläche.

[{image-border}]
image::cma_webconf_logs_2.png[]

Hier können Sie die Logs des Geräts auswählen und deren aktuellen Inhalt einsehen.

*Achtung:* Das Systemlog wird bei jedem Start des Geräts neu initialisiert.
Wenn Sie die Logeinträge erhalten möchten, müssen Sie diese an einen Syslog-Server schicken.

An der lokalen Konsole gibt es ebenfalls die Möglichkeit, das Systemlog einzusehen.
Auf dem zweiten Terminal werden die letzten Einträge des Systemlogs angezeigt.
Dieses Terminal erreichen Sie durch die Tastenkombination `CTRL+ALT+F2`.
Auf dem dritten Terminal werden alle Kernelmeldungen ausgegeben.
Hier finden Sie bei Hardwareproblemen die entsprechenden Meldungen.
Dieses Terminal ist mit der Tastenkombination `CTRL+ALT+F3` erreichbar.
Mit Hilfe der Tastenkombination `CTRL+ALT+F1` können Sie wieder auf die Statusansicht zurückschalten.


=== Verfügbarer Arbeitsspeicher

Der im Gerät verfügbare Arbeitsspeicher steht Ihren Monitoring-Instanzen abzüglich des Speichers, der von den Systemprozessen der {CMK}-Appliance benötigt wird, zur freien Verfügung.

Um die Stabilität der Systemplattform gewährleisten zu können, wird eine feste Menge des Arbeitsspeichers für die Systemprozesse reserviert.
Je nach Konfiguration Ihres Geräts ist die Menge des reservierten Speichers wie folgt:

* Einzelgerät (ohne Clusterkonfiguration): *100 MB*
* Geclustert: *300 MB*

Wenn Sie genau wissen wollen, wie viel Arbeitsspeicher Ihren Monitoring-Instanzen zur Verfügung steht und wie viel aktuell belegt ist, können Sie Ihr Gerät von {CMK} überwachen lassen.
Auf dem Gerät wird ein Service [.guihint]#User_Memory# angelegt, der Ihnen die aktuellen und historischen Auslastungen anzeigt.

Falls von den Monitoring-Instanzen mehr Arbeitsspeicher belegt wird als verfügbar ist, wird automatisch einer der Prozesse der Monitoring-Instanzen beendet.
Dies wird durch Standard-Mechanismen des Linux-Kernels umgesetzt.

== Service und Support

Bei Problemen während der Inbetriebnahme oder während des Betriebs, bitten wir Sie, zuerst dieses Handbuch zu Rate zu ziehen.

Aktuelle Supportinformationen zur Appliance sind zudem jederzeit im Internet über unsere xref:https://checkmk.de/appliance.html[Webseite^] abrufbar.
Dort finden Sie die aktuellste Fassung der Dokumentation und allgemeine aktuelle Informationen, die über die Angaben in diesem Handbuch gegebenenfalls hinaus gehen.

[discrete]
==== Firmware

Die aktuellen Versionen der Firmware finden Sie auf unserer xref:https://checkmk.com/de/download[Webseite.^]
Für den Zugriff auf die {EE} und {ME} benötigen Sie die Zugangsdaten Ihres laufenden Supportvertrags.

[discrete]
==== Hardware-Support

Bei einem Hardwareausfall kontaktieren Sie uns bitte per E-Mail an link:mailto:cma-support@checkmk.com[cma-support@checkmk.com] oder per Telefon unter +49 89 99 82 097 - 20.
Die Abwicklung erfolgt gemäß der vereinbarten Wartung und direkt vom Distributor.

[discrete]
==== Software-Support

Im Fall eines Softwarefehlers, egal ob Firmware oder {CMK}-Monitoring-Software, kontaktieren Sie uns bitte über Ihre firmeneigene Supportadresse.
Die Unterstützung erfolgt im Rahmen des abgeschlossenen Supportvertrags.
