// -*- coding: utf-8 -*-
include::global_attr.adoc[]
= Appliance einrichten und nutzen
:revdate: draft
:title: Appliance einrichten und nutzen
:description: Anleitung zur Einrichtung der physischen und virtuellen {CMK} Appliances.


[#basic_config]
== Grundkonfiguration


[#init_start]
=== Initialisierung beim Erststart

An diesem Punkt sollten Sie die Appliance auf einem
xref:cma_rack1_quick_start#[Rack] eingerichtet beziehungsweise in einer xref:introduction_virt1#[virtuellen Maschine], wahlweise VirtualBox oder VMWare ESXi, installiert und gestartet haben.

Während des ersten Starts erscheint zunächst eine Meldung zur Auswahl der gewünschten Sprache:

image::cma_boot_preinit_language_2.png[]

Diese Sprache wird für das gesamte Gerät gespeichert.
Im Anschluss erscheint eine Meldung, die zur Intialisierung des Datenmediums auffordert:

image::cma_boot_preinit_init_uservol_2.png[]

Bestätigen Sie diesen Dialog und warten Sie, bis der Start des Gerätes fortgesetzt und beendet wird.
An der lokalen Konsole wird nun die Statusansicht angezeigt:

image::cma_console_welcome_2.png[]

Diese Ansicht zeigt Ihnen allgemeine Statusinformationen und die wichtigsten Konfigurationsoptionen Ihres Gerätes an.


[#network_access_config]
=== Netzwerk- und Zugriffskonfiguration via Konsole

Von der Statusansicht aus erreichen Sie das Konfigurationsmenü über die Taste `F1`:

image::cma_console_config_2.png[]

Für die Inbetriebnahme des Gerätes müssen Sie nun die Netzwerkkonfiguration einstellen und das Gerätepasswort festlegen.


==== Netzwerkkonfiguration

Über den Punkt [.guihint]#Network Configuration# richten Sie zunächst das Netzwerk ein. 
Dazu werden nacheinander die IP-Adresse, Netzmaske und das optionale Standard-Gateway abgefragt.

In den meisten Fällen soll das Gerät auch auf Netzwerkgeräte außerhalb des eigenen Netzwerksegments zugreifen können. 
Hierfür muss das Standard-Gateway ebenfalls konfiguriert werden.

Nach der Eingabe dieser Werte wird die Konfiguration aktiviert. 
Damit ist das Gerät sofort unter der angegebenen IP-Adresse über das Netzwerk erreichbar. 
Dies können Sie z.B. mit einem `ping` von einem anderen Gerät im Netzwerk testen.


==== Web-Oberfläche aktivieren

Der Großteil der Konfiguration des Gerätes wird über die Web-Oberfläche erledigt. 
Der Zugriff darauf ist durch das Gerätepasswort geschützt, das Sie zunächst festlegen müssen.
Im Auslieferungszustand ist kein solches Passwort gesetzt, also auch kein Zugriff auf die Web-Oberfläche möglich. 

Wählen Sie im Konfigurationsmenü [.guihint]#Device Password#, um das Gerätepasswort festzulegen. 
Das Passwort muss mindestens 8 Zeichen lang sein und mindestens einen Kleinbuchstaben, einen Großbuchstaben und eine Ziffer enthalten.

Anschließend wählen Sie aus dem Konfigurationsmenü die Option [.guihint]#Web Configuration#, um die Web-Oberfläche zu aktivieren.

Wenn Sie diese Schritte abgeschlossen haben, sehen Sie die veränderte Statusansicht der Konsole:

image::cma_console_welcome_basic_2.png[]

Im Kasten [.guihint]#Device Infos# steht die konfigurierte IP-Adresse und im Kasten [.guihint]#Access# steht [.guihint]#Web Configuration: on#.
Wenn Sie das Gerät bereits korrekt mit Ihrem Netzwerk verbunden haben, sehen Sie im Kasten [.guihint]#Status# auch, dass die Netzwerkverbindung aktiv ist: [.guihint]#LAN: UP#.


==== Zugriff auf die Konsole schützen

Beim Start der Appliance ist Ihnen vielleicht aufgefallen, dass es keine Passwortabfrage gab. 
Jeder mit physischem Zugriff auf das Rack oder die Management-Oberfläche der Virtualisierungslösung könnte die
Grundeinstellungen über die Konsole ändern. 

Sie sollten daher den Passwortschutz aktivieren: im Konfigurationsmenü über den Menüpunkt [.guihint]#Console Login#.
Bei eingeschaltetem Schutz wird das Gerätepasswort abgefragt bevor die Statusansicht angezeigt wird und Einstellungen verändert werden können.

Anschließend sehen Sie in der Statusansicht im Kasten [.guihint]#Access# den Eintrag [.guihint]#Console Login: on#.

image::cma_console_welcome_console_login_2.png[]


[#basic_settings_webconf]
=== Grundeinstellungen in der Web-Oberfläche

Nachdem Sie durch die bisherige Konfiguration den Zugriff auf die Web-Oberfläche freigeschaltet haben, können Sie nun die  Web-Oberfläche öffnen über einen Webbrowser auf einem Computer, der mit dem Gerät über das Netzwerk verbunden ist.
Dazu geben Sie in die Adresszeile des Browsers die
Appliance-URL ein, hier etwa `\http://192.168.178.60/`. 
Anschließend sehen Sie den Anmeldedialog der Web-Oberfläche:

image::cma_webconf_login_2.png[width=50%]

Nachdem Sie sich mit dem vorher festgelegten Gerätepasswort angemeldet haben, öffnet sich das Hauptmenü, aus dem Sie alle Funktionen der Web-Oberfläche erreichen können.

[{image-border}]
image::cma_webconf_index_2.png[]

Wählen Sie [.guihint]#Device Settings#, um die wichtigsten Einstellungen des Gerätes einzusehen und bei Bedarf zu ändern:

image::cma_webconf_settings_2.png[]

Per Klick auf den Parameternamen gelangen Sie zur jeweiligen Seite zum Anpassen dieser Einstellung.

Sofern in Ihrer Umgebung vorhanden, sollten Sie nun zunächst einen oder mehrere DNS-Server konfigurieren, damit die Auflösung von Host-Namen genutzt werden kann. 
Wenn in Ihrer Umgebung ein oder mehrere NTP-Server für die
Zeitsynchronisation zur Verfügung stehen, geben Sie diese über IP-Adressen oder Host-Namen unter [.guihint]#NTP Servers# ein.

Wenn von Ihrem Gerät aus E-Mails verschickt werden sollen, z.B. Benachrichtigungen bei Problemen, müssen Sie die Option [.guihint]#Outgoing Emails# konfigurieren. 
Dazu tragen Sie den für dieses Gerät zuständigen SMTP-Relay-Server und eventuell dafür benötigte Zugangsdaten ein. 
An diesen Server werden alle E-Mails geschickt, die auf dem Gerät erzeugt werden.
Sie können unter dieser Einstellung auch konfigurieren, dass alle E-Mails, die vom Betriebssystem des Gerätes erzeugt werden, z.B. bei kritischen Fehlern, an eine separate E-Mail-Adresse geschickt werden sollen.

image::cma_webconf_settings_3.png[]

Damit ist die Grundkonfiguration des Gerätes abgeschlossen und Sie können mit der Installation der {CMK}-Software und der Einrichtung der ersten Monitoring-Instanz fortfahren.


[#manage_cmk]
== {CMK} Software-Versionen verwalten

Beginnend mit der Appliance-Version 1.4.14 ist in der Appliance keine {CMK}-Software mehr vorinstalliert.

Die {CMK}-Software zur Installation in der Appliance wird Ihnen als CMA-Datei angeboten. 
Laden Sie die CMA-Datei herunter -- entweder im link:https://customer.checkmk.com/[Kundenportal] für die {SE} und {ME} oder auf der link:https://checkmk.com/de/download[Download-Seite] für die {FE}.
Sie finden die CMA-Datei nach der Auswahl der {CMK}-Edition, -Version und der Plattform Appliance.

Nachdem Sie die CMA-Datei heruntergeladen haben, wählen Sie im Hauptmenü [.guihint]#Check_MK versions#, auf der folgenden Seite mit Hilfe des Dateiauswahldialogs die CMA-Datei von Ihrer Festplatte und bestätigen Sie die Auswahl mit einem Klick auf [.guihint]#Upload & Install#.

Nun wird die {CMK}-Software auf das Gerät hochgeladen. 
Dies kann, je nach Netzwerkverbindung zwischen Ihrem Computer und dem Gerät, einige Minuten dauern. 
Nachdem das Hochladen erfolgreich abgeschlossen wurde, sehen Sie
die neue Version in der Tabelle der installierten Versionen:

[{image-border}]
image::cma_webconf_cmk_versions_upload1_finished.png[]

Es ist möglich, auf dem Gerät mehrere {CMK}-Versionen parallel
zu installieren. 
Dadurch können mehrere Instanzen in verschiedenen Versionen betrieben und einzelne Instanzen unabhängig voneinander auf neuere Versionen aktualisiert werden. 
So können Sie beispielsweise eine neue Version installieren und diese zunächst in einer Testinstanz ausprobieren um, nach erfolgreichem Test, anschließend Ihre Produktivinstanz zu aktualisieren.

Eine weitere {CMK} Software-Version laden und installieren Sie in gleicher Weise wie die erste. Das Ergebnis sieht dann etwa so aus:

[{image-border}]
image::cma_webconf_cmk_versions_upload2_finished.png[]

Sofern eine Software-Version von keiner Instanz verwendet wird, können Sie die Version mit dem Papierkorb-Symbol löschen.


[#site_management]
== Monitoring-Instanzen verwalten


[#create_site]
=== Instanz erstellen

Wählen Sie im Hauptmenü der Web-Oberfläche [.guihint]#Site Management#. 
Auf dieser Seite haben Sie Zugriff auf alle Monitoring-Instanzen dieses Gerätes, können die Instanzen konfigurieren, aktualisieren, löschen -- und neue anlegen.

Beim ersten Zugriff ist die Seite noch leer.
Zum Erstellen Ihrer ersten Instanz klicken Sie den Knopf [.guihint]#Create New Site#. 
Auf der folgenden Seite können Sie die initiale Konfiguration der Instanz festlegen:

image::cma_webconf_site_create_2.png[]

Tragen Sie hier zunächst eine ID (_site ID_) ein, die der eindeutigen Identifikation der Instanz dient. 
Die ID darf nur Buchstaben, Ziffern, Bindestriche (`-`) und Unterstriche (`_`) enthalten, muss mit einem Buchstaben oder Unterstrich beginnen und darf maximal 16 Zeichen lang sein.

Wählen Sie dann die {CMK}-Version mit der die Instanz erstellt
werden soll. 
Es werden Ihnen alle Versionen angeboten, die in der xref:manage_cmk[Verwaltung der {CMK} Software-Versionen] installiert sind.

Abschließend legen Sie noch den Benutzernamen des {CMK}-Administrators mit Passwort fest.
Alle weiteren Einstellungen können Sie zunächst unverändert lassen. 
Bei Bedarf können Sie diese später über die Seite zum Bearbeiten der Instanz anpassen.

Klicken Sie [.guihint]#Create Site# um die Instanz zu erstellen.
Dies kann einige Sekunden dauern. 
Nachdem die Instanz angelegt und gestartet wurde, werden auf der Seite alle Instanzen aufgelistet:

[{image-border}]
image::cma_webconf_site_list_2.png[]

Die Liste ist kurz und zeigt momentan nur die soeben erstellte Instanz mit der ID [.guihint]#mysite# und ihrem Status, hier [.guihint]#running#. 
Mit dem Knopf ganz rechts in der Spalte [.guihint]#Control# können Sie die Instanz stoppen bzw. starten. 
Ganz links in der Spalte [.guihint]#Actions# werden Symbole für die möglichen Aktionen gezeigt, die Sie auf die Instanz anwenden können, von links nach rechts: Bearbeiten, Aktualisieren, Umbenennen, Klonen, Löschen und Anmelden.

Sie können sich jetzt an der gestarteten Instanz anmelden, wahlweise indem Sie auf die Instanz-ID klicken oder in der Adresszeile Ihres Webbrowsers die URL der Instanz aufrufen, in unserem Beispiel:  `\http://192.168.178.60/mysite`. 
Im Anmeldedialog der Instanz geben Sie die Zugangsdaten ein, die Sie beim Erstellen der Instanz festgelegt haben.

Nach der Anmeldung können Sie {CMK} wie gewohnt einrichten -- die ersten Schritte sind im Artikel zum xref:checkmk_getting_started#[Schnelleinstieg ins Monitoring] beschrieben.

In allen Instanzen der Appliance ist für alle Administratoren in der xref:user_interface#sidebar[Seitenleiste] das Snapin [.guihint]#{CMK} Appliance# verfügbar:

image::cma_site_sidebar_2.png[width=50%, align=center]

Mit den Einträgen dieses Snapins können Sie stets aus einer Instanz zur Web-Oberfläche der Appliance wechseln.


[#update_site]
=== Instanz updaten

Beim Update einer Instanz wird diese auf eine neue {CMK}-Software-Version aktualisiert. 
Installieren Sie zuerst die gewünschte neue Version wie es im Kapitel zur xref:manage_cmk[Verwaltung der {CMK} Software-Versionen] beschrieben ist.

Lassen Sie sich dann auf der Web-Oberfläche der Appliance die Instanzen auflisten ([.guihint]#Main Menu > Site Management#):

[{image-border}]
image::cma_webconf_site_list_2.png[]

Sorgen Sie dafür, dass die Instanz nicht läuft, d.h. wenn der [.guihint]#Status# gleich [.guihint]#running# ist, stoppen Sie die Instanz ([.guihint]#Control > Stop#). 
Klicken Sie anschließend unter [.guihint]#Actions# auf das 
Update-Symbol icon:icon_cma_site_update[].

Auf der folgenden Seite werden Ihnen die möglichen Zielversionen für das Update aufgelistet:

[{image-border}]
image::cma_site_update_1.png[]

Wählen Sie hinter [.guihint]#Target Check_MK version# die Zielversion aus und klicken Sie dann auf [.guihint]#Update now#. Nach kurzer Zeit werden die Meldungen zum Update angezeigt: 

image::cma_site_update_2.png[]

Mit dem Knopf [.guihint]#Back# kehren Sie zurück zur Liste der Instanzen, in der in der Spalte [.guihint]#Version# die neue {CMK}-Version eingetragen ist. Sie können die Instanz nun wieder starten.

*Hinweis:* Das Update einer Instanz in der Appliance folgt dem gleichen Prinzip wie das Update auf einem Linux-Server. Bei Problemen, Fehlermeldungen oder Konflikten erhalten Sie im Artikel xref:update#detailed[Updates und Upgrades] genaue Informationen zum Update-Prozess.


[#migrate_site]
=== Instanz migrieren

Es kommt häufig vor, dass eine bereits auf einem anderen Linux-System
laufende Instanz auf eine {CMK}-Appliance migriert werden soll. 
Die {CMK}-Appliance bietet hierzu eine Seite an, mit der Sie diese  Migration durchführen können.

Folgende Voraussetzungen müssen erfüllt sein:

* Sie benötigen eine Netzwerkverbindung zwischen dem Quellsystem und Ihrem Gerät.
* Die {CMK}-Version der Quellinstanz muss auf Ihrem Gerät installiert sein (Architekturwechsel von 32-bit auf 64-bit ist möglich).
* Die Quellinstanz muss während der Migration gestoppt sein.

In der Web-Oberfläche finden Sie unter dem Punkt [.guihint]#Site Management# den Knopf [.guihint]#Migrate Site#, der Sie zu dieser Seite führt:

image::cma_webconf_site_migrate_start_2.png[]

Auf dieser Seite müssen Sie zunächst unter [.guihint]#Source Host# die Host-Adresse (Host-Name, DNS-Name oder IP-Adresse) des Quellsystems angeben. 
Außerdem geben Sie die ID der zu migrierenden Instanz unter [.guihint]#Source site ID# an.

Die Migration der Instanz erfolgt über SSH. 
Sie benötigen hierzu die Zugangsdaten für einen Benutzer, der sich auf dem Quellsystem anmelden kann und berechtigt ist, auf alle Dateien der Instanz zuzugreifen. 
Hierzu können Sie den `root`-Benutzer des Quellsystems verwenden -- oder den Instanzbenutzer, falls ein Passwort für den Instanzbenutzer festgelegt ist.

Optional können Sie nun noch wählen, ob Sie für die Zielinstanz auf Ihrem Gerät eine neue Instanz-ID verwenden oder die Original-ID unverändert lassen wollen.

Weiterhin können Sie festlegen, dass Sie die Performance-Daten
(Messwerte bzw. Graphen) und die historischen Daten der Ereignisse des Monitorings bei der Migration _nicht_ mit übertragen wollen. 
Dies kann sinnvoll sein, wenn Sie kein 1:1-Abbild der Instanz brauchen, sondern diese nur, z.B. zu Testzwecken, duplizieren wollen.

Nachdem Sie die Parameter ausgefüllt und mit [.guihint]#Start#  bestätigt haben, wird Ihnen der Fortschritt der Migration angezeigt:

image::cma_webconf_site_migrate_progress_2.png[]

Nach Abschluss der Migration können Sie die Migrationsverwaltung über den Knopf [.guihint]#Complete# verlassen. 
Sie landen wieder in der Instanzverwaltung und können die importierte Instanz wie gewohnt starten und verwalten:

[{image-border}]
image::cma_webconf_site_migrate_complete_2.png[]


[#cma_webconf_firmware]
== Firmware aktualisieren

Sie können die Software Ihres Gerätes, d.h. die Firmware der Appliance, im laufenden Betrieb auf eine neuere Version aktualisieren -- oder auch auf eine ältere Version zurück wechseln. 
Vor dem Firmware-Update müssen Sie sich die neue Firmware besorgen.

Die Firmware der Appliance können Sie als CFW-Datei herunterladen, im link:https://customer.checkmk.com/[Kundenportal] für die {SE} und {ME} oder auf der link:https://checkmk.com/de/download[Download-Seite] für die {FE}. 
Die CFW-Datei finden Sie im Download-Bereich beim Produkt {CMK} Appliance. 

Nachdem Sie die CFW-Datei heruntergeladen haben, wählen Sie im Hauptmenü [.guihint]#Firmware Update# und auf der folgenden Seite mit dem Dateiauswahldialog die CFW-Datei von Ihrer Festplatte aus:

[{image-border}]
image::cma_webconf_firmware_upload_2.png[]

Bestätigen Sie mit einem Klick auf [.guihint]#Upload & Install#. 
Nun wird die Firmware auf Ihr Gerät hochgeladen, was je nach
Netzwerkverbindung einige Minuten dauern kann.

Nachdem die Datei als gültige Firmware erkannt wurde, wird Ihnen der [.guihint]#Confirm Firmware Update# Dialog zur Bestätigung des Firmware-Updates angezeigt. 
Dabei erscheinen, je nach Versionsunterschieden der aktuellen und der zu installierenden Version, verschiedene Meldungen, die Sie über die Behandlung Ihrer Daten während des Updates informieren:

* Änderung der ersten Stelle (_major release_) der Versionsnummer: Sie müssen die Daten Ihres Gerätes manuell sichern und nach dem Update wieder einspielen. Ein Update ohne Datenmigration ist nicht möglich.
* Update auf höhere Nummer in der zweiten Stelle (_minor release_): Das Update kann ohne Datenmigration durchgeführt werden. Eine vorherige Sicherung wird trotzdem empfohlen.
* Downgrade auf niedrigere Nummer in der zweiten Stelle: Sie müssen die Daten Ihres Gerätes manuell sichern und nach dem Update wieder einspielen. Ein Update ohne Datenmigration ist nicht möglich.
* Änderung der dritten Stelle (_patch_) der Versionsnummer: Das Update kann ohne eine Datenmigration durchgeführt werden. Eine vorherige Sicherung wird trotzdem empfohlen.

Sie können an dieser Stelle den Dialog mit [.guihint]#No# abbrechen und zuerst eine gegebenenfalls notwendige Datensicherung durchführen.
Anschließend starten Sie den nächsten Versuch.

*Wichtig:* Wenn Sie den [.guihint]#Confirm Firmware Update# Dialog aber mit [.guihint]#Yes!# bestätigen, wird das Gerät *sofort* neu gestartet! 

Beim Neustart wird die ausgewählte Firmware installiert. 
Der Neustart dauert dadurch deutlich länger als sonst, jedoch in der Regel weniger als 10 Minuten. 
Anschließend wird automatisch ein weiterer Neustart ausgeführt, womit der Firmware-Update abgeschlossen ist. 
Die Statusansicht der Konsole zeigt die neu installierte Firmware-Version an.


[#cma_webconf_system_settings]
== Geräteeinstellungen

=== Sprache anpassen

Während der link:appliance_usage.html[Grundkonfiguration] haben Sie die
Sprache Ihres Gerätes festgelegt. Diese können Sie jederzeit sowohl über
die Konfiguration der Konsole, als auch über die Geräteeinstellungen in
der Web-Oberfläche anpassen. Wie auch alle sonstigen Einstellungen in diesem
Dialog, werden Änderungen durch das Speichern sofort wirksam.


=== Netzwerkkonfiguration anpassen

Auch das Netzwerk haben Sie bereits während der
link:appliance_usage.html[Grundkonfiguration] über die Konsole eingestellt,
können die Werte jedoch wiederum über diesen Punkt in der Web-Oberfläche
ändern. Sollte Ihnen dabei ein Fehler unterlaufen und das Gerät über den
Browser nicht mehr erreichbar sein, müssen Sie zum Korrigieren wieder die
Konsole nutzen.


=== Host- und Domainnamen konfigurieren

Host- und Domainnamen dienen der Identifikation eines Computers im
Netzwerk. Diese Namen werden beispielsweise beim Versenden von E-Mails zum
Bilden der Absenderadresse genutzt. Außerdem werden alle Logeinträge,
die an einen Syslog-Server gesendet werden, mit den konfigurierten Hostnamen
als Quellhost ergänzt, um die Einträge leichter zuordnen zu können.


=== Namensauflösung konfigurieren

In den meisten Umgebungen werden _DNS-Server_ zum Übersetzen von
IP-Adressen zu Hostnamen und umgekehrt eingesetzt. Häufig werden auch zum
Monitoring statt IP-Adressen die Hostnamen oder FQDNs (Full Qualified Domain
Names) genutzt.

Um die Namensauflösung auf Ihrem Gerät nutzen zu können, müssen
Sie die IP-Adressen mindestens eines DNS-Servers Ihrer Umgebung
konfigurieren. Empfehlung ist, mindestens zwei DNS-Server einzutragen.

Nur wenn Sie diese Option konfiguriert haben, können Sie z.B. bei der
Konfiguration der NTP- oder Mailserver Host- und Domainnamen verwenden.


=== Zeitsynchronisation konfigurieren

Die Systemzeit des Gerätes wird an vielen Stellen, z.B. zum Erfassen von
Messwerten oder Schreiben von Logdateien, genutzt. Daher ist eine stabile
Systemzeit sehr wichtig. Diese wird am Besten durch die Nutzung eines
Zeitsynchronisationsdiensts (NTP) sichergestellt.

Zum Aktivieren der Synchronisation, tragen Sie die Hostadresse mindestens
eines Zeitservers unter [.guihint]#NTP-Server# ein.


=== Syslog-Einträge weiterleiten

Auf dem Gerät werden durch das Betriebssystem und einige dauerhaft laufende
Prozesse Logmeldungen erzeugt, die per Syslog zunächst in ein lokales Log
geschrieben werden.

Diese Einträge können Sie auch an einen zentralen oder übergeordneten
Syslog-Server schicken lassen, um sie dort auszuwerten, zu filtern oder
zu archivieren.

Wählen Sie zur Konfiguration der Weiterleitung den Punkt [.guihint]#Syslog#.

Im folgenden Dialog können Sie nun konfigurieren, welches Protokoll Sie
zur Weiterleitung verwenden wollen. Syslog über UDP ist weiter verbreitet,
allerdings nicht so zuverlässig, wie über TCP. Wenn Ihr Syslog-Server also
beide Protokolle unterstützt, empfehlen wir TCP.

Weiterhin müssen Sie noch die Hostadresse des Syslog-Servers konfigurieren,
der die Logmeldungen annehmen soll.


=== Standard-Webseite ändern

Wenn Sie im Browser die URL der Appliance ohne weitere Pfadangaben aufrufen,
gelangen Sie standardmäßig auf deren Startseite. Über [.guihint]#HTTP access without URL brings you to#
können Sie alternativ eine installierte
Monitoring-Instanz auswählen, auf die umgeleitet werden soll. Die
Appliance-Startseite erreichen Sie dann über die URL samt Pfadangabe,
also zum Beispiel `192.168.178.60/webconf`.


=== Ausgehende E-Mails konfigurieren

Damit Sie von dem Gerät aus E-Mails verschicken können, z.B. bei Ereignissen
während des Monitorings, muss die Weiterleitung der Mails an einen Ihrer
Mailserver über [.guihint]#Outgoing Emails# konfiguriert werden.

Damit der Mailversand funktioniert, muss mindestens die Hostadresse Ihres
Mailservers als [.guihint]#SMTP-Relay-Server# konfiguriert werden. Dieser Server
nimmt die E-Mails von Ihrem Gerät an und leitet sie weiter.

Die Konfiguration des SMTP-Relay-Servers ist allerdings nur ausreichend,
solange Ihr Mailserver E-Mails über anonymes SMTP akzeptiert. Wenn
Ihr Mailserver eine Authentifizierung voraussetzt, dann müssen Sie unter
dem Punkt [.guihint]#Authentication# die passende Loginmethode aktivieren und die
Zugangsdaten eines Accounts angeben, der sich am Mailserver anmelden kann.

Sollten Sie selbst nach der Konfiguration keine E-Mails erreichen, lohnt
ein Blick in das Systemlog des Gerätes. Hier werden alle Versuche, Mails zu
verschicken, protokolliert.

Das Gerät selbst kann Systemmails verschicken, wenn es kritische Probleme
gibt, z.B. ein Job nicht ausgeführt werden kann oder ein Hardwareproblem
erkannt wurde. Um diese E-Mails zu empfangen, müssen Sie über
[.guihint]#Send local system mails to# eine E-Mail-Adresse konfigurieren, an die diese
Mails verschickt werden sollen.


=== Zugriff auf {CMK}-Agenten anpassen

Auf dem Gerät ist ein {CMK}-Agent installiert, der in der Grundeinstellung
nur vom Gerät selbst abgefragt werden kann. So können Sie die Appliance
selbst in eine auf ihr laufende Monitoring-Instanzen aufnehmen.

Es ist ebenfalls möglich, den {CMK}-Agenten von einem entfernten Gerät aus
erreichbar zu machen, so dass die lokale Appliance auch von einem anderen
{CMK}-System überwacht werden kann, z.B. in einer verteilten Umgebung
von einem zentralen Server. Hierzu können Sie eine Liste von IP-Adressen
konfigurieren, die den {CMK}-Agenten kontaktieren dürfen.


[#ssh]
== Remote-Zugriff über SSH

=== Zugriffsoptionen

Sie können verschiedene Zugriffsarten über das Fernwartungsprotokoll
SSH aktivieren. Grundsätzlich werden

* der Zugriff auf die Konsole und
* der direkte Login in die Instanzen

unterstützt. Der Zugriff auf den Systembenutzer _root_ ist zwar möglich,
wird aber nicht empfohlen bzw. supportet, da es hiermit sehr einfach möglich
ist, die Konfiguration oder die Software zu beschädigen.


=== Instanzlogin über SSH aktivieren

Sie können den Zugriff auf die Kommandozeile der einzelnen
Monitoring-Instanzen aktivieren. Hiermit können Sie die gesamte Umgebung
der Instanz einsehen und steuern.

Dieser Zugriff wird über die link:appliance_usage.html#site_management[Instanzverwaltung]
gesteuert. Im Einstellungsdialog jeder einzelnen Instanz können Sie den
Zugriff aktivieren und deaktivieren sowie ein Passwort zum Schutz des
Zugriffs festlegen.

image::cma_webconf_site_edit_pw_2.png[]


=== Konsole über SSH aktivieren

Es ist möglich, den Zugriff auf die Konsole des Gerätes über das Netzwerk
zu aktivieren. Damit können Sie die Grundkonfiguration des Gerätes auch
ohne direkten Zugriff auf das Gerät einsehen und anpassen.

Sie können den Zugriff über den Konfigurationsdialog der Konsole
freischalten. Wählen Sie dazu den Menüpunkt [.guihint]#Console via SSH#.

image::cma_console_config_ssh_console_2.png[]

Wenn Sie die Option aktivieren, werden Sie zur Eingabe eines Passworts
aufgefordert. Dieses Passwort müssen Sie eingeben, wenn Sie sich als
Benutzer `setup` per SSH verbinden. Direkt nach dem Bestätigen
dieses Dialogs wird der Zugriff automatisch freigeschaltet.

Sie können sich nun als Nutzer `setup` mit Hilfe eines SSH-Clients
(z.B. PuTTY) mit dem Gerät verbinden.

Ob der Zugriff aktuell freigeschaltet ist, können Sie in der Statusansicht der Konsole im Kasten [.guihint]#Access# sehen.


=== root-Zugriff über SSH aktivieren

Es ist möglich, den Zugriff als Systembenutzer `root` auf das Gerät
zu aktivieren. Nach der Initialisierung des Gerätes ist dieser Zugriff jedoch
deaktiviert. Einmal aktiviert, können Sie sich als Benutzer `root`
über SSH am Gerät anmelden.

[{image-left}]
image::cma_caution.png[width=30]

Befehle, die Sie als `root` auf dem Gerät ausführen, können nicht
nur Ihre Daten, sondern auch das ausgelieferte System nachhaltig verändern
oder beschädigen. Der Hersteller haftet nicht für Veränderungen, die
Sie auf diese Art vorgenommen haben. Aktivieren und verwenden Sie den
Benutzer `root` nur, wenn Sie sich sicher sind, was Sie tun und nur
zu Diagnosezwecken.

Sie können den Zugriff über den Konfigurationsdialog der Konsole
freischalten. Wählen Sie dazu den Menüpunkt [.guihint]#Root Access via SSH#.

image::cma_console_config_ssh_root_1_2.png[]

Anschließend setzen Sie die Option auf [.guihint]#enable#.

image::cma_console_config_ssh_root_2_2.png[]

Sobald Sie die Option aktivieren, werden Sie zur Eingabe eines Passworts
aufgefordert. Dieses Passwort müssen Sie eingeben, wenn Sie sich als Benutzer
`root` per SSH verbinden. Direkt nach dem Bestätigen dieses Dialogs
wird der Zugriff automatisch freigeschaltet.

image::cma_console_config_ssh_root_3_2.png[]

Sie können sich nun als Nutzer `root` mit Hilfe eines SSH-Clients
(z.B. PuTTY) mit dem Gerät verbinden.

Ob der Zugriff aktuell freigeschaltet ist, können Sie in der Statusansicht der Konsole im Kasten [.guihint]#Access# sehen.


[#ssl]
== Appliance-GUI per TLS absichern

=== Zugriff über TLS einrichten

Im Auslieferungszustand geschieht der Zugriff auf die Web-Oberfläche Ihres
Gerätes über HTTP im Klartext. Sie können diesen Zugriff per HTTPS
(TLS) absichern, so dass die Daten zwischen Ihrem Browser und dem Gerät
verschlüsselt übertragen werden.

Die Konfiguration erreichen Sie über den Knopf [.guihint]#Web Access# in den
[.guihint]#Device Settings#.


=== Zertifikat installieren

Um den Datenverkehr verschlüsseln zu können, benötigt das Gerät
zunächst ein Zertifikat und einen privaten Schlüssel. Sie haben nun mehrere
Möglichkeiten, wie Sie das Zertifikat installieren können:

* Neues Zertifikat erstellen und mit einer Zertifikatsregistrierungsanforderung von einer Zertifizierungsstelle signieren lassen.
* Existierenden privaten Schlüssel und Zertifikat hochladen.
* Neues Zertifikat erstellen und selbst signieren.

Je nachdem, wie Ihre Anforderungen und Möglichkeiten sind, können Sie eine
der obigen Optionen wählen. Zertifikate, die von Zertifizierungsstellen
signiert sind, haben im Allgemeinen den Vorteil, dass Clients beim Zugriff
automatisch verifizieren können, dass die Gegenstelle (das Gerät)
authentisch ist. Dies ist für offizielle Zertifizierungsstellen in der
Regel sichergestellt.

Wenn ein Nutzer auf die Web-Oberfläche per HTTPS zugreift und das Zertifikat
entweder selbst oder von einer Zertifizierungsstelle signiert ist, der er
nicht vertraut, führt das zunächst zu einer Warnung im Webbrowser.


==== Neues Zertifikat erstellen und signieren lassen

Um ein neues Zertifikat zu erstellen, wählen Sie die Option [.guihint]#New Certificate#.
Im folgenden Dialog geben Sie nun Informationen zu Gerät
und Betreiber ein, die dann in dem Zertifikat hinterlegt werden und sowohl
von der Zertifizierungsstelle als auch später von Clients genutzt werden
können, um das Zertifikat zu verifizieren.

image::cma_webconf_ssl_csr_2.png[]

Nachdem Sie den Dialog mit [.guihint]#Save# bestätigt haben, gelangen Sie
wieder zur Startseite des Bereichs [.guihint]#Web Access# und können die Datei
zur Zertifikatsregistrierungsanforderung (CSR) herunterladen. Diese Datei
müssen Sie Ihrer Zertifizierungsstelle zur Verfügung stellen. Anschließend
bekommen Sie von Ihrer Zertifizierungsstelle ein signiertes Zertifikat
und ggf. eine Zertifikatskette (oft bestehend aus Intermediate- und/oder
Root-Zertifikaten). Diese erhalten Sie üblicherweise in Form von _.pem_-
oder _.crt-Dateien_.

image::cma_webconf_ssl_upload_2.png[]

Das signierte Zertifikat können Sie nun über den Dialog [.guihint]#Upload Certificate#
auf das Gerät übertragen. Wenn Sie eine Zertifikatskette
erhalten haben, können Sie diese ebenfalls über den Dialog hochladen.

Nachdem Sie den Dialog mit [.guihint]#Upload# bestätigt haben, können Sie mit der
Konfiguration der Zugriffswege fortfahren.


==== Neues Zertifikat erstellen und selbst signieren

Um ein neues Zertifikat zu erstellen, wählen Sie die Option [.guihint]#New Certificate#.
Im folgenden Dialog geben Sie nun Informationen zu Gerät und
Betreiber ein, die dann in dem Zertifikat hinterlegt werden und später von
Clients genutzt werden können, um das Zertifikat zu verifizieren.

image::cma_webconf_ssl_self_signed_2.png[]

Beim letzten Punkt [.guihint]#Signing method# wählen Sie nun [.guihint]#Create a self signed certificate#.
Anschließend haben Sie noch die Möglichkeit, die maximale
Laufzeit des Zertifikats zu bestimmen.

Nach dieser Laufzeit müssen Sie ein neues Zertifikat erzeugen. Dies sollte
allerdings rechtzeitig vor Ablauf passieren, damit es keine Probleme beim
Zugriff auf Ihr Gerät gibt.

Nachdem Sie den Dialog mit [.guihint]#Save# bestätigt haben, können Sie mit der
Konfiguration der Zugriffswege fortfahren.


==== Existierendes Zertifikat hochladen

Wenn Sie ein existierendes Zertifikat und einen privaten Schlüssel besitzen,
die Sie zur Absicherung des HTTPS-Verkehrs nutzen wollen, können Sie diese
Dateien über den Dialog [.guihint]#Upload Certificate# auf Ihr Gerät übertragen.

Nachdem Sie den Dialog mit [.guihint]#Upload# bestätigt haben, können Sie mit der
Konfiguration der Zugriffswege fortfahren.


=== Zugriffswege konfigurieren

Nachdem Sie ein Zertifikat installiert haben, können Sie die Zugriffswege
nun entsprechend Ihrer Anforderungen konfigurieren.

Wenn Sie den Zugriff auf Ihr Gerät per HTTPS absichern wollen, empfiehlt sich
die Option [.guihint]#HTTPS enforced (incl. redirect from HTTP to HTTPS)#. Das Gerät
antwortet nur per HTTPS, leitet allerdings alle eingehenden HTTP-Anfragen auf
HTTPS um. Nutzer, die versehentlich direkt oder über Bookmarks per HTTP auf
die Web-Oberfläche zugreifen, werden also automatisch auf HTTPS umgeleietet.

Wenn es Ihnen sehr wichtig ist, dass keine einzige Anfrage im Klartext über
das Netz geht, können Sie die Option [.guihint]#HTTPS only# wählen. Nutzer, die
per HTTP zugreifen, erhalten mit dieser Einstellung eine Fehlermeldung.

Sie können außerdem beide Protokolle über [.guihint]#HTTP and HTTPS# gleichzeitig
aktivieren. Allerdings ist diese Einstellung nur in Ausnahmefällen, zu
Migrationszwecken oder zum Testen, empfehlenswert.

Sollten Sie HTTPS einmal deaktivieren wollen, so können Sie dies mit der
Option [.guihint]#HTTP only# erreichen.


=== Aktuelle Konfiguration/Zertifikate anzeigen

Auf der Seite zur Konfiguration der Zugriffswege können Sie jederzeit die
aktuell aktiven Zugriffswege sowie Informationen zum aktuellen Zertifikat
einsehen.

//SK: Dieses Bild wurde schon vorzeitig ersetzt, weil das bisherige Bild größer als 1 MB war.
[{image-border}]
image::cma_webconf_ssl_info_2.png[]

== Steuerung des Gerätes

=== Neustarten/Herunterfahren

Das Gerät können Sie sowohl über die Web-Oberfläche als auch über die
Konsole neu starten bzw. herunterfahren.

In der Web-Oberfläche finden Sie die Menüpunkte [.guihint]#Reboot Device#
bzw. [.guihint]#Shutdown Device# unterhalb des Punkts [.guihint]#Control Device# im
Hauptmenü. Das Gerät führt die Aktion unmittelbar nach der Auswahl des
Befehls aus.

image::cma_webconf_control_2.png[]

In der Konsole erreichen Sie das Menü zur Steuerung des Gerätes durch einen
Druck auf `F2`.

image::cma_console_actions_2.png[]

[{image-left}]
image::cma_caution.png[width=30]

Sie sollten Ihre rail2-Appliance nur herunterfahren, wenn Sie physikalischen
Zugriff auf das System haben, da Sie das Gerät nur durch Trennen und
Wiederherstellen der Stromzufuhr wieder einschalten können.


=== Werkskonfiguration wiederherstellen

Sie können Ihr Gerät auf die Werkseinstellungen zurücksetzen. Das bedeutet,
dass alle Änderungen, die Sie am Gerät vorgenommen haben, z.B. Ihre
Geräteeinstellungen, Monitoringkonfiguration oder die erfassten Statistiken
und Logs, gelöscht werden. Beim Zurücksetzen der Einstellungen bleibt die
aktuell installierte Firmware-Version erhalten, die bei der Auslieferung
des Gerätes installierte Firmware wird nicht wiederhergestellt.

Diese Aktion können Sie auf der Konsole durchführen. Drücken Sie dazu
in der Statusansicht die Taste `F2` und wählen Sie im folgenden
Dialog [.guihint]#Factory Reset# und bestätigen Sie den darauf folgenden Dialog mit
[.guihint]#yes#. Nun werden Ihre Daten vom Gerät gelöscht und direkt im Anschluss
wird ein Neustart des Gerätes ausgeführt. Das Gerät startet nun mit einer
frischen Konfiguration.


[#cma_backup]
== Datensicherung

=== Grundlagen

Damit Ihre Monitoring-Daten im Falle eines Hardwaredefekts oder einer
andersartigen Zerstörung gesichert sind, können Sie über die Web-Oberfläche
Ihres Gerätes die Sicherung Ihrer Daten konfigurieren.

Um die Daten wirklich zu sichern, müssen Sie auf einem anderen Gerät,
z.B. einem Fileserver, abgelegt werden. Hierzu konfigurieren Sie zunächst
über die link:appliance_usage.html#cma_mounts[Dateisystemverwaltung] die für die Sicherung zu nutzende
Netzwerkfreigabe. Diese richten Sie anschließend in der Konfiguration
der Datensicherung als Sicherungsziel ein. Sobald Sie dies gemacht haben,
können Sie einen Sicherungs-Job anlegen, der dann im festgelegten Intervall
eine Datensicherung Ihres Gerätes auf der Netzwerkfreigabe ablegt.

Die volle Datensicherung beinhaltet alle von Ihnen auf dem Gerät getätigten
Konfigurationen, installierte Dateien sowie Ihre Monitoring-Instanzen.

Die Datensicherung wird während des Betriebs (online) durchgeführt. Dies
ist allerdings erst vollständig möglich, wenn alle Monitoring-Instanzen
auf dem Gerät mindestens {CMK} 1.2.8p6, 1.4.0i1 oder einen Daily-Build ab
dem 22.07.2016 nutzen. Laufende Instanzen, die ältere Versionen einsetzen,
werden vor der Sicherung gestoppt und anschließend wieder gestartet.


=== Automatische Sicherung

Um eine automatische Datensicherung einzurichten, konfigurieren Sie einen
oder mehrere Sicherungs-Jobs. Pro Sicherungs-Job wird auf dem Sicherungsziel
eine Datensicherung abgelegt. Beim Abschluss der Folgesicherung wird die
vorherige Sicherung gelöscht. Das bedeutet, dass Sie auf dem Zielsystem
temporär mit dem doppelten Speicherbedarf rechnen müssen.

Die Sicherung kümmert sich nicht um die Verwaltung mehrerer Generationen. Wenn
Sie also von einem Sicherungs-Job mehrere Kopien über längere Zeiträume
aufheben wollen, müssen Sie diese selbst anlegen.


=== Konfiguration der Sicherung

Konfigurieren Sie mit Hilfe der link:appliance_usage.html#cma_mounts[Dateisystemverwaltung] zunächst
Ihre Netzwerkfreigaben. Hier im Beispiel ist eine Netzwerkfreigabe unter
dem Pfad `/mnt/auto/backup` konfiguriert.

Wählen Sie nun aus dem Hauptmenü der Web-Oberfläche den Punkt [.guihint]#Device backup#
und öffnen Sie von dort aus die Backup-Ziele über [.guihint]#Backup targets#.
Erzeugen Sie nun über [.guihint]#New backup target# ein neues Ziel. Die
ID und den Titel können Sie frei wählen. Unter dem Punkt [.guihint]#Directory to save the backup to#
konfigurieren Sie den Pfad der eingehängten Netzwerkfreigabe,
hier `/mnt/auto/backup`. Die Option [.guihint]#Is mountpoint# sollte aktiv sein,
wenn Sie auf eine Netzwerkfreigabe sichern. Damit prüft die Datensicherung
vor der Speicherung, ob die Netzwerkfreigabe auch wirklich eingehängt ist.

image::cma_de_backup_target_new_2.png[]

Nachdem Sie das Sicherungsziel angelegt haben, gehen Sie zurück auf die
Seite [.guihint]#Device backup# und wählen dort [.guihint]#New job# aus. Hier können Sie
wieder eine ID und einen Titel wählen. Wählen Sie dann das soeben angelegte
Sicherungsziel aus und legen Sie das gewünschte Ausführungsintervall der
Sicherung fest.

image::cma_de_backup_job_new_2.png[]

Nach dem Speichern sehen Sie auf der Seite [.guihint]#Device backup# einen Eintrag für
Ihren neuen Sicherungs-Job. Hier wird Ihnen am Ende der Zeile der Zeitpunkt
der nächsten Ausführug angezeigt. Sobald der Job läuft, bzw. abgeschlossen
ist, wird Ihnen in dieser Ansicht der Status angezeigt. Hier können Sie
den Job auch manuell starten bzw. laufende Sicherungen abbrechen.

image::cma_de_backup_job_list_2.png[]

Starten Sie nun testweise Ihren soeben eingerichteten Job durch einen Klick
auf das _Play_-Icon. Sie sehen nun in der Tabelle, dass der Job aktuell
ausgeführt wird. Mit einem Klick auf das _Log_-Icon können Sie sich
den Fortschritt des Jobs in Form der Log-Ausgaben anzeigen lassen.

[{image-border}]
image::cma_de_backup_job_log_2.png[]

Sobald die Sicherung abgeschlossen ist, wird dies ebenfalls in der Tabelle
angezeigt.

[{image-border}]
image::cma_de_backup_list_complete_2.png[]


=== Format der Sicherung

Jeder Sicherungs-Job erzeugt auf dem Sicherungsziel ein Verzeichnis. Dieses
Verzeichnis wird nach folgendem Schema benannt:

* Gerätesicherungen: `{CMK}_Appliance-[HOSTNAME]-[LOCAL_JOB_ID]-[STATE]`
* Instanzsicherungen: `{CMK}-[HOSTNAME]-[SITE]-[LOCAL_JOB_ID]-[STATE]`

In den Platzhaltern werden die Bindestriche jeweils durch _+_-Zeichen
ersetzt, damit die einzelnen Felder auseinander gehalten werden können.

Während der Sicherung wird in das Verzeichnis mit dem Suffix
`-incomplete` gesichert. Bei Abschluss der Sicherung wird dieses
Vezeichnis umbenannt und das Suffix zu `-complete` geändert.

In dem Verzeichnis liegt eine Datei `mkbackup.info`, die
Metainformationen zu der Sicherung enthält. Neben dieser Datei werden
mehrere Archive in dem Verzeichnis abgelegt.

Das Archiv mit dem Namen `system` enthält die Gerätekonfiguration,
`system-data` enthält die Daten des Datendateisystems exklusive der
Monitoring-Instanzen. Die Monitoring-Instanzen sind in separaten Archiven
nach dem Namensschema `site-[SITENAME]` gespeichert.

Je nach Modus der Sicherung werden diese Dateien mit den Dateiendungen
`.tar` für unkomprimierte und unverschlüsselte, `.tar.gz`
für komprimierte aber unverschlüsselte und `.tar.gz.enc` für
komprimierte und verschlüsselte Archive gespeichert.


[#encryption]
=== Verschlüsselung

Wenn Sie Ihre Datensicherung verschlüsseln wollen, können Sie dies
direkt aus der Web-Oberfläche heraus konfigurieren. Ihre gesicherten
Dateien werden hierbei vor der Übertragung auf das Sicherungsziel komplett
verschlüsselt. Die Verschlüsselung geschieht mit einem zuvor angelegten
Sicherungsschlüssel. Dieser Schlüssel ist durch ein Passwort geschützt, das
Sie beim Anlegen des Schlüssels festlegen und zusammen mit dem Schlüssel
gut verwahren müssen, da nur damit die Wiederherstellung der Sicherung
möglicht ist.

Öffnen Sie hierzu die Seite [.guihint]#Device backup# und wählen Sie von dort
aus die Seite [.guihint]#Backup keys#. Erzeugen Sie hier von hier aus einen neuen
Sicherungsschlüssel. Bei der Angabe des Passworts sollten Sie auf genügend
Komplexität achten.

image::cma_de_backup_key_new_2.png[]

Nachdem Sie den Schlüssel erzeugt haben, laden Sie ihn herunter und verwahren
Sie ihn an einem sicheren Ort.

[{image-left}]
image::cma_important.png[width=30]

Eine verschlüsselte Sicherung kann nur mit dem Sicherungsschlüssel und
dem dazugehörigen Passwort wiederhergestellt werden.

Editieren Sie nun von der Seite [.guihint]#Device backup# aus den Sicherungs-Job,
der verschlüsselte Sicherungen erzeugen soll, aktivieren Sie dort den Punkt
[.guihint]#Encryption# und wählen Sie den soeben angelegten Sicherungsschlüssel aus.

image::cma_de_backup_job_edit_encrypt_2.png[]

Nachdem Sie den Dialog bestätigt haben, wird die nächste Sicherung
automatisch verschlüsselt.


=== Komprimierung

Es ist möglich, die gesicherten Daten während des Kopiervorgangs zu
komprimieren. Dies kann nützlich sein, wenn Sie Bandbreite sparen müssen
oder auf dem Zielsystem nur begrenzt Platz haben.

Bitte beachten Sie jedoch, dass die Komprimierung deutlich mehr CPU-Zeit
erfordert und daher den Vorgang der Sicherung verlängert. In der Regel ist
es empfehlenswert, die Komprimierung nicht zu aktivieren.

[{image-left}]
image::cma_tip.png[width=30]

Die nicht komprimierte Sicherung wird erst ab {CMK}-Version 1.2.8p5
unterstützt. Wenn Sie Monitoring-Instanzen mit älteren Versionen betreiben,
müssen Sie die Komprimierung der gesamten Sicherung aktivieren.



=== Wiederherstellung

Eine Datensicherung können Sie über die in der Web-Oberfläche eingebauten
Mechanismen nur komplett wiederherstellen. Die Wiederherstellung einzelner
Dateien über die Web-Oberfläche ist nicht vorgesehen. Dies ist jedoch
über die Kommandozeile durch manuelles Auspacken aus der Sicherung möglich.

Wenn Sie eine komplette Sicherung auf einem laufenden Gerät wiederherstellen
wollen, wählen Sie auf der Seite [.guihint]#Device backup# den Punkt [.guihint]#Restore#
und auf der Folgeseite das Sicherungsziel, von dem Sie die Sicherung
wiederherstellen wollen. Nach der Auswahl des Sicherungsziels bekommen Sie
alle dort vorhandenen Sicherungen aufgelistet.

image::cma_de_backup_restore_list_2.png[]

Klicken Sie nun bei der Sicherung, die Sie wiederherstellen wollen,
auf den Pfeil, um die Wiederherstellung zu starten. Nach einer
Sicherheitsabfrage startet die Wiederherstellung und Sie landen wieder auf
der [.guihint]#Restore#-Startseite. Durch Aktualisierung der Seite können Sie den
aktuellen Status nachvollziehen.

image::cma_de_backup_restore_log_2.png[]

Im Anschluss an die Wiederherstellung startet Ihr Gerät automatisch neu. Nach
dem Neustart ist die Wiederherstellung abgeschlossen.


==== Desaster Recovery

Wenn Sie ein Gerät komplett neu wiederherstellen müssen, läuft das Desaster
Recovery in folgenden Schritten ab:

* Sie starten mit einem Gerät im Werkszustand (neues, baugleiches oder auf Werkszustand zurückgesetztes Gerät).
* Stellen Sie sicher, dass die Firmware-Version mit der Version der Sicherung übereinstimmt.

Konfigurieren Sie an der Konsole mindestens folgende Einstellungen:

* Netzwerkeinstellungen.
* Zugriff auf Web-Oberfläche.

Konfigurieren Sie in der Web-Oberfläche:

* Wählen Sie das Sicherungsziel, von dem Sie wiederherstellen wollen.
* Laden Sie ggf. den Sicherungsschlüssel für gesicherte Datensicherungen hoch.

Zum Abschluss starten Sie dann die Wiederherstellung wie im vorherigen
Kapitel beschrieben.


=== Monitoring

Für jeden konfigurierten Sicherungs-Job findet das [.guihint]#Service Discovery#
von {CMK} ab Version 1.4.0i1 auf dem Gerät einen neuen Service [.guihint]#Backup [JOB-ID]#.
Dieser Service informiert Sie über eventuelle Probleme bei der
Sicherung und zeichnet hilfreiche Messwerte wie Größe und Dauer auf.


=== Besonderheiten im Cluster

Die gesamte Konfiguration der Datensicherung inkl. Sicherungsschlüssel wird
zwischen den Cluster-Knoten synchronisiert. Die Cluster-Knoten führen Ihre
Datensicherung voneinander getrennt aus, erstellen also im Sicherungsziel
auch separate Verzeichnisse für die Sicherung.

Der aktive Cluster-Knoten sichert das komplette Gerät inklusive der Daten
des Datendateisystems und der Monitoring-Sites. Der inaktive Cluster-Knoten
sichert nur seine lokale Gerätekonfiguration.

Bei der Wiederherstellung einer Sicherung kann demnach auch nur die Sicherung
des aktiven Cluster-Knotens die Monitoring-Instanzen wiederherstellen.


[#cma_mounts]
== Einbinden von Netzwerkdateisystemen

=== Einleitung

Wenn Sie eine link:appliance_usage.html#cma_backup[Datensicherung] auf eine Netzwerkfreigabe
machen möchten, müssen Sie zunächst das gewünschte Netzwerkdateisystem
konfigurieren.

Aktuell werden die Netzwerkdateisysteme NFS in Version 3 und
Windows-Netzwerkfreigaben (Samba bzw. CIFS) sowie SSHFS (SFTP) unterstützt.


=== Ein Netzwerkdateisystem einbinden

Wählen Sie aus dem Hauptmenü der Web-Oberfläche den Punkt [.guihint]#Manage mounts#
und legen Sie von dort aus ein neues Dateisystem über [.guihint]#New mount# an. Geben
Sie hier eine ID ein, die später zur Identifizierung des Dateisystems
genutzt wird.

image::cma_de_mount_new_2.png[]

Wählen Sie dann ob und wie das Dateisystem eingebunden werden soll. Empfohlen
wird hier das automatische Einbinden bei Zugriff bzw. automatische Aushängen
bei Inaktivität.

Konfigurieren Sie dann noch, welchen Freigabetyp Sie einbinden wollen und
anschließend, davon abhängig, die nötigen Einstellungen zum Einbinden der
Freigabe, wie z.B. die Netzwerkadresse des Fileservers und den exportierten
Pfad im Falle von NFS.

Nach dem Speichern sehen Sie in der Dateisystemverwaltung das soeben
konfigurierte Dateisystem und den aktuellen Zustand. Mit einem Klick auf
den Stecker können Sie nun das Dateisystem manuell einhängen um zu testen,
ob die Konfiguration korrekt ist.

image::cma_de_mount_list_2.png[]

Sollte es Probleme geben, können Sie eventuelle Fehlermeldungen im Systemlog
finden.


== Failover Cluster

=== Grundlagen

Sie können zwei {CMK}-Appliances zu einem Failover-Cluster
zusammenschließen. Dabei werden alle Konfigurationen und Daten zwischen
den beiden Geräten abgeglichen. Die Geräte, die als Cluster verbunden sind,
nennt man auch Knoten. Einer der Knoten im Cluster übernimmt die aktive Rolle,
führt also die Aufgaben des Clusters aus. Beide Knoten tauschen sich dauerhaft
über ihren Zustand aus. Sobald der inaktive Knoten erkennt, dass der aktive
Knoten seine Aufgaben nicht mehr erfüllen kann, z.B. aufgrund eines Ausfalls,
übernimmt der inaktive Knoten die Aufgaben und wird zum aktiven Knoten.

Der Failover-Cluster ist dazu da, die Verfügbarkeit Ihrer
Monitoring-Installation zu erhöhen, indem diese gegen Hardwareausfälle
eines Gerätes oder einzelner Komponenten abgesichert wird. Die Clusterung
ersetzt keine Datensicherung.

In den folgenden Situationen sorgt der Cluster für eine geringere Ausfallzeit:

* Wenn das RAID in einer {CMK} rack1 oder die SD-Karte in einer {CMK} rail2 nicht mehr zugreifbar sind, übernimmt der inaktive Knoten die Ressourcen.
* Wenn das bisher aktive Gerät nicht mehr erreichbar (ausgefallen) ist, übernimmt der inaktive Knoten die Ressourcen.
* Wenn das bisher aktive Gerät das „externe“ Netzwerk nicht mehr erreichen kann und im Gegensatz dazu der inaktive Knoten eine Verbindung zu diesem Netzwerk hat, übernimmt der inaktive Knoten die Ressourcen.
* Wenn Sie ein Firmware-Update durchführen, können Sie die Knoten einzeln aktualisieren. Während der Aktualisierung des einen Knotens führt der andere Knoten das Monitoring weiter durch.


=== Voraussetzungen

Damit Sie einen Cluster aufbauen können, brauchen Sie zunächst zwei
kompatible {CMK}-Appliances. Folgende Modelle können miteinander geclustert
werden:

* 2 x {CMK} rack1
* 2 x {CMK} rack4
* 2 x {CMK} rail2
* 2 x {CMK} virt1
* 1 x {CMK} rack1 und 1x {CMK} virt1

Weiterhin müssen die beiden Geräte eine link:appliance_usage.html#cma_webconf_firmware[kompatible Firmware]
nutzen, mindestens aber die Version _1.1.0_.

Die Geräte müssen mit mindestens zwei voneinander unabhängigen
Netzwerkverbindungen verkabelt sein. Es wird empfohlen, möglichst eine
direkte Verbindung zwischen den Geräten zu verwenden und eine weitere
Verbindung über Ihr LAN herzustellen.

Um die Verfügbarkeit der Netzwerkverbindungen zu erhöhen, sollten Sie statt
zwei Verbindungen über einzelne Netzwerkanschlüsse eine Bonding-Konfiguration
erstellen, die alle vier Netzwerkanschlüsse der {CMK} rack1 nutzt.
Dabei verwenden Sie die Schnittstellen `LAN1` und `LAN2`
für den Anschluss an Ihr Netzwerk und die Schnittstellen `LAN3`
und `LAN4` für die direkte Verbindung zwischen der Geräten.

*Virtuelle Maschinen:* Wenn Sie die Cluster-Funktion mit zwei „{CMK}
virt1“-Appliances und VirtualBox durchführen wollen, beispielsweise
zum Testen, sollten Sie auf die Bonding-Konfiguration mit insgesamt
vier Netzwerkschnittstellen verzichten -- das wird unter VirtualBox zum
Glücksspiel, so es denn überhaupt funktioniert. Selbst wenn beide VMs auf
demselben Rechner laufen und es entsprechend nicht mehrere Hardware-Leitungen
gibt, benötigen Sie dennoch zwei virtuelle Netzwerkschnittstellen, um später
einen separaten Kanal zum Synchronisieren der Daten einzurichten. Diese
können Sie ganz simpel in der Managementoberfläche von VirtualBox der
virt1-Maschine hinzufügen.

Statt also wie im Folgenden gezeigt das Bonding einzurichten, aktivieren
Sie einfach die ungenutzte zweite Netzwerkschnittstelle -- allerdings nicht
für Ihr normales LAN-Subnetz (etwa 192.168.178.0/24), sondern ein separates
Subnetz (etwa 192.168.100.0/24). Beim eigentlichen Clustern wählen Sie
dann schlicht Ihre beiden einzelnen Schnittstellen statt der gebündelten
Bonding-Schnittstellen.


=== Migration bestehender Installationen

Geräte, die mit der Firmware-Version _1.1.0_ oder neuer ausgeliefert
und initialisiert wurden, können ohne Migration geclustert werden.

Geräte, die mit einer älteren Firmware initialisiert wurden,
müssen zunächst auf die Version _1.1.0_ oder neuer aktualisiert
werden. Anschließend müssen die Werkseinstellungen des Gerätes
wiederhergestellt werden, dadurch wird das Gerät für die Clusterung
vorbereitet. Bitte beachten Sie, dass Sie, um Datenverlust zu vermeiden,
vorher Ihre Daten von dem Gerät sichern und anschließend wieder herstellen
müssen.


=== Konfiguration des Clusters

Diese Anleitung geht davon aus, dass Sie beide Geräte bereits so weit
vorkonfiguriert haben, dass Sie die Web-Oberfläche mit einem Webbrowser
öffnen können.

Vor der eigentlichen Einrichtung des Clusters müssen Sie zunächst
beide Geräte vorbereiten. Dabei müssen Sie hauptsächlich die
Netzwerkkonfiguration so anpassen, dass die Anforderungen der Clusterung
erfüllt werden (siehe Voraussetzungen).

Im Folgenden wird die Konfiguration eines Clusters mit zwei {CMK} rack1
gezeigt. Dabei wird ein Cluster aufgebaut, der folgendem Schaubild entspricht.

Die im Schaubild verwendeten Schnittstellenbezeichnungen [.guihint]#LAN1#, [.guihint]#LAN2#
usw. entsprechen den Bezeichnungen der physikalischen Schnittstellen am
Gerät. Im Betriebssystem entspricht [.guihint]#LAN1# dem Gerät [.guihint]#eth0#, [.guihint]#LAN2#
dem Gerät [.guihint]#eth1# usw.

image::cluster.png[]

Diese Konfiguration entspricht den Empfehlungen für die Clusterung von zwei
{CMK} rack1. Sie können in Ihrer Umgebung selbstverständlich IP-Adressen
verwenden, die in Ihre Umgebung passen. Achten Sie jedoch darauf, dass das
interne Cluster-Netz ([.guihint]#bond1# im Schaubild) ein anderes IP-Netz verwendet,
als das „externe“ Netz ([.guihint]#bond0# im Schaubild).


==== Netzwerkkonfiguration

Öffnen Sie die Web-Oberfläche des ersten Knotens, wählen Sie die
Geräteeinstellungen und oben [.guihint]#Network Settings#. Sie befinden Sich jetzt
auf der Seite zur Konfiguration der Netzwerkeinstellungen. Hier stehen Ihnen
zwei Modi zur Verfügung. Der [.guihint]#Simple Mode#, mit dem Sie nur [.guihint]#LAN1#
Ihres Gerätes konfigurieren können, ist standardmäßig aktiviert.

image::cma_de_net_1_2.png[]

Für die Clusterung wird der _erweiterte Modus_ benötigt. Um diesen
Modus zu aktivieren, klicken Sie oben auf die Schaltfläche [.guihint]#Advanced Mode#
und bestätigen Sie die Sicherheitsabfrage.

Auf der folgenden Seite werden Ihnen alle im Gerät verfügbaren
Netzwerkschnittstellen angezeigt. Nur die Standardschnittstelle, auf den Racks
[.guihint]#eth0# (entspricht [.guihint]#LAN1#), hier im Screenshot _enp0s17_, hat aktuell
eine Konfiguration. Diese wurde vom _einfachen Modus_ übernommen.

image::cma_de_net_2_3.png[]

Erstellen Sie nun durch Klick auf [.guihint]#Create Bonding# die erste
Bonding-Schnittstelle [.guihint]#bond0#. Tragen Sie dazu im darauf folgenden Dialog
alle Daten entsprechend des folgenden Schaubilds ein und bestätigen Sie
den Dialog mit [.guihint]#Save#.

image::cma_de_net_3_2.png[]

Erstellen Sie nun die zweite Bonding-Schnittstelle [.guihint]#bond1# mit der passenden
Konfiguration.

image::cma_de_net_4_2.png[]

Nachdem Sie die beiden Bonding-Schnittstellen erstellt haben, sehen Sie im
Dialog zur Netzwerkkonfiguration noch einmal alle getätigten Einstellungen
zu den Netzwerkschnitstellen ...

image::cma_de_net_5_a.png[]

&#8230; sowie zu den erstellten Bondings:

image::cma_de_net_5_b.png[]

Wenn Sie alle Schritte zur Konfiguration erfolgreich abgeschlossen haben,
machen Sie die Einstellungen mit einem Klick auf [.guihint]#Activate Changes#
wirksam. Daraufhin werden die neuen Netzwerkeinstellungen geladen. Nach
wenigen Sekunden zeigt die Netzwerkkonfiguration überall den Status OK,
bei den echten Netzwerkschnittstellen ...

image::cma_de_net_6_a.png[]

&#8230; sowie wiederum den Bondings:

image::cma_de_net_6_b.png[]

Wiederholen Sie die Konfiguration der Netzwerkeinstellungen mit den passenden
Einstellungen nun auch auf Ihrem zweiten Gerät.


==== Hostnamen

Geräte, die in einem Cluster verbunden werden sollen, müssen
unterschiedliche Hostnamen haben. Diese können Sie jetzt in den
link:appliance_usage.html#cma_webconf_system_settings[Geräteeinstellungen] festlegen. Im Beispiel
bekommen die Geräte die Namen `node1` und `node2`.


==== Verbinden des Clusters

Nachdem Sie nun die Vorbereitungen abgeschlossen haben, können Sie mit dem
Einrichten des Clusters fortfahren. Öffnen Sie dazu in der Web-Oberfläche im
Hauptmenü des ersten Gerätes (hier `node1`) das Modul [.guihint]#Clustering#
und klicken Sie dort auf [.guihint]#Create Cluster#.

Tragen Sie im Dialog zum Erstellen des Clusters nun die entsprechende
Konfiguration ein und bestätigen Sie den Dialog mit [.guihint]#Save#. Wenn Sie zu
diesem Dialog weiterführende Informationen benötigen, klicken Sie oben
rechts auf das Icon neben dem {CMK}-Logo. Daraufhin erscheint im Dialog eine
Kontexthilfe, die die einzelnen Optionen erläutert.

image::cma_de_cluster_1_2.png[]

Auf der folgenden Seite können Sie die beiden Geräte zu einem Cluster
verbinden. Hierzu müssen Sie das Passwort der Web-Oberfläche des zweiten
Gerätes eingeben. Dieses wird einmalig dazu genutzt; die Verbindung
zwischen den beiden Geräten herzustellen. Bestätigen Sie anschließend
die Sicherheitsabfrage, wenn Sie sich sicher sind, dass Sie die Daten des
Zielgerätes mit der angezeigten IP-Adresse überschreiben wollen.

image::cma_de_cluster_2_2.png[]

Nachdem dieser Verbindungsaufbau erfolgreich war, wird mit der Einrichtung
des Clusters begonnen. Den aktuellen Status können Sie sich auf der
Cluster-Seite anzeigen lassen. Sobald der Cluster erfolgreich aufgebaut
wurde, startet die Synchronisation der Monitoring-Daten vom ersten zum
zweiten Knoten. Noch während dieser Synchronisation werden alle Ressourcen,
u.a. auch Ihre möglicherweise bestehenden Monitoring-Instanzen, auf dem
ersten Knoten gestartet.

image::cma_de_cluster_4_2.png[]

Ab Sofort können Sie mit Hilfe der Cluster-IP-Adresse (hier
`192.168.178.110`) auf die Ressourcen des Clusters, z.B. Ihre
Monitoring-Instanzen, zugreifen -- egal von welchem Knoten die Ressourcen
gerade gehalten werden.


=== Der Status des Clusters

Nach Abschluss der ersten Synchronisation ist Ihr Cluster voll
einsatzbereit. Auf der Cluster-Seite können Sie den Zustand jederzeit
einsehen.

//SK: Ausnahmsweise wird hier ein jpeg verwendet, weil das Bild als png größer als 1 MB ist.
image::cma_de_cluster_5_2.jpeg[]

Auch mit Hilfe der Statusansicht der Konsole können Sie den aktuellen
Zustand des Clusters im Kasten [.guihint]#Cluster# in zusammengefasster Form einsehen.
Die Rolle des jeweiligen Knotens wird hinter dem aktuellen Status mit
[.guihint]#(M)# für den Main Host und [.guihint]#(S)# für den Subordinate Host dargestellt.

image::cma_de_cluster_6_2.png[]


=== Besonderheiten im Cluster

==== Zugriff auf Ressourcen

Alle Anfragen an die Monitoring-Instanzen, wie z.B. Zugriffe auf die
Web-Oberfläche, aber auch eingehende Meldungen, wie z.B. SNMP-Traps oder
Syslog-Meldungen an die Event-Console oder Anfragen an Livestatus, sollten
im Normalfall immer über die Cluster-IP-Adresse gehen.

Nur in Ausnahmefällen, wie z.B. Fehlerdiagnosen oder Updates eines bestimmen
Knotens, sollten Sie direkt auf die einzelnen Knoten zugreifen müssen.


==== Geräteeinstellungen

Die Einstellungen, wie z.B. Zeitsynchronisation oder Einstellungen zur
Namensauflösung, die bisher auf den einzelnen Geräten unabhängig voneinander
gemacht wurden, werden im Cluster zwischen den beiden Knoten synchronisiert.

Sie können diese Einstellungen aber nur auf dem jeweils aktiven Knoten
bearbeiten. Auf dem inaktiven Knoten sind die Einstellungen gesperrt.

Es gibt einige gerätespezifische Einstellungen, wie z.B. die des
Management-Interfaces des {CMK} rack1, die Sie zu jeder Zeit auf den einzelnen
Geräten anpassen können.


==== IP-Addressen oder Hostnamen der Knoten

Um die IP-Konfiguration der einzelnen Knoten bearbeiten zu können, müssen Sie
zunächst die Verbindung zwischen den Knoten lösen. Hierzu klicken Sie auf der
Cluster-Seite auf [.guihint]#Disconnect Cluster#. Anschließend können Sie über die
Web-Oberfläche der einzelnen Knoten die gewünschten Einstellungen anpassen.

Nachdem Sie die Anpassungen abgeschlossen haben, müssen Sie nun auf der
Cluster-Seite [.guihint]#Reconnect Cluster# wählen. Wenn sich die Knoten erfolgreich
wieder verbinden können, nimmt der Cluster nach wenigen Minuten den Betrieb
wieder auf. Den Status können Sie auf der Cluster-Seite einsehen.


==== {CMK}-Versionen und Monitoring-Instanzen verwalten

Auch die Monitoring-Instanzen und {CMK}-Versionen werden zwischen den
beiden Knoten synchronisiert. Diese können Sie nur in der Web-Oberfläche
des aktiven Knotens modifizieren.

Wenn Sie hierfür ebenfalls direkt auf die Cluster-IP-Adresse zugreifen,
kommen Sie immer auf das Gerät, mit dem Sie diese Dinge konfigurieren können.


=== Administrative Aufgaben

==== Firmware-Update im Cluster

Die Firmware-Version eines Gerätes wird auch im Cluster-Betrieb nicht
synchronisiert. Das Update geschieht also pro Knoten. Sie haben jedoch den
Vorteil, dass der eine Knoten weiterhin das Monitoring durchführen kann,
während der andere Knoten aktualisiert wird.

Bei einem Update auf eine kompatible Firmware-Version sollten Sie stets wie
folgt vorgehen:

Öffnen Sie zunächst das Modul [.guihint]#Clustering# in der Web-Oberfläche des
Knotens, der aktualisiert werden soll.

Klicken Sie nun auf das Herz-Symbol in der Spalte dieses Knotens und
bestätigen Sie die folgende Sicherheitsabfrage. Dadurch setzen Sie den
Knoten in den Wartungszustand.

Knoten, die sich im Wartungszustand befinden, geben alle Ressourcen frei,
die aktuell auf dem Knoten aktiv sind, woraufhin der andere Knoten diese
übernimmt.

Während sich ein Knoten im Wartungszustand befindet, ist der Cluster nicht
ausfallsicher. Wenn jetzt also der aktive Knoten ausgeschaltet wird,
übernimmt der inaktive Knoten, der sich im Wartungszustand befindet,
_nicht_ die Ressourcen. Sollten Sie nun auch noch den zweiten Knoten
in den Wartungszustand setzen, werden alle Ressourcen heruntergefahren. Diese
werden erst wieder aktiviert, wenn ein Knoten aus dem Wartungszustand geholt
wird. Den Wartungszustand müssen Sie stets wieder manuell entfernen.

Wenn die Cluster-Seite Folgendes zeigt, sehen Sie, dass sich der Knoten im
Wartungszustand befindet.

image::cma_de_cluster_7_2.png[]

Nun können Sie auf diesem Knoten, wie auf allen betriebenen Geräten auch,
das link:appliance_usage.html#cma_webconf_firmware[Firmware-Update] durchführen.

Öffnen Sie, nachdem Sie das Firmware-Update erfolgreich durchgeführt
haben, wieder die Cluster-Seite und entfernen Sie den Wartungszustand des
aktualisierten Gerätes. Das Gerät fügt sich anschließend automatisch in
den Cluster-Betrieb ein, womit der Cluster wieder voll funktionsfähig ist.

image::cma_de_cluster_5_2.png[]

Es wird empfohlen auf beiden Knoten die gleiche Firmware-Version zu betreiben,
also sollten Sie im Anschluss die gleiche Prozedur für den anderen Knoten
wiederholen.


==== Cluster auflösen

Es ist möglich, die Knoten aus einem Cluster zu lösen und einzeln weiter
zu betreiben. Dabei können Sie auf beiden Geräten die synchronisierte
Konfiguration weiter nutzen, oder z.B. eines der Geräte wieder auf den
Werkszustand zurücksetzen und neu konfigurieren.

Sie können einen oder beide Knoten im laufenden Betrieb aus dem Cluster
entfernen. Wenn Sie beide Knoten mit den aktuellen Daten weiterverwenden
wollen, müssen Sie vorher sicherstellen, dass die Synchronisation der Daten
ordnungsgemäß funktioniert. Dies sehen Sie auf der Cluster-Seite.

Um einen Cluster aufzulösen, klicken Sie auf der Cluster-Seite der
Web-Oberfläche auf [.guihint]#Disband Cluster#. Beachten Sie den Text der folgenden
Sicherheitsabfrage. Dieser gibt in den verschiedenen Situationen Aufschluss
darüber, in welchem Zustand sich das jeweilige Gerät nach dem Auflösen
der Verbindung befinden wird.

image::cma_de_cluster_8_2.png[]

Die Trennung der Geräte muss auf beiden Knoten separat durchgeführt werden,
damit zukünftig beide Geräte einzeln betrieben werden können.

Wenn Sie nur eines der Geräte zukünftig verwenden wollen, lösen Sie den
Cluster auf dem Gerät, das Sie weiterhin verwenden wollen und stellen Sie
auf dem anderen Gerät anschließend den Werkszustand wieder her.

Nachdem Sie einen Knoten aus dem Cluster getrennt haben, werden die
Monitoring-Instanzen nicht automatisch gestartet. Das müssen Sie im Anschluss
bei Bedarf manuell erledigen.


==== Ein Gerät austauschen

Wenn die Festplatten des alten Gerätes in Ordnung sind, können Sie diese
aus dem alten Gerät in das neue Gerät einbauen und das neue Gerät
genau so verkabeln, wie das alte Gerät verkabelt war und es anschließend
einschalten. Nach dem Start fügt sich das neue Gerät wieder so in den
Cluster ein wie das alte Gerät.

Wenn Sie ein altes Gerät komplett durch ein neues Gerät ersetzen wollen,
sollten Sie so vorgehen, wie wenn Sie den Cluster komplett auflösen (siehe
vorheriges Kapitel). Wählen Sie dazu eines der bisherigen Geräte aus,
lösen Sie dieses Gerät aus dem Cluster und erstellen Sie einen neuen
Cluster mit diesem und dem neuen Gerät.


=== Fehlerdiagnose und -behebung

==== Logging

Die Cluster-Verwaltung geschieht weitestgehend automatisch. Dabei entscheiden
automatische Prozesse auf den Knoten, auf welchem Gerät welche Ressourcen
gestartet und gestoppt werden sollen. Dieses Verhalten wird in Form von
Logeinträgen detailliert protokolliert. Diese Einträge erreichen Sie von
der Cluster-Seite aus über den Knopf _Cluster Log_.

Bitte beachten Sie, dass diese Einträge, genau wie die anderen
Systemmeldungen, bei einem Neustart des Gerätes verloren gehen. Wenn Sie die
Meldungen darüber hinaus erhalten möchten, können Sie sich die aktuelle
Logdatei über Ihren Browser herunterladen oder dauerhaft eine Weiterleitung
der Logmeldungen an einen Syslog-Server einrichten.


== SMS-Benachrichtigungen

=== Hardware

Es ist möglich, ein GSM-Modem an das Gerät anzuschließen, um darüber,
z.B. bei kritischen Problemen, von {CMK} SMS-Benachrichtungen verschicken
zu lassen.

Aktuell ist es nicht möglich, ein UMTS-/GSM-Modem zusammen mit der Appliance
oder nachträglich als Zubehör zu erwerben. Es gibt aber diverse Modems, wie
z.B. das link:https://www.multitech.com/models/92507087LF[MTD-H5-2.0],
die mit der Appliance kompatibel sind.


=== Inbetriebnahme des Modems

Um das Modem in Betrieb zu nehmen, müssen Sie eine funktionsfähige SIM-Karte
einlegen, es mit dem beiliegenden USB-Kabel an einen freien USB-Anschluss
Ihrer Appliance anschließen und das Modem mit Hilfe des beiliegenden
Netzteils mit dem Stromnetz verbinden.

Sobald dies erledigt ist, erkennt das Gerät das Modem automatisch und richtet
es ein. Öffnen Sie die Web-Oberfläche des Gerätes und wählen Sie das Modul
[.guihint]#Manage SMS#. Auf dieser Seite wird Ihnen der aktuelle Zustand des Modems
sowie der Verbindung mit dem Mobilfunknetz angezeigt.

[{image-border}]
image::appliance_usage_manage_sms.png[]

Sofern Sie zur Nutzung Ihrer SIM-Karte eine PIN eingeben müssen, können
Sie diese unter [.guihint]#SMS Settings# festlegen.

[{image-border}]
image::appliance_usage_configure_sms.png[]


=== Fehlerdiagnose

Falls verschickte Nachrichten Sie nicht erreichen, können Sie alle
verschickten oder nicht verschickten Nachrichten sowie Nachrichten, die darauf
warten verschickt zu werden auf der Seite [.guihint]#Manage SMS# einsehen. Die
Einträge in diesen Listen werden für maximal 30 Tage aufgehoben und
anschließend automatisch gelöscht.

//TK: Telefonnummerformat siehe KNW-375
Über den Menüpunkt [.guihint]#Send test SMS# ist es möglich, eine Test-SMS an eine Nummer Ihrer Wahl zu verschicken.
Die Telefonnummer muss dabei ohne führende Nullen und ohne führendes Plus-Zeichen eingegeben werden, also z.B. `491512345678` für eine Mobilfunknummer in Deutschland.


image::cma_de_sms_3.png[width=457]

Weiterführende Informationen zu eventuellen Fehlern beim SMS-Versand finden
Sie im [.guihint]#SMS Log#.


== Administration des RAIDs auf den Racks

=== Der RAID-Verbund

Ihr Rack verfügt über zwei Festplatteneinschübe an der Vorderseite des
Gehäuses. Diese sind mit den Nummern 1 und 2 markiert. Die hier eingebauten
Festplatten sind in einem RAID-1-Verbund (Spiegel) zusammengeschaltet,
so dass Ihre Daten auf beiden Festplatten redundant gespeichert werden.
Sollte eine der Festplatten ausfallen, sind die Daten weiterhin auf der
zweiten Festplatte verfügbar.


=== Verwaltung in der Web-Oberfläche

Den Zustand des RAIDs können Sie in der Web-Oberfläche Ihres Gerätes
einsehen. Wählen Sie dazu im Hauptmenü der Web-Oberfläche den Punkt
[.guihint]#RAID-Setup#. Außerdem haben Sie in dieser Maske die Möglichkeit, das
RAID zu reparieren, wenn es erforderlich sein sollte.


image::cma_de_rack1_raid_ok.png[width=457]


=== Tausch einer defekten Festplatte

Wenn eine Festplatte als defekt erkannt wird, wird diese in der Web-Oberfläche
als _fehlerhaft_ angezeigt. Am Gerät selbst wird der Fehler, je nach
Art, durch eine blau blinkende LED-Lampe am Festplatteneinschub angezeigt.


image::cma_de_rack1_raid_broken.png[width=457]

Durch Betätigen des kleinen Hebels an der linken Seite des Einschubs wird
die Befestigung entriegelt und Sie können den Rahmen inklusive Festplatte
aus dem Gehäuse ziehen. Nun können Sie die Schrauben an der Unterseite des
Rahmens lösen und die defekte Festplatte aus dem Rahmen entfernen. Montieren
Sie jetzt die neue Festplatte im Rahmen und schieben Sie diesen wieder in
den freien Einschub des Gerätes.

Wenn das Gerät eingeschaltet ist, während Sie die Festplatte austauschen,
startet die Wiederherstellung des RAIDs automatisch. Den Fortschritt können
Sie in der Web-Oberfläche einsehen.


image::cma_de_rack1_raid_repair.png[width=457]

Die Ausfallsicherheit ist erst wieder hergestellt, wenn das RAID vollständig
repariert wurde.

Die Festplatte muss mindestens die gleiche Größe haben wie das RAID
selbst. Diese können Sie in der RAID-Status-Ansicht einsehen.


=== Defekt beider Festplatten

Wenn das Gerät erkennt, dass beide Festplatten defekt sind oder aus dem
Gerät entfernt wurden, wird automatisch ein Neustart ausgelöst.


== Management-Interface des Racks

Ihr Rack verfügt über ein eingebautes Management-Interface, welches
den Zugriff über das Netzwerk auf das Gerät ermöglicht, selbst wenn
es nicht eingeschaltet ist. Sie können über die Web-Oberfläche dieses
Management-Interfaces beispielsweise das Gerät steuern, wenn es nicht
eingeschaltet oder nicht mehr erreichbar sein sollte sowie die lokale
Konsole fernsteuern.

Wenn Sie das Management-Interface nutzen möchten, müssen Sie zunächst
den dedizierten IPMI-LAN-Anschluss mit Ihrem Netzwerk verbinden.

[{image-left}]
image::cma_important.png[width=30]

Wir empfehlen, aus Sicherheitsgründen, das IPMI-LAN mit einem dedizierten
Management-Netzwerk zu verbinden, sofern dies möglich ist.

Das Management-Interface ist im Auslieferungszustand deaktiviert. Sie können
es über die Einstellung [.guihint]#Management Interface# in den Geräteeinstellungen
aktivieren und konfigurieren.

[{image-border}]
image::appliance_usage_management_interface_in_the_rack.png[]
//image::cma_de_rack1_mgmt_board.png[width=549]

Hier müssen Sie für das Management-Interface eine separate IP-Adresse
vergeben sowie dedizierte Zugangsdaten für den Zugriff auf das
Management-Interface einstellen.

Nachdem Sie diese Einstellungen gespeichert haben, können Sie mit Ihrem
Webbrowser die IP-Adresse des Management-Interfaces öffnen und sich dort
mit den soeben festgelegten Zugangsdaten einloggen.


== Fehlerdiagnose

=== Logs

Trotz sorgfältiger Tests ist es nicht auszuschließen, dass es zu
unvorhergesehenen Fehlern kommt, die ohne Blick auf das Betriebssystem nur
schwer zu diagnostizieren sind.

Eine Möglichkeit ist, die Logeinträge, die auf dem System erzeugt werden,
per Syslog an einen Syslog-Server schicken zu lassen. Allerdings werden die
Logeinträge der einzelnen Monitoring-Instanzen nicht per Syslog verarbeitet,
so dass diese nicht weitergeleitet werden und nur am Gerät eingesehen
werden können.

Um die Fehlerdiagnose auf dem Gerät zu vereinfachen, existiert eine Ansicht
zum Anzeigen diverser Logdateien des Gerätes. Diese erreichen Sie über den
Menüpunkt [.guihint]#View Log Files# im Hauptmenü der Web-Oberfläche.

//SK: Ausnahmsweise wird hier ein jpeg verwendet, weil das Bild als png größer als 1 MB ist.
image::cma_webconf_logs_2.jpeg[]

Hier können Sie die Logs des Gerätes auswählen und deren aktuellen Inhalt
einsehen.

[{image-left}]
image::cma_note.png[width=30]

Das Systemlog wird bei jedem Start des Gerätes neu initialisiert. Wenn Sie
die Logeinträge erhalten möchten, müssen Sie diese an einem Syslog-Server
schicken.

An der lokalen Konsole gibt es ebenfalls die Möglichkeit, das Systemlog
einzusehen. Auf dem zweiten Terminal werden die letzten Einträge des
Systemlogs angezeigt. Dieses Terminal erreichen Sie durch die Tastenkombination
`CTRL+ALT+F2`. Auf dem dritten Terminal werden alle Kernelmeldungen
ausgegeben. Hier finden Sie bei Hardwareproblemen die entsprechenden
Meldungen. Dieses Terminal ist mit der Tastenkombination `CTRL+ALT+F3`
erreichbar. Mit Hilfe der Tastenkombination `CTRL+ALT+F1` können
Sie wieder auf die Statusansicht zurückschalten.


=== Verfügbarer Arbeitsspeicher

Der im Gerät verbaute Arbeitsspeicher steht Ihren Monitoring-Instanzen
abzüglich des Speichers, der von den Systemprozessen der {CMK}-Appliance
benötigt wird, zur freien Verfügung.

Um die Stabilität der Systemplattform gewährleisten zu können, wird eine
feste Menge des Arbeitsspeichers für die Systemprozesse reserviert. Je nach
Konfiguration Ihres Gerätes ist die Menge des reservierten Speichers wie folgt:

* Einzelgerät (ohne Clusterkonfiguration): *100 MB*
* Geclustert: *300 MB*

Wenn Sie genau wissen wollen, wie viel Arbeitsspeicher Ihren
Monitoring-Instanzen zur Verfügung steht und wie viel aktuell belegt ist,
können Sie Ihr Gerät von {CMK} überwachen lassen. Auf dem Gerät wird ein
Service [.guihint]#User_Memory# angelegt, der Ihnen die aktuellen und historischen
Auslastungen anzeigt.

Falls von den Monitoring-Instanzen mehr Arbeitsspeicher belegt wird als
verfügbar ist, wird automatisch einer der Prozesse der Monitoring-Instanzen
beendet. Dies wird durch Standard-Mechanismen des Linux-Kernels umgesetzt.


== Service und Support

=== Handbuch

Bei Problemen während der Inbetriebnahme oder während des Betriebs, bitten
wir Sie, zuerst dieses Handbuch zu Rate zu ziehen.


=== Internet

Aktuelle Supportinformationen sind jederzeit im Internet über unsere
link:https://checkmk.de/appliance.html[Webseite] abrufbar. Hier
finden Sie die aktuellste Fassung der Dokumentation und allgemeine aktuelle
Informationen, die über die Angaben in diesem Handbuch hinaus gehen.



=== Firmware

Die aktuellen Versionen der Firmware finden Sie auf unserer
link:https://checkmk.de/appliance-download.php[Webseite]. Auf diese
Firmwares können Sie mit den Zugangsdaten Ihres laufenden Supportvertrags
zugreifen.


=== Hardware-Support

Bei einem Hardwareausfall kontaktieren Sie uns bitte per E-Mail an
link:mailto:cma-support@checkmk.com[cma-support@checkmk.com] oder per
Telefon unter +49 89 99 82 097 - 20. Die Abwicklung erfolgt gemäß der
vereinbarten Wartung und direkt vom Distributor.


=== Software-Support

Im Fall eines Softwarefehlers, egal ob Firmware oder {CMK}-Monitoring-Software,
kontaktieren Sie uns bitte über Ihre firmeneigene Supportadresse. Die
Unterstützung erfolgt im Rahmen des abgeschlossenen Supportvertrags.

