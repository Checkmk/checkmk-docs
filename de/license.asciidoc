// -*- coding: utf-8 -*-
include::global_attr.adoc[]
= Lizenzen verwalten
:revdate: draft
:title: Lizenzen verwalten - Lizenzinformationen sammeln und übermitteln
:description: Hiermit sammeln Sie in {CMK} transparente Information über den aktuellen Lizenzstatus und können diese vollautomatisch übermitteln.


==  Einleitung

{cee-only} Nutzen Sie eine der {CEE} oder die {CCE} (oberhalb der Grenzen der {FE}), so sind Sie verpflichtet, regelmäßig eine Übersicht über den Einsatz von {CMK} in Ihrem Unternehmen an {com} zu liefern.
Nach der Ersteinrichtung - und im Falle der {CE} der Lizenzeinspielung zum Ende der Testphase - kann {CMK} Ihnen den Rest dieser Verwaltungsarbeit komplett abnehmen.

{CMK} sammelt jeden Tag zu einem zufälligen Zeitpunkt die aktuellen Service-Zahlen für alle verbundenen Instanzen.
Diese werden dann in der Lizenznutzung übersichtlich und transparent dargestellt.

{CMK} speichert diese Informationen fortlaufend über einen Zeitraum von 400 Tagen. Ältere Daten werden entfernt.

Als Administrator von {CMK} überlassen Sie die Kommunikation mit dem Kundenportal komplett {CMK}, sowohl für die Lizenzierung als auch für die Übermittlung der Nutzungsinformationen.
Sollte Ihnen dies einmal nicht möglich sein, so können Sie die Kommunikation manuell ausführen.


[#generate_application_password]
== Subskriptionsdaten aus dem Kundenportal auslesen

Rufen Sie das link:https://portal.checkmk.com/de/[{CMK}-Kundenportal^] auf.
Melden Sie sich dort mit Ihren Zugangsdaten an, um die [.guihint]#Licensing Credentials# zu erstellen, die Sie im nächsten Schritt in {CMK} eintragen müssen.

Wählen Sie Ihre Subskription aus.
Die Ansicht sieht dann beispielsweise so aus:

image::license_subscription.png[alt="Die License Subscription im Kundenportal.", width=95%]

Klicken Sie nun auf [.guihint]#Generate Licensing Credentials#, um das Passwort für die Übermittlung zu erstellen.

image::license_generate_password.png[alt="Passwort im Kundenportal erstellen.", width=68%]

Kopieren Sie die [.guihint]#Licensing ID# und das [.guihint]#Password# und schließen Sie dieses Fenster mit [.guihint]#Confirm#.


[#license_cce]
== Lizenzierung der {CE}

In Bezug auf die Datenübermittlung gibt es einen wesentlichen Unterschied zwischen der {CCE} und den anderen {CEE}: Nach Ablauf der Testphase müssen Sie gleich zu Beginn der ersten Lizenzphase Ihre aktuellen Nutzungsdaten - aus der Testphase - an das link:https://portal.checkmk.com/de/[{CMK}-Kundenportal^] übertragen und sich einen dafür passenden Lizenzschlüssel geben lassen. Diesen laden Sie in {CMK} hoch, um Ihre {CE} zu lizenzieren und zur weiteren Nutzung freizuschalten.

*Hinweis:* Zuvor müssen Sie sich mit dem Vertrieb der {comfull} in Verbindung gesetzt haben, um Zugangsdaten für das Kundenportal zu erhalten.

Dies gilt natürlich nur, wenn Sie die Grenzwerte der {FE} überschritten haben. Anderenfalls können Sie Ihre {CE} als sogenannte {FE} ungehindert weiter nutzen ohne eine Lizenzierung durchführen zu müssen.


[#setup_cce]
=== Subskriptionsdaten in {CMK} eingeben

Öffnen Sie als xref:wato_user#roles[{CMK}-Administrator] [.guihint]#Setup > Maintenance > Licensing.#
Die Seite ist noch leer, solange keine Subskriptionsdaten hinterlegt wurden.

image::license_licensing_ce_ausschnitt.png[alt="Der Knopf 'Edit settings' zum Öffnen der Seite mit den Subskriptionseinstellungen."]

Öffnen Sie mit dem Knopf [.guihint]#Edit settings# die gleichnamige Seite:

image::license_edit_settings_ce.png[alt="Formular zur Eingabe der Lizenznutzungseinstellungen."]

Wählen Sie nun, ob Sie die Subskriptionsinformationen online oder offline übermitteln wollen. Wir empfehlen, die Online-Übermittlung zu nutzen. Dann kann Ihnen {CMK} den Großteil der künftigen Kommunikation abnehmen. Für die Online-Übermittlung füllen Sie noch die Felder [.guihint]#Licensing ID# und [.guihint]#Password# mit den xref:generate_application_password[Informationen aus dem Kundenportal.]

Zum Abschluss klicken Sie auf [.guihint]#Save#, um Ihre Angaben zu speichern.


=== Lizenznutzungsinformationen an die {comfull} übermitteln

Als Benutzer der {CCE} lassen Sie {CMK} den Großteil der Arbeit zur Übermittlung Ihrer Lizenzinformationen übernehmen.
Nur falls dies in Ihrem Unternehmen nicht möglich ist, müssen Sie xref:manualtrans[die Daten manuell übermitteln].

Ihre Lizenzinformationen sind für Sie jederzeit transparent einsehbar.
Es werden die Angaben, die Sie auf den Seiten [.guihint]#License usage# und [guihint]#Edit settings# sehen verwendet.


[#directtrans]
==== Direktübermittlung durch {CMK}

Die [.guihint]#Licensing credentials# müssen vor der ersten Übertragung in {CMK} hinterlegt worden sein (siehe xref:setup_cce[Subskriptionsdaten in {CMK} eingeben]).

Haben Sie sich für die Online-Übermittlung entschieden (die entsprechende Schaltfläche ist aktiv), so klicken Sie auf [.guihint]#Online verification#. Sie erhalten dann eine Erfolgsmeldung in {CMK}.

image::license_online_success_cce.png[alt="."]

Damit haben Sie Ihre {CE} erstmalig für die lizenzierte Nutzung freigeschaltet.

Ab jetzt meldet {CMK} regelmäßig Ihre aktuelle Lizenznutzung an die {comfull}. Nach jeder erfolgreichen Übertragung sehen Sie eine Bestätigung sowie eine Zusammenfassung der übermittelten Informationen.

Das einzige was Sie ab nun tun müssen, ist beim Wechsel von einer Lizenzphase zur nächsten, also bei der jeweiligen Verlängerung Ihrer Subskription, nach Aufforderung durch die {comfull} erneut auf den Button [.guihint]#Online verification# zu klicken.


== Lizenzierung der {EE} (nicht Cloud Edition)

Wenn Sie mit einer der {EE} starten, schalten Sie anfangs nur Ihre Lizenz frei. Die Übermittlung der Nutzungsdaten starten dann erst zum Ende der ersten Lizenzphase.

Hinweis: Die Ausnahme hiervon bildet die {CE}. Für das Vorgehen in dieser Version lesen Sie bitte oben xref:license_cce[die Lizenzierung der {CE}].

[#setup_cee]
=== Subskriptionsdaten in {CMK} eingeben

Öffnen Sie als xref:wato_user#roles[{CMK}-Administrator] [.guihint]#Setup > Maintenance > Licensing.#
Die Seite ist noch leer, solange keine Subskriptionsdaten hinterlegt wurden.

image::license_licensing_ausschnitt.png[alt="Der Knopf 'Edit settings' zum Öffnen der Seite mit den Subskriptionseinstellungen."]

Öffnen Sie mit dem Knopf [.guihint]#Edit settings# die gleichnamige Seite:

image::license_edit_settings.png[alt="Formular zur Eingabe der Lizenznutzungseinstellungen."]

Wählen Sie nun, ob Sie die Subskriptionsinformationen online oder offline übermitteln wollen. Wir empfehlen, die Online-Übermittlung zu nutzen. Dann kann Ihnen {CMK} den Großteil der künftigen Kommunikation abnehmen. Für die Online-Übermittlung füllen Sie noch die Felder [.guihint]#Licensing ID# und [.guihint]#Password# mit den xref:generate_application_password[Informationen aus dem Kundenportal.]

Zum Abschluss klicken Sie auf [.guihint]#Save#, um Ihre Angaben zu speichern.


=== Lizenznutzungsinformationen an die {comfull} übermitteln

Als Benutzer der {CEE} lassen Sie {CMK} den Großteil der Arbeit zur Übermittlung Ihrer Lizenzinformationen übernehmen. Sie müssen lediglich zum jeweiligen Ende einer Nutzungsphase einmal die Datenübertragung anstoßen.
Nur falls dies in Ihrem Unternehmen nicht möglich ist, müssen Sie xref:manualtrans[die Daten manuell übermitteln].

Ihre Lizenzinformationen sind für Sie jederzeit transparent einsehbar.
Es werden die Angaben, die Sie auf den Seiten [.guihint]#License usage# und [guihint]#Edit settings# sehen verwendet.


[#directtrans_cee]
==== Direktübermittlung durch {CMK}

Die [.guihint]#Licensing credentials# müssen vor der ersten Übertragung in {CMK} hinterlegt worden sein (siehe xref:setup_cee[Subskriptionsdaten in {CMK} eingeben]).

Haben Sie sich für die Online-Übermittlung entschieden (die entsprechende Schaltfläche ist aktiv), so klicken Sie auf [.guihint]#Submit license usage online#. {CMK} kümmert sich um den Rest und für Sie entsteht während der gesamten Nutzungsdauer kaum weitere Arbeit. Nach jeder erfolgreichen Übertragung erhalten Sie eine Bestätigung sowie eine Zusammenfassung der übermittelten Informationen. Diese sieht dann zum Beispiel so aus:

image::license_online_success_cee.png[alt="Anzeige der übermittelten Lizenzinformationen."]

Damit haben Sie erfolgreich die Nutzungsdaten der ersten Lizenzphase an die {comfull} übermittelt.

Das einzige was Sie ab nun tun müssen, ist beim Wechsel von einer Lizenzphase zur nächsten, also bei der jeweiligen Verlängerung Ihrer Subskription, nach Aufforderung durch die {comfull} erneut auf den Button [.guihint]#Submit license usage online# zu klicken.

== Lizenznutzungsinformationen anzeigen

{CMK} beginnt ab dem sTart Ihrer Lizenz, die lizenzrelevanten Informationen in Form eines farbigen Diagramms anzuzeigen.

Wenn die Lizenzverwaltung mindestens zwei volle Tage gelaufen ist, sehen Sie ein Diagramm dieser Art:

image::license_usage.png[alt="Graphische Übersicht über die aktuelle Lizenznutzung."]

Anhand der verschiedenfarbigen Elemente können Sie Folgendes ablesen:

* Die rote Linie zeigt das aktuell in den [.guihint]#xref:setup[Subscription details]# eingetragene Lizenzlimit.
Damit sind Überschreitungen der Service-Anzahl leicht zu erkennen.
* Die hellblaue Linie zeigt die durchschnittliche Service-Anzahl pro Monat an.
Hierdurch werden Spitzen, die z.B. durch eine Fehlkonfiguration entstehen, geglättet.
* Die dunkelblaue Linie zeigt für jeden Tag die Gesamtzahl der überwachten Services über alle verbundenen Instanzen hinweg an.
* Die grüne Spalte zeigt die durchschnittliche Service-Anzahl im aktuellen Monat.
* Die gelbe Spalte zeigt den ersten Monat, in dem das Lizenzlimit überschritten wird.
* Die lila Spalte zeigt den Monat mit der höchsten Lizenzüberschreitung.

In einer Tabelle unterhalb der Grafik, d. h. unterhalb des oben abgebildeten Ausschnitts, sind die einzelnen Nutzungen der Instanzen pro Tag aufgelistet.


[#manualtrans]
== Manuelle Übermittlung

Sollten Sie gezwungen sein Ihre Lizenzinformationen manuell in das Kundenportal hochzuladen, so gehen Sie dabei folgendermaßen vor:

Öffnen Sie [guihint]#Setup > Maintenance > Licensing.#
Klicken Sie dann auf den Knopf icon:icon_assume_0[alt="Symbol zur Offline-Übertragung der Lizenzdaten."] [.guihint]#Submit license usage offline# / [.guihint]#Offline verification.#

Sie gelangen auf die Seite [.guihint]#Offline verification# (in de {CE}) bzw. auf die Seite [.guihint]#Offline verification# (in den anderen {EE}).

image::license_offline_verification.png[alt="Seite für Offline-Übertragung der {CE}-Lizenzinformationen."]

image::license_offline_submission.png[alt="Seite für Offline-Übertragung der {EE}-Lizenzinformationen."]

Folgen Sie nun den Schritten, wie sie im Ablauf auf der jeweiligen Seite dargestellt werden. Laden Sie also die geforderten Daten aus {CMK} herunter. Laden Sie die zugehörigen Dateien als nächstes ins Kundenportal hoch. Die von dort bereitgestellten Antwortdateien laden Sie dann in {CMK} hoch, um den Prozess abzuschließen.

Achten Sie bitte darauf, dass Sie in einem xref:glossar#distributed_monitoring[verteilten Monitoring] sowohl die Übermittlungen zum Kundenportal als auch die aus dem Kundenportal nicht nur auf der Zentralinstanz sondern auch auf allen Remote-Instanzen ausführen müssen. Beim xref:glossar#distributed_setup[verteilten Setup] erfolgt die komplette Abwicklung der Lizenzierung über die Zentralinstanz.
