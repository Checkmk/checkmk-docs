// -*- coding: utf-8 -*-
include::global_attr.adoc[]
= Lizenzen verwalten
:revdate: draft
:title: Lizenzen verwalten - Lizenzinformationen sammeln und übermitteln
:description: Hiermit sammeln Sie in {CMK} transparente Information über den aktuellen Lizenzstatus und versenden diese bei gleichzeitiger voller Kontrolle über die Datenübermittlung.


==  Einleitung

{cee-only} Nutzen Sie eine der {CEE} oder die {CCE}, so führen Sie mindestens einmal pro Jahr einen Lizenzaudit durch, d.h. Sie erstellen eine Übersicht über den Einsatz von {CMK} in Ihrem Unternehmen und geben diese an {com} weiter.
Nach der Ersteinrichtung kann {CMK} Ihnen den Rest dieser Verwaltungsarbeit komplett abnehmen.

{CMK} sammelt jeden Tag zu einem zufälligen Zeitpunkt die aktuellen Service-Zahlen für alle verbundenen Instanzen.
Diese werden dann in der Lizenznutzung übersichtlich und transparent dargestellt.

{CMK} speichert diese Informationen fortlaufend über einen Zeitraum von 400 Tagen. Ältere Daten werden entfernt.

Als Administrator von {CMK} lassen Sie die Lizenznutzungsinformationen dann ganz bequem an das Kundenportal von {com} übermitteln.
Sollte Ihnen dies einmal nicht möglich sein, so können Sie diese aktiv herunterladen und danach manuell in das Kundenportal hochladen.
In jedem Fall behalten Sie durchgängig die volle Kontrolle über die Datenweitergabe und die übermittelten Inhalte.


==  Lizenzverwaltung nutzen

[#generate_application_password]
=== Subskriptionsdaten aus dem Kundenportal auslesen

Rufen Sie das link:https://portal.checkmk.com/de/[{CMK}-Kundenportal^] auf.
Melden Sie sich dort mit Ihren Zugangsdaten an, um die [.guihint]#Application Account Credentials# zu erstellen, die Sie im xref:setup[nächsten Schritt] in {CMK} eintragen müssen.

Wählen Sie Ihre Subskription aus.
Die Ansicht sieht dann beispielsweise so aus:

image::license_subscription.png[alt="Die License Subscription im Kundenportal.", width=95%]

Klicken Sie nun auf [.guihint]#Generate Application Account Password#, um das Passwort für die Übermittlung zu erstellen.

image::license_generate_password.png[alt="Passwort im Kundenportal erstellen.", width=68%]

Kopieren Sie den [.guihint]#Application Account# und das [.guihint]#Password# und schließen Sie dieses Fenster mit [.guihint]#Confirm#.


[#setup]
=== Subskriptionsdaten in {CMK} eingeben

Da die Seite für die Eingabe der Subskriptionsdaten etwas unterschiedlich aufgebaut ist, abhängig davon, ob Sie eine der {EE} oder die {CE} nutzen, geht es nun in zwei verschiedenen Unterkapiteln weiter.

==== Subskriptionsdaten in den {EE}

Öffnen Sie als xref:wato_user#roles[{CMK}-Administrator] [.guihint]#Setup > Maintenance > Licensing.#
Die Seite ist noch relativ leer, so lange keine Subskriptionsdaten hinterlegt wurden.

image::license_licensing_ausschnitt.png[alt="Der Knopf 'Edit settings' zum Öffnen der Seite mit den Subskriptionseinstellungen."]

Öffnen Sie mit dem Knopf [.guihint]#Edit settings# die gleichnamige Seite:

image::license_edit_settings.png[alt="Formular zur Eingabe der Lizenznutzungseinstellungen."]

Wählen Sie nun, ob Sie die Subskriptionsinformationen online oder offline übermitteln wollen. Für die Online-Übermittlung füllen Sie außerdem die Felder [.guihint]#Application account ID# und [.guihint]#Password# mit den xref:generate_application_password[Informationen aus dem Kundenportal.]

Zum Abschluss klicken Sie auf [.guihint]#Save#, um Ihre Angaben zu speichern.

==== Subskriptionsdaten in der {CE}

Öffnen Sie als xref:wato_user#roles[{CMK}-Administrator] [.guihint]#Setup > Maintenance > Licensing.#
Die Seite ist noch relativ leer, so lange keine Subskriptionsdaten hinterlegt wurden.

image::license_licensing_ce_ausschnitt.png[alt="Der Knopf 'Edit settings' zum Öffnen der Seite mit den Subskriptionseinstellungen."]

Öffnen Sie mit dem Knopf [.guihint]#Edit settings# die gleichnamige Seite:

image::license_edit_settings_ce.png[alt="Formular zur Eingabe der Lizenznutzungseinstellungen."]

Wählen Sie nun, ob Sie die Subskriptionsinformationen online oder offline übermitteln wollen. Für die Online-Übermittlung füllen Sie außerdem die Felder [.guihint]#Application account ID# und [.guihint]#Password# mit den xref:generate_application_password[Informationen aus dem Kundenportal.]

Zum Abschluss klicken Sie auf [.guihint]#Save#, um Ihre Angaben zu speichern.


=== Lizenznutzungsinformationen anzeigen

{CMK} beginnt nun, die lizenzrelevanten Informationen in Form eines farbigen Diagramms anzuzeigen.

Wenn die Lizenzverwaltung eine Weile gelaufen ist, sehen Sie ein Diagramm dieser Art:

image::license_usage.png[alt="Graphische Übersicht über die aktuelle Lizenznutzung."]

Anhand der verschiedenfarbigen Elemente können Sie Folgendes ablesen:

* Die rote Linie zeigt das aktuell in den [.guihint]#xref:setup[Subscription details]# eingetragene Lizenzlimit.
Damit sind Überschreitungen der Service-Anzahl leicht zu erkennen.
* Die hellblaue Linie zeigt die durchschnittliche Service-Anzahl pro Monat an.
Hierdurch werden Spitzen, die z.B. durch eine Fehlkonfiguration entstehen, geglättet.
* Die dunkelblaue Linie zeigt für jeden Tag die Gesamtzahl der überwachten Services über alle verbundenen Instanzen hinweg an.
* Die grüne Spalte zeigt die durchschnittliche Service-Anzahl im aktuellen Monat.
* Die gelbe Spalte zeigt den ersten Monat, in dem das Lizenzlimit überschritten wird.
* Die lila Spalte zeigt den Monat mit der höchsten Lizenzüberschreitung.

In einer Tabelle unterhalb der Grafik, d. h. unterhalb des oben abgebildeten Ausschnitts, sind die einzelnen Nutzungen der Instanzen pro Tag aufgelistet.


== Lizenznutzungsinformationen an {com} übermitteln

Als Benutzer der {CEE} oder der {CCE} lassen Sie {CMK} den Großteil der Arbeit zur Übermittlung Ihrer Lizenzinformationen übernehmen.
Nur falls dies in Ihrem Unternehmen nicht möglich ist, müssen Sie die Daten manuell übermitteln.

Ihre Lizenzinformationen sind für Sie jederzeit transparent einsehbar.
Es werden die Angaben, die Sie auf den Seiten [.guihint]#License usage# und [guihint]#Edit settings# sehen verwendet.


[#directtrans]
=== Direktübermittlung durch {CMK}

Die [.guihint]#Application account credentials# müssen vor der ersten Übertragung in {CMK} hinterlegt worden sein (siehe xref:setup[Subskriptionsdaten in {CMK} eingeben]).

Haben Sie sich für die Online-Übermittlung entschieden (die entsprechende Schaltfläche ist aktiv), so klicken Sie auf [.guihint]#Submit license usage online# bzw. [.guihint]#Online verification#. {CMK} kümmert sich um den Rest und für Sie entsteht während der gesamten Nutzungsdauer keine weitere Arbeit. Nach jeder erfolgreichen Übertragung erhalten Sie eine Bestätigung sowie eine Zusammenfassung der übermittelten Informationen. Diese sieht dann zum Beispiel so aus:

image::license_submission_success.png[alt="Anzeige der übermittelten Lizenzinformationen."]


[#manualtrans]
=== Manuelle Übermittlung

Sollten Sie gezwungen sein Ihre Lizenzinformationen manuell in das Kundenportal hochzuladen, so gehen Sie dabei folgendermaßen vor:

Öffnen Sie [guihint]#Setup > Maintenance > Licensing.#
Klicken Sie dann auf den Knopf icon:icon_assume_0[alt="Symbol zur Offline-Übertragung der Lizenzdaten."] [.guihint]#Submit license usage offline# / [.guihint]#Offline verification.#

Sie gelangen auf die Seite [.guihint]#Offline submission# (in den {EE}) bzw. auf die Seite [.guihint]#Offline verification# (in der {CE}).

image::license_offline_submission.png[alt="Seite für Offline-Übertragung der {EE}-Lizenzinformationen."]

image::license_offline_verification.png[alt="Seite für Offline-Übertragung der {CE}-Lizenzinformationen."]

Mit dem Knopf icon:icon_download[alt="Symbol für das Herunterladen der Daten."] [.guihint]#Download license usage report# / [.guihint]#Download verification request# starten Sie, nach der Festlegung des gewünschten Pfades, den Download des Archivs (gezipptes Tar-Archiv).

Verlassen Sie nun {CMK} - ohne es zu beenden - und wechseln Sie zum link:https://portal.checkmk.com/de/[{CMK}-Kundenportal.^]
Loggen Sie sich dort mit Ihren Zugangsdaten ein, um die Lizenzinformationen hoch zu laden.
Wählen Sie die Subskription aus, für die Sie die Lizenzdaten hochladen wollen.
Ermitteln Sie [.guihint]#Application Account# und [.guihint]#Password# für die Übertragung xref:generate_application_password[wie oben beschrieben.]

Öffnen Sie dann mit [.guihint]#Submit License Report# den Dialog zur Übertragung des Lizenzberichts:

image::license_submit_license.png[alt="Dialog zur Lizenzbericht-Übertragung.", width=68%]

Fügen Sie den [.guihint]#Application Account# sowie das zugehörige [.guihint]#Password# ein und geben Sie den Pfad zum Lizenzbericht an.
Starten Sie mit [.guihint]#Submit# die Übertragung.
Nach erfolgreicher Übermittlung sehen Sie eine Bestätigung.

Zeitgleich wird ein Übermittlungsbericht auf Ihr System heruntergeladen.

Kehren Sie nun zu {CMK} zurück. Auf der Seite [.guihint]#Offline submission# / [.guihint]#Offline verification# wählen Sie den Übermittlungsbericht aus. Laden Sie diesen über den Button icon:icon_upload[alt="Symbol für das Hochladen der Daten."] [.guihint]#Upload license usage report# / [.guihint]#Upload verification report# in {CMK}.

Achten Sie bitte darauf, dass Sie in einem xref:glossar#distributed_monitoring[verteilten Monitoring] die Rückmeldungen aus dem Kundenportal nicht nur auf die Zentralinstanz sondern auch auf alle Remote-Instanzen hochladen müssen.
