// -*- coding: utf-8 -*-
include::global_attr.adoc[]
= Lizenzen verwalten
:revdate: draft
:title: Lizenzen verwalten - Lizenzinformationen sammeln und übermitteln
:description: Hiermit sammeln Sie in {CMK} transparente Information über den aktuellen Lizenzstatus und versenden diese bei gleichzeitiger voller Kontrolle über die Datenübermittlung.

// TK: Wenn nicht Bestandteil eines Produktnamens {CMK} generell mit Bindestrich koppeln: {CMK}-Benutzer, {CMK}-Administrator, {CMK}-Kundenportal (ich habs bereits geändert)


==  Einleitung

{cee-only} Nutzen Sie die {CEE}, so führen Sie mindestens einmal pro Jahr einen Lizenzaudit durch, 
// TK:  Nutzen Sie eine der {CEE}, ...
d.h. Sie erstellen eine Übersicht über den Einsatz von {CMK} in Ihrem Unternehmen und geben diese an tribe29 oder den Sie betreuenden Partner von tribe29 weiter.
Diese Verwaltungsarbeit kann {CMK} Ihnen zwar nicht ganz abnehmen, aber dennoch erheblich erleichtern.

{CMK} sammelt jeden Tag zu einem zufälligen Zeitpunkt die aktuellen Service-Zahlen für alle verbundenen Instanzen.
Diese werden dann in der Lizenzverwaltung übersichtlich und transparent dargestellt.

{CMK} speichert diese Informationen fortlaufend über einen Zeitraum von 400 Tagen, übermittelt diese aber niemals selbsttätig.
Ältere Daten werden entfernt.

Als Administrator von {CMK} lassen Sie die Lizenzinformationen dann ganz bequem direkt von {CMK} an das Kundenportal von tribe29 übermitteln. Sollte Ihnen dies einmal nicht möglich sein, so können Sie diese aktiv herunterladen und danach manuell in das Kundenportal von tribe29 hochladen.
In jedem Fall behalten Sie durchgängig die volle Kontrolle über die Datenweitergabe und die übermittelten Inhalte.


==  Lizenzverwaltung nutzen

[#setup]
=== Subskriptionsdaten eingeben

Öffnen Sie als {CMK}-Benutzer mit xref:wato_user#roles[Administrator-Rechten] [.guihint]#Setup > Maintenance > License usage#.
// TK: Öffnen Sie als xref:wato_user#roles[{CMK}-Administrator] ...

Die Seite ist noch leer, so lange keine Subskriptionsdaten hinterlegt wurden.

image::license_license_usage_ausschnitt.png[alt="Knopf Edit subscription settings zum Öffnen der Seite mit den Subskriptionseinstellungen."]

Öffnen Sie mit dem Knopf [.guihint]#Edit subscription settings# die gleichnamige Seite:

image::license_edit_subscription.png[alt="Formular zur Eingabe der Subskriptionseinstellungen."]

Tragen Sie nun Beginn und Ende Ihres aktuellen Abonnementzeitraums in die entsprechenden Felder im Abschnitt [guihint]#Subscription details# ein.
Darunter wählen Sie eine der vorgegebenen Abonnementgrößen aus.
Alternativ können Sie mit der Auswahl [.guihint]#Custom limit# einen eigenen Wert eingeben, wenn der für Ihre Umgebung zutreffende Wert nicht angeboten wird.

[#generate_application_password]
Verlassen Sie nun {CMK} und wechseln Sie zum link:https://portal.checkmk.com/de/[{CMK}-Kundenportal^].
// TK: Warum muss ich CMK jetzt verlassen und nachher im selben Dialog weitermachen? Wärs nicht besser, dass man sich erst die notwendigen Daten aus dem Kundenportal holt?
// TK: Dann hat man alles beisammen, bevor es mit CMK losgeht und man kann die CMK-Konfig in einem Zug durchführen.
// TK: Dass man in CMK mit Save abschließen muss, fehlt übrigens.
Melden Sie sich dort mit Ihren Zugangsdaten an, um die Lizenzinformationen zu erhalten.
// TK: Unglücklich formuliert: Man muss sich im Kundenportal anmelden, um die Application account credentials zu ermitteln, die man in CMK eintragen muss.
Wählen Sie die passende Subskription aus.
// TK: Was da "passend" ist, weiß man hoffentlich...
Die Ansicht sieht dann beispielsweise so aus:

image::license_subscription.png[alt="Die License Subscription im Kundenportal.", width=95%]

Klicken Sie nun auf [.guihint]#Generate Application Account Password#, um das Passwort für die Übermittlung zu erstellen.

image::license_generate_password.png[alt="Passwort im Kundenportal erstellen.", width=68%]

Kopieren Sie den [.guihint]#Application Account# und das Passwort und schließen Sie dieses Fenster mit [.guihint]#Confirm#. Kehren Sie zu {CMK} zurück und tragen Sie beide Informationen im Abschnitt [.guihint]#Application account credentials# (siehe oben) als [.guihint]#Username# und [.guihint]#Password# ein.


=== Lizenzinformationen anzeigen

{CMK} beginnt nun, die lizenzrelevanten Informationen in Form eines farbigen Diagramms anzuzeigen.

Wenn die Lizenzverwaltung eine Weile gelaufen ist, sehen Sie ein Diagramm dieser Art:

image::license_usage.png[alt="Graphische Übersicht über die aktuelle Lizenznutzung."]

Anhand der verschiedenfarbigen Elemente können Sie Folgendes ablesen:

* Die rote Linie zeigt das aktuell in den [.guihint]#xref:setup[Subscription details]# eingetragene Lizenzlimit.
Damit sind Überschreitungen der Service-Anzahl leicht zu erkennen.
* Die hellblaue Linie zeigt die durchschnittliche Service-Anzahl pro Monat an.
Hierdurch werden Spitzen, die z.B. durch eine Fehlkonfiguration entstehen, geglättet.
* Die dunkelblaue Linie zeigt für jeden Tag die Gesamtzahl der überwachten Services über alle verbundenen Instanzen hinweg an.
* Die grüne Spalte zeigt die durchschnittliche Service-Anzahl im aktuellen Monat.
* Die gelbe Spalte zeigt den ersten Monat, in dem das Lizenzlimit überschritten wird.
* Die lila Spalte zeigt den Monat mit der höchsten Lizenzüberschreitung.

In einer Tabelle unterhalb der Grafik, d. h. unterhalb des oben abgebildeten Ausschnitts, sind die einzelnen Nutzungen der Instanzen pro Tag aufgelistet.


== Lizenzinformationen an tribe29 übermitteln

Als Benutzer der {CEE} lassen Sie {CMK} den Großteil der Arbeit zur Übermittlung Ihrer Lizenzinformationen übernehmen.
Nur falls dies in Ihrem Unternehmen nicht möglich ist, müssen Sie die Daten manuell übermitteln.

Ihre Lizenzinformationen sind für Sie jederzeit transparent einsehbar.
Es werden die Angaben, die Sie auf den Seiten [.guihint]#License usage# und [guihint]#Edit subscription settings# sehen sowie gegebenenfalls ein auf der Seite [.guihint]#Submit or download license usage report# ergänzter Kommentar verwendet.


[#directtrans]
=== Direktübermittlung durch {CMK}

Um Ihnen die Arbeit zu vereinfachen, definieren Sie die Übermittlung der Lizenzinformationen vor.
// TK: Nicht klar, was gemeint ist und wer was getan hat oder noch tun muss. Es geht doch um folgendes:
// TK: Indem ich in CMK meine Subskription mit dem Applikationskonto (zu Begrifflichkeiten siehe unten) verbunden habe (wie oben beschrieben), habe ich die Voraussetzung geschaffen, um die Daten auf Knopfdruck zu übermitteln.
// TK: So ähnlich stehts ja auch in dem Hinweis unten.
Sie ist dann mit wenigen Klicks direkt aus {CMK} heraus durchführbar.

*Hinweis:* Ihre Zugangsdaten für das {CMK}-Kundenportal müssen vor der ersten Übertragung in {CMK} hinterlegt worden sein (siehe xref:setup[Subskriptionsdaten eingeben]).
// TK: Verwirrend: Es gibt die Zugangsdaten, mit denen man sich in Portal anmeldet (die hast Du oben Zugangsdaten genannt) und die, die man sich im Portal besorgt, um sie in CMK einzutragen (Application Account). 
// TK: Hier geht es doch um den Application Account.
// TK: Du brauchst zur Unterscheidung 2 Begriffe, die dann konsequent im Artikel verwendet werden.
// TK: Evtl. (wenn auch holprig) Kundenportal vs. Applikationskonto bzw. Kundenportal-Zugangsdaten vs. Applikationskonto-Zugangsdaten

Nutzen Sie auf der Seite [.guihint]#Submit or download license usage report# den Knopf icon:icon_assume_0[alt="Symbol zum Anstoßen von Übertragung oder Download der Lizenzdaten."] [.guihint]#Submit report.#
Ihre Lizenzinformationen werden dann direkt in Ihren Bereich des {CMK}-Kundenportals übertragen und Sie erhalten eine entsprechende Bestätigung.

image::license_submit_license_success.png[alt="Bestätigung der erfolgreichen Lizenzdaten-Übermittlung."]

[#manualtrans]
=== Manuelle Übermittlung

Sollten Sie gezwungen sein Ihre Lizenzinformationen manuell in das tribe29-Kundenportal hochzuladen, so gehen sie dabei folgendermaßen vor:
// TK: Warum heisst das Kundenportal jetzt tribe29-Kundenportal?

Öffnen Sie [guihint]#Setup > Maintenance > License usage#.
Klicken Sie dann auf den Knopf icon:icon_assume_0[alt="Symbol zum Anstoßen von Übertragung oder Download der Lizenzdaten."] [.guihint]#Submit or download.#

image::license_license_usage_ausschnitt2.png[alt="Auswahl des Knopfs 'Submit or download' auf der Seite 'License Usage'."]

Sie gelangen auf die Seite [.guihint]#Submit or download license usage report#.

image::license_submit_or_download.png[alt="Seite für Übertragung und Download der Lizenzinformationen."]

Mit dem Knopf icon:icon_download[alt="Symbol für das Herunterladen der Daten."] [.guihint]#Download report# starten Sie, nach der Festlegung des gewünschten Pfades, den Download des Archivs (gezipptes Tar-Archiv).

Verlassen Sie nun {CMK} und wechseln Sie zum link:https://portal.checkmk.com/de/[{CMK}-Kundenportal^].
Loggen Sie sich dort mit Ihren Zugangsdaten ein, um die Lizenzinformationen hoch zu laden.
Wählen Sie die Subskription aus, für die Sie die Lizenzdaten hochladen wollen. Ermitteln Sie [.guihint]#Application Account# und Passwort für die Übertragung xref:generate_application_password[wie oben beschrieben].

Öffnen Sie dann mit [.guihint]#Submit License Report# das Fenster zur Übertragung des Lizenzberichts:

image::license_submit_license.png[alt="Dialog zur Lizenzbericht-Übertragung.", width=68%]

Fügen Sie das Passwort ein und geben Sie den Pfad zum Lizenzbericht an. Starten Sie dann mit [.guihint]#Submit# die Übertragung.

////
=== Ergänzende Informationen für tribe29-Partner

Als Partner von tribe29 können Sie nicht nur Ihre eigenen Lizenzinformationen einfach und schnell an tribe29 melden, sondern ebenso die Lizenzinformationen Ihrer Kunden.
Die xref:directtrans[Direktübermittlung durch {CMK}] der kundenbezogenen Informationen entspricht exakt dem oben beschriebenen Vorgehen.
Lediglich bei der manuellen Übermittlung gibt es kleine Unterschiede.

Wenn Sie bei Ihrem Kunden einen direkten Zugang zu {CMK} haben, erstellen Sie die Datei mit den Lizenzinformationen wie im Abschnitt xref:manualtrans[Manuelle Übermittlung] beschrieben.

Haben Sie keinen direkten Zugang zu {CMK} bei Ihrem Kunden, so bitten Sie diesen, den Download für Sie durchzuführen und lassen Sie sich die Datei zuschicken.

Melden Sie sich danach mit Ihren Zugangsdaten im link:https://portal.checkmk.com/de/[{CMK}-Kundenportal^] an (tribe29-Partnern stehen hier zusätzliche Optionen zur Verfügung).
Wählen Sie [guihint]#Resold Licenses# in der linken Seitenleiste.

image::license_resold_licenses.png[alt="Linkes Seitenmenü im Partnerportal.", width=35%]

Es öffnet sich das Fenster [guihint]#Resold Licenses#.

image::license_resold_licenses_rechts.png[alt="Ansicht aller zugehörigen Endkundenlizenzen im Partnerportal."]

Klicken Sie in der Zeile des betreffenden Kunden auf den Knopf icon:button_upload_audit[alt="Knopf, der die Seite zum Hochladen der Lizenzinformationen öffnet."].

Analog zum oben beschriebenen Vorgehen definieren Sie die Datei mit den Lizenzinformationen und starten das Hochladen der Datei mit einem Klick auf den Knopf [guihint]#Upload license audit#.
Das erfolgreiche Hochladen wird abschließend bestätigt.
////