// -*- coding: utf-8 -*-
include::global_attr.adoc[]
= Managing licenses
:revdate: draft
:title: Managing licenses - collect and send license information
:description: Use this to collect and send transparent information about the current license status in {CMK} while maintaining full control over data transmission.


== Introduction

{cee-only} If you use one of the {CEE}, you perform a license audit at least once a year, i.e. you create an overview of the use of {CMK} within your company and pass it on to tribe29.
While {CMK} can't do this administrative work for you entirely, it can make the process a lot easier.

{CMK} collects the current service numbers for all connected sites at a random time every day.
These are then displayed clearly and transparently in the license usage view.

{CMK} stores this information continuously for a period of 400 days, but never transmits it automatically.
Older data is removed.

A {CMK} administrator can download the license information and then manually upload it to the tribe29 customer portal.
A convenient alternative is to have {CMK} submit the information directly to tribe29's customer portal.
In any case, you retain full control over the data transfer and the transferred content.

////
text to replace previous paragraph - translation required:

Als Administrator von {CMK} lassen Sie die Lizenznutzungsinformationen dann ganz bequem direkt von {CMK} an das Kundenportal von tribe29 übermitteln. Sollte Ihnen dies einmal nicht möglich sein, so können Sie diese aktiv herunterladen und danach manuell in das Kundenportal hochladen.
In jedem Fall behalten Sie durchgängig die volle Kontrolle über die Datenweitergabe und die übermittelten Inhalte.

////

==  Using license management

////
new section - translation required:

[#generate_application_password]
=== Subskriptionsdaten aus dem Kundenportal auslesen

Rufen Sie das link:https://portal.checkmk.com/de/[{CMK}-Kundenportal^] auf.
Melden Sie sich dort mit Ihren Zugangsdaten an, um die [.guihint]#Application Account Credentials# zu erstellen, die Sie im nächsten Schritt in {CMK} eintragen müssen.

Wählen Sie Ihre Subskription aus.
Die Ansicht sieht dann beispielsweise so aus:

image::license_subscription.png[alt="Die License Subscription im Kundenportal.", width=95%]

Klicken Sie nun auf [.guihint]#Generate Application Account Password#, um das Passwort für die Übermittlung zu erstellen.

image::license_generate_password.png[alt="Passwort im Kundenportal erstellen.", width=68%]

Kopieren Sie den [.guihint]#Application Account# und das Passwort und schließen Sie dieses Fenster mit [.guihint]#Confirm#.

////
[#setup]
=== Entering subscription data

As a {CMK} user with xref:wato_user#roles[administrator rights] open [.guihint]#Setup > Maintenance > License usage#.
This page will be empty as long as no subscription data has been stored.

image::license_license_usage_ausschnitt.png[alt="Edit subscription settings button to open the subscription settings page."]

Use the [.guihint]#Edit subscription settings# button to open the page with this same name:

image::license_edit_subscription.png[alt="Form for entering subscription settings."]

Now enter the start and end dates for your current subscription period in the corresponding fields in the [guihint]#Subscription details# section.
Below that, select one of the default subscription values.
Alternatively, you can use the [.guihint]#Custom limit# selection to enter your own value if the one that applies to your environment is not provided.

If you want to use the xref:directtrans[direct transmission of license information] function, fill in the second section [.guihint]#Customer portal credentials# with your user name and password for the link:https://portal.checkmk.com/[{CMK} customer portal^].

////
text to replace previous paragraph - translation required:

Füllen Sie den Abschnitt [.guihint]#Application account credentials# mit den xref:generate_application_password[Informationen aus dem Kundenportal].
Achten Sie darauf, dass Sie den [.guihint]#Application Account# als [.guihint]#Username# verwenden müssen.

Zum Abschluss klicken Sie auf [.guihint]#Save#, um Ihre Angaben zu speichern.

////

=== Displaying license information

{CMK} will now start to display the license related information in the form of a colored diagram.

When license management has been running for a while, you will see a graph of this type:

image::license_usage.png[alt="Graphic overview of the current license usage."]

Based on the various colored elements, you will be able to understand the following:

* The red line shows the license limit currently entered in the [.guihint]#xref:setup[Subscription details]#.
This makes it easy to see if the number of services has been exceeded.
* The light blue line shows the average number of services per month.
This smoothes out peaks caused by a misconfiguration, for example.
* The dark blue line shows for each day the total number of monitored services across all connected sites.
* The green column shows the average number of services in the current month.
* The yellow column shows the first month in which the license limit has been exceeded.
* The purple column shows the month with the highest license overrun.

In a table below the graph, i.e. below the section shown above, the individual usage for each instance per day is listed.


== Sending license information to tribe29

As a {CSE} or {CME} user, you can either submit your license information manually or let {CMK} do most of the work.

////
text to replace previous section - translation required:

Als Benutzer der {CEE} lassen Sie {CMK} den Großteil der Arbeit zur Übermittlung Ihrer Lizenzinformationen übernehmen.
Nur falls dies in Ihrem Unternehmen nicht möglich ist, müssen Sie die Daten manuell übermitteln.

////

Your license information is transparent to you at all times.
The information you see on the [.guihint]#License usage# and [guihint]#Edit subscription settings# pages will be used, as well as a comment added on the [.guihint]#Submit or download license usage report# page, if applicable.

[#directtrans]
=== Direct transmission by {CMK}

To simplify your work even more, you can predefine the transmission of the license information.
This can be accomplished directly from {CMK} with just a few clicks.

*Note:* Your access data for the tribe29 customer portal must have been stored in {CMK} before the first transmission (see xref:setup[Entering subscription data]).

On the [.guihint]#Submit or download license usage report# page, use the icon:icon_assume_0[alt="Button to initiate transfer or download of license data."] [.guihint]#Submit report# button.
Your license information will then be transferred directly to your account area of the tribe29 customer portal and you will receive a corresponding confirmation.
The file transferred here is identical to the one you receive when downloading manually. 

////
text to replace previous paragraphs - translation required:

Die [.guihint]#Application account credentials# müssen vor der ersten Übertragung in {CMK} hinterlegt worden sein (siehe xref:setup[Subskriptionsdaten in {CMK} eingeben]).

Nutzen Sie auf der Seite [.guihint]#Submit or download license usage report# den Knopf icon:icon_assume_0[alt="Symbol zum Anstoßen von Übertragung oder Download der Lizenzdaten."] [.guihint]#Submit report.#

image::license_submit_report.png[alt="Der Button "Submit report"."]

Ihre Lizenzinformationen werden dann direkt in Ihren Bereich des {CMK}-Kundenportals übertragen und Sie erhalten eine entsprechende Bestätigung.

////

image::license_submit_license_success.png[alt="Confirmation of successful license data transmission."]


[#manualtrans]
=== Manual transmission

You can download your license information directly from your monitoring, and then manually upload it to the tribe29 customer portal.

////
text to replace previous phrase - translation required:

Sollten Sie gezwungen sein Ihre Lizenzinformationen manuell in das Kundenportal hochzuladen, so gehen Sie dabei folgendermaßen vor:

////

To do this, open [guihint]#Setup > Maintenance > License usage#.
Then click on the icon:icon_assume_0[alt="Icon to initiate transfer or download of license data."] [.guihint]#Submit or download# button.

image::license_license_usage_ausschnitt2.png[alt="Selecting the 'Submit or Download' button on the 'License Usage' page."]

This will take you to the [.guihint]#Submit or download license usage report# page.

image::license_submit_or_download.png[alt="Submit and download license information page."]

With the icon:icon_download[alt="Icon for downloading the data."] [.guihint]#Download report# button, after specifying the desired path, start downloading the archive (a zipped tar archive).
This archive will include a JSON file that contains all of the license information that you see on the [guihint]#License usage# page.

Now exit {CMK} and go to the link:https://portal.checkmk.com/[{CMK} customer portal^].
Log in there with your user credentials to access the menu for uploading the license information.
Select [.guihint]#License Audit# in the left sidebar.

image::license_license_audit.png[alt="Left side menu in the customer portal.", width=35%]

The [.guihint]#License Audit Upload# window will open, into which you drag-and-drop the license information file into the gray field.
Alternatively, click in this field to open a browser window for selecting the file.

image::license_audit_upload_customer.png[alt="License information submission page in the customer portal."]

Enter your password and start the file transfer by clicking the [.guihint]#Upload license audit# button.
A successful upload will be confirmed at completion.

////
text to replace previous text starting with "Now exit {CMK}..." - translation required:

Verlassen Sie nun {CMK} und wechseln Sie zum link:https://portal.checkmk.com/de/[{CMK}-Kundenportal^].
Loggen Sie sich dort mit Ihren Zugangsdaten ein, um die Lizenzinformationen hoch zu laden.
Wählen Sie die Subskription aus, für die Sie die Lizenzdaten hochladen wollen. Ermitteln Sie [.guihint]#Application Account# und Passwort für die Übertragung xref:generate_application_password[wie oben beschrieben].

Öffnen Sie dann mit [.guihint]#Submit License Report# das Fenster zur Übertragung des Lizenzberichts:

image::license_submit_license.png[alt="Dialog zur Lizenzbericht-Übertragung.", width=68%]

Fügen Sie den [.guihint]#Application Account# sowie das zugehörige Passwort ein und geben Sie den Pfad zum Lizenzbericht an. Starten Sie mit [.guihint]#Submit# die Übertragung. Nach erfolgreicher Übermittlung sehen Sie eine Bestätigung.

////


////
currently not required:
=== Supplementary information for tribe29 partners

As a tribe29 partner you can not only report your own license information easily and quickly to tribe29, but also the license information from your customers.
The xref:directtrans[direct transmission] of the customer-related information corresponds exactly to the procedure described above.
Only for the manual transmission are there some minor differences.

If you have direct access to {CMK} at your customer's site, create the license information file as described in the xref:manualtrans[Manual transmission] section.

If you do not have direct access to {CMK} at your customer's site, ask them to download it for you locally and send the resulting file to you.

Afterwards log in to the link:https://portal.checkmk.com/[{CMK} customer portal^] with your access data (additional options are available to tribe29 partners here).
Select [guihint]#Resold licenses# in the menu on the left sidebar.

image::license_resold_licenses.png[alt="Extended left side menu in the customer portal.", width=35%]

The [guihint]#Resold Licenses# window will open.

image::license_resold_licenses_rechts.png[alt="View all related end user licenses in the partner portal."]

Click the icon:button_upload_audit[alt="Button that opens the page for uploading the license information."] button in the line for the corresponding {CMK} customer.

Then, analogous to the procedure described above, define the license information file and start uploading the file by clicking the [guihint]#Upload license audit# button.
The successful upload is finally confirmed.
////