// -*- coding: utf-8 -*-
// IGNORE Blogartikel
include::global_attr.adoc[]
= Proxmox überwachen
:revdate: draft
:title: Proxmox überwachen
:description: Mit {CMK} können Sie auch die Virtualisierungsumgebung Proxmox überwachen. Lesen Sie hier grundlegende Informationen zur Einrichtung.

{related-start}
xref:agent_linux#[Linux überwachen]
xref:special_agents#[Spezialagenten]
link:https://checkmk.com/de/integrations[Katalog der Check-Plugins^]
xref:intro_setup_monitor#[Das Monitoring einrichten]
{related-end}


== Einleitung

[{image-left}]
image::logo_proxmox.png[width=140]

//SK: "Echtzeit" wird m.E. anders verstanden. Echtzeit machen wir mit Real-time checks und das liegt hier nicht vor.
Proxmox-Monitoring ist unerlässlich, um eine Echtzeit-Analyse von VMs und IT-Infrastruktur zu gewährleisten.
Mit dieser Analyse erhalten Sie genaue, zeitnahe Einblicke in den Zustand Ihrer virtuellen Umgebung.

Dieser Artikel behandelt - für den schnellen Einstieg - nur die in {CMK} relevanten Einstellungen.
Er ist damit vor allem für Benutzer gedacht, die "nur noch" {CMK} einrichten wollen.
Wenn Sie sich darüber hinaus für weiterführende Informationen, die Überwachung von Proxmox Clustern und die Einrichtung innerhalb von Proxmox interessieren, empfehlen wir Ihnen den Blogartikel 
link:https://checkmk.com/blog/proxmox-monitoring[Proxmox monitoring: How to do it efficiently with Checkmk.]


== Voraussetzungen in Proxmox

Als Grundlage für eine erfolgreiche Überwachung mit {CMK} muss Ihr Proxmox folgende Voraussetzungen erfüllen:

//SK: Hierzu habe ich Faden in Slack gestartet.
* eingerichtete Proxmox VE Konfiguration mit Benutzer `checkmk` (Read-only Benutzer) und Bereich `pve`
//SK: Folgendes ist eine sehr herzliche Empfehlung, aber keine Pflicht.
* installierter {CMK} Linux-Agent auf den Proxmox-Knoten
//SK: Der Hinweis auf Port 6556 ist alt und sollte zeitnah auch im BLog ersetzt werden.
//* Freigabe für Port 6556 im lokalen Netzwerk


== Einrichtung in {CMK}

//SK: Sehr gut gefällt mir das "geringfügig" nicht. Ich überlege mal.
Sobald Sie die Proxmox-Seite vorbereitet haben, sind {CMK}-seitig nur noch geringfügige Einstellungen notwendig.

//SK: Ich würde hier nicht in den Leitfaden für Einsteiger verlinken. https://docs.checkmk.com/latest/de/hosts_setup.html#create_hosts ist m.E. der richtige Ort.
Legen Sie zuerst einen Host an wie im Abschnitt xref:intro_setup_monitor.html#create_host[Host erstellen] beschrieben.

image::monitoring_proxmox_newhost.png[alt="Einstellung des Monitoring-Agents für den neuen Host."]

//SK: "Configured API integrations and Checkmk agent" funktioniert natürlich nur, wenn der herzliche empfohlene Agent auch wirklich installiert wurde.
//SK: Wenn Sie unserer Empfehlung gefolgt sind, und auch dem Proxmox-Knoten einen Agenten installiert haben, dann setzen Sie die Option....
Setzen Sie dabei die Option [.guihint]#Checkmk agent / API integrations# auf [.guihint]#Configured API integrations and Checkmk agent#.
//SK: Das ist für den Host, der den Proxmox-Knoten repräsentiert nicht korrekt. Diese Einstellung ist nur für die VMs in Proxmox richtig und wichtig.
Da der Spezialagent vorwiegend Piggyback-Daten generiert, empfehlen wir, auch gleich die Option [.guihint]#Always use and expect piggyback data# zu setzen.

Richten Sie danach die Konfiguration des Proxmox-Spezialagenten ein über [.guihint]#Setup > Agents > VM, cloud, container > Proxmox VE# und dann [.guihint]#Add rule#:

image::monitoring_proxmox_addrule.png[alt="Der Spezialagent mit Username, Passwort und expliziten Hosts."]

Als [.guihint]#Username# müssen Sie `checkmk@pve` angeben.
//SK: Statt "können" sollte ich hier "sollten" oder gar "müssen" stehen.
Gleichzeitig können Sie das Monitoring explizit auf Ihre Proxmox-Hosts einschränken. 

//SK: Hier könnte jetzt noch ein CEE-only-Hinweis auf das Dynamic host management. Der Spezialagent karrt ganz viele Daten über die VMs und Container an (Piggyback). Damit hieraus dann Host entstehen, muss man diese entweder mit dem exakt gleichen Namen händisch anlegen (Raw-User) oder eben das Dynamic host management anwerfen. Analog zu bspw. https://docs.checkmk.com/latest/de/monitoring_aws.html#_dynamische_host_verwaltung_einrichten


