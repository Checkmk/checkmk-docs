// -*- coding: utf-8 -*-
// IGNORE
// NONASCII
// NO-LUNR
include::global_attr.adoc[]
= {CMK}-Zertifikate im Überblick
// SH: Gibt es eine Zeichenbegrenzung, dürfen es im Browser gerendert zwei Zeilen sein? Bei Heise u.a. galt 70 wegen SEO.
// TK: Dokleitfaden: Idealerweise sollte der Titel 30 Zeichen nicht überschreiten > also: Möglichst kurz ;-) Zeichenbegrenzungen gibts nur für HTML Meta :title: und :description: unten. Zeilenumbrüche sind aber nicht so schön.
// TK: ... Bei Intern (insbesondere im Titel) frag ich mich, wann denn die externen Zertifikate besprochen werden.
// SH: Artikel-Scope sind nur Checkmk-interne Zertifikate. Marcel plädierte für die Umbenennung der Asciidoc-Datei in certificates_internal o.ä. Mattias fand weiterhin certificates passender. Wir könnten den Titel auch enger fassen als "Zertifikatsübersicht in {CMK}'.
// TK: Titel des Artikels = :title: ist am einfachsten.
:title: Checkmk-Zertifikate im Überblick
:description: Die Seite Certificate overview in der {CMK}-GUI listet die internen Zertifikate auf. Lesen Sie hier, welche Informationen Sie der Seite entnehmen können.
// SH: Meta-Description: 153 Zeichen inkl. Leerzeichen (von max. 155)
// TK: Die Certificate overview > Die Seite Certificate overview. diesem Feature > dieser Seite - denn: Feature ist ein ganz schön großes Wort für die Seite.
// SH: dieser Seite > der Seite wegen Zeichenbeschränkung. "Feature" hatte ich von Entwicklerseite übernommen, lasse ich weg. 
:keywords: certificate, CA
// TK: Ein interner HTMl-Seiten-Präfix wie omd_https ist sicher überflüssig. certificate und CA kommen ja eigentlich auch recht häufig vor im Artikel, aber ok: tut ja nicht weh.
// SH: OK :) 
// SH: Lässt du die :keywords: weg oder wie nutzt du sie?

{related-start}
xref:ports#[Ports]
xref:omd_https#[Weboberfläche mit HTTPS absichern]
xref:distributed_monitoring#[Verteiltes Monitoring]
xref:security#[Sicherheit (Security)]
{related-end}

// TK: Wir wollen link: nur bei Handbuch-externen Links verwenden, bei Handbuch-internen Links nutzen wir xref, also: xref:ports#[blabla] (Lattenzaun ist wichtig, sonst wird der Anker in Deiner Datei certificates gesucht).
// TK: Der Linktext ist jeweils der Titel des Artikels, also z.B. Ports statt Referenzartikel zu den Ports in {CMK}. Im Fließtext kann man den Linktext durchaus freier wählen.
// SH: Erledigt. 
// SH: Meine Blaupause war user_interface, Handbuch-interne Artikel sind dort mit link: und HTML-Syntax verlinkt. Drin lassen oder austauschen?

// TK: Warum listet Du oben ports und distributed_monitoring auf? Port kommt in Deinem Artikel gar nicht vor und distributed_monitoring kann man weiter unten mit einem Glossar-Link besser und leserfreundlicher anbieten.
// SH: Glossar-Links: gute Idee, füge ich weiter unten ein.
// SH: ad "Warum": Technische Gründe. Die Artikelauswahl ist mit MFS abgestimmt. 
// SH: Der Ports-Artikel wurde von Kollegen als "komplementär" zu diesem hier bezeichnet und ich sollte inhaltliche Doppelung vermeiden, ihn verlinken. 
// SH: Ports ist ein Referenzartikel zur internen Kommunikation bei CMK. Zertifikate sichern die interne Kommunikation. Leute, die sich für Zertifikate interessieren (etwa beim Troubleshooting), könnten auch bei den Ports schauen wollen. Soweit ein Gedankengang, der mir logisch schien. 
// SH: Es heißt, dass unsere Leser eher selten auf "Related Articles" klicken und der Knopf auf der Abschussliste steht? 
// SH: In der jetzigen Form nutzen ihn wohl am häufigsten wir Handbuchbearbeiter (Team KNW) als Schnellzugriff. Dafür finde ich ihn prima.

[#intro]
== Einleitung
// SH: Die Einleitung erläutert, grenzt ab, illustriert mit einem Überblicks-Screenshot. Scope eng halten.
// TK: Ich würde den Scope noch enger setzen: In der Einleitung nur die zentralen Begriffe erklären, was CMK liefert und was man als Benutzer damit anfangen kann.
// TK: Alle Information zur Seite selbst mit Screenshot und Tabelle dann in das 2. Kapitel packen, auch weil beide eng zusammengehören.
// TK: Mindestens vor jeder Level 2 Überschrift einen Anker setzen, hier: [#intro]
// SH: OK, füge ich ein. 

// SH: CAs bestätigen die Echtheit bzw. Herkunft eines Schlüssels. Wegen Schlüssel und Zertifikat: MFS-Blogartikel konsultieren.
// SH:  https://checkmk.com/de/blog/how-become-your-own-certificate-authority
// SH: Schlüssel für die CA erstellen: Das ist der Schlüssel, mit dem abgesichert wird. Damit wird der Certificate Signing Request erstellt und signiert. 
// SH: CA ist die die Stelle, die die Vertrauenswürdigkeit der anderen bestätigt. Um das tun zu können, muss sie sich erst selbst Vertrauenswürdigkeit attestieren. Das ist das CA-Zertifikat. 
// SH: In der Overview sieht man nur die Zertifikate. Auch das Zertifikat, mit dem die CA sich selbst die Vertrauenswürdigkeit ausstellt. CA-Zertifikat.
// SH: Wir (CMK) haben das noch nicht so schön umgesetzt und brauchen daher drei CA mit einer Kaskade. 
XXX WiP XXX ... Ein Fingerprint ist ein Hash-Wert, der aus allen Daten eines Zertifikats berechnet wird und dessen eindeutige digitale Kennung darstellt. Er dient als sicherer, unveränderlicher Prüfwert, mit dem sich die Echtheit eines Zertifikats durch Abgleich mit einer vertrauenswürdigen Quelle überprüfen lässt.
Certificate Authorities (CA) sind solche vertrauenswürdige Stellen, die die Echtheit und Herkunft eines Schlüssels bestätigen. Durch die Prüfung von Zertifikaten sichern sie die interne Kommunikation ab, etwa zwischen einer Instanz und den ihr zugeordneten Hosts sowie zwischen den Instanzen im verteilten Monitoring.
// TK: In einem Artikel über Zertifikate würde ich erwarten, dass Du mit Zertifikaten einsteigst und nicht mit den CAs.
// TK: Ich freu mich immer, wenn in der Einleitung die zentralen Begriffe genau(er) erklärt werden, z.B. was Du genau mit absichern meinst, einem Begriff, den Du ja häufiger verwendest.
// TK: Gehts bei Zertifikaten nicht immer um verschlüsselte Kommunikation? Mit einem Zertifikat wird verschlüsselt (mit dem enthaltenen öffentlichen Schlüssel), authentifiziert und es enthält den Berechtigungsnachweis? Eine CA stellt die Zertifikate aus und validiert die Echtheit, also sichert so ab?
// TK: Und was sind Zertifikatsketten, CA-Zertifikate etc, die bei Dir weiter unten noch erwähnt werden?
// TK: In dem Satz bieten sich schon mal ein paar Glossar-Links an, für Begriffe, die nur gestreift, aber nicht weiter vertieft werden.
// TK: Hier also z.B.: xref:glossar#site[{CMK}-Instanz] (ich rate zu {CMK}-Instanz, da Instanz ein recht generischer Begriff ist), xref:glossar#distributed_monitoring[verteilten Monitoring]
{CMK} sichert xref:glossar#site[{CMK}-Instanzen] über eigene CAs ab.

Dabei ist zunächst unerheblich, welche Edition Sie für Ihr Monitoring im Einsatz haben oder in welchem Setup Sie Systeme überwachen, etwa mit einer Einzel-Instanz oder im xref:glossar#distributed_monitoring[verteilten Monitoring]:
// TK: welche Edition: Naja, eher umgekehrt: Wenn es einen Unterschied gibt, dann beschreiben. Wenn es keinen Unterschied gibt, braucht man auch nicht darauf hinweisen.
// SH: Es darf auch manchmal etwas Selbstverständliches drin sein. Später im Gesamtbild entscheiden.
// TK: welchem Setup: Mir ist nicht klar, was Du damit meinst, wahrscheinlich Einzel-Instanz vs. verteiltes Monitoring. Bei Setup denkt man in Checkmk gerne an das Setup-Menü als Einstieg in die Konfiguration. Das meinst Du hier wohl nicht.
{CMK} stattet im Hintergrund alle Monitoring-Instanzen automatisch mit eigenen CAs und internen Zertifikaten aus, die für den Betrieb und für die Kommunikation zwischen den Komponenten eines {CMK}-Setups grundlegend sind, beispielsweise zwischen den Agenten und der Instanz.
// TK: Hier wiederholst Du, was 2 Sätze vorher auch schon stand.
// TK: interne Kommunikation der Instanzen: durch diese Einschränkung ist die Kommunikation von Instanz und Host (via CMK-Agent) nicht mehr dabei.
// SH: in Richtung: Kommunikation zwischen den Komponenten eines Checkmk-Setups, Beispiele bringen. ZB im Distributed Monitoring, zwischen Agenten und Site...


[#table]
== Die Zertifikatsübersicht in {CMK}
Über [.guihint]#Setup > Maintenance > Certificate overview# öffnen Sie die Seite [.guihint]#Certificate overview#, die diese Zertifikate auflistet.
// TK: Wie schon angemerkt, würde ich die GUI-Details ins nächste Kapitel packen.
Die Seite präsentiert auf einen Blick alle grundlegenden Zertifikate, die beim Einrichten Ihrer Instanz {CMK}-seitig erstellt und hinterlegt wurden.
// TK: sieht in allen Editionen identisch aus: Hier würde ich jetzt auf jeden Fall weglassen, dass es keinen Unterschied gibt.
// SH: Lasse ich weg. Identisch legt nahe, dass man dasselbe sieht in der Tabelle: Mit OTel und Ultimate könnte sich das ändern. 

// TK: grundlegenden Zertifikate: Warum die Einschränkung? Gibts noch andere? Ich hoffe nicht ;-)
// SH: Doch, seufz. Es gibt weitere Zertifikate, die hier nicht gelistet sind:
// SH: Die Bakery-Zertifikate zum Beispiel: Signaturschlüssel. Sind dasselbe wie Zertifikate für Netzwerkkommunikation. Tw. verwendet man die gleichen Verschlüsselungsalgorithmen. Dienen aber nicht zum Verschlüsseln von Kommunikation, sondern zur Herkunftsprüfung. Wir müssen nach dem Zweck gehen. 
// SH: Die TLS-Zertifikate in Edit global setting (über der Certificate overview verlinkt). 
// SH: Beim verteilten Monitoring findet sich in den Remote-Instanzen hier nicht die CA für das Signieren der RabbitMQ-Zertifikate, die gibt es nur in der Zentralinstanz. 
// SH: Beim verteilten Monitoring wächst die Liste mit jeder Remote-Instanz, die eingebunden wird. 
// SH: Grundlegende Zertifikate: Kommunikationsrelevante Zertifikate. Dann haben wir wieder Problem mit den TLS-Zertifikaten für HTTPS, die hier nicht drin sind.

Die Seite hat reinen Informationscharakter und dient als interner Schnellzugriff -- etwa, um die Gültigkeit und die Fingerprints der vorinstallierten Zertifikate zu überprüfen. 
// TK: Fingerprint: Toller Begriff, aber steht tatsächlich so im Duden: Na dann bleibt er drin. Wäre aber schön, wenn Du den Begriff oben schon mal eingeführt hättest oder ebn hier kurz erläutern würdest.
Beim Verdacht auf Zertifikatsprobleme kann die Übersicht das Troubleshooting beschleunigen.
Dafür ist die Seite [.guihint]#Certificate overview# die erste Anlaufstelle.

Drei Certificate Authorities werden beim Erzeugen einer {CMK}-Instanz als vertrauenswürdige Herausgeberinnen von Zertifikaten stets individuell per Zufallsgenerator erzeugt, die Seite listet deren CA-Zertifikate auf:
// TK: Zufallsgenerator? Hm, verstehe nicht, wie, wo und warum da der Generator angeschmissen wird.
// SH: Diese Info habe ich von MFS. Wir hatten uns ausgiebiger darüber unterhalten, wo die Mutterzertifikate und CAs herkommen. Die fallen vom Himmel, sagte er. Und erwähnte den Zufallsgenerator.

. ein CA-Zertifikat zum Signieren des Agenten der Instanz,
// (Site 'mysite' agent signing CA)
// TK: Eine CA signiert?
// TK: Es gibt in der Instanz keinen Agenten. Der Agent ist auf dem Host, der überwacht wird. Der Agent Controller dieses Agenten auf dem Host kommuniziert mit (der SW-Komponente) Agent Receiver in der Instanz. Was hier gemeint ist, weiß ich leider nicht.
. ein CA-Zertifikat für den lokalen Message Broker,
// (Site 'mysite' broker CA?)
. ein CA-Zertifikat für die Absicherung der Distributed-Piggyback-Kommunikation.
// (Site 'mysite' local CA?)

// SH: Abgrenzungsproblem wegen inkonsistenter Terminologie: Sind hier wirklich CAs = Certificate Authorities gemeint oder geht es bereits um Zertifikate, die von übergeordneten CAs abgeleitet sind? Unsere IT verwendet den Begriff CA etwas "sloppy", meinte MFS: Mal ist mit CA der Herausgeber von Zertifikaten gemeint, mal steht CA für das Herausgeberzertifikat/CA-Zertifikat. CA steht in beiden Kategorien, einmal als Subjekt und dann als Herausgeber. Wäre nicht Subject = Zertifikat und Issuer = die vertrauenswürdige Stelle/der Herausgeber von Zertifikaten? Beides wird synonym in unserer GUI als CA bezeichnet. Wir wollen im Handbuch so präzise wie möglich formulieren, dabei aber offen bleiben für künftige Änderungen. Hierzu bitte noch einen Prüfblick von MFS, der mit dem Problem vertraut ist und das Gemeinte hinter der Terminologie erfasst. Ich fand es schwierig, etwas präzise zu beschreiben, was in der GUI uneindeutig deklariert ist. Ich will keinen Unfug nach außen tragen.
// TK: Unsere IT: Du meinst unsere Entwicklung, oder?
// TK: Grundsätzlich: Auch hier steigst Du mit den CAs ein. Sind die Zertifikate nicht wichtiger?
// TK: Hilft nix, aber die Inkonsistenzen musst Du noch klären: Wie ist die aktuelle Implementierung und (zu Deinem Verständnis) warum wurde es so gemacht? Wenn Du einen besseren Vorschlag hast, kannst Du dann ein CMK-Ticket schreiben.
// TK: Es spricht ja auch nichts dagegen, hier oder in der Tabelle unten zu beschreiben, dass sowohl Zertifikate als auch CAs in der Tabelle stehen (wenn es denn so ist).

// TK: Wenn ein Kommentar erledigt ist, dann gleich weg damit. Datei ist ja eh schon unübersichtlich genug ...

// ML: Zu sloppy: Ich würde auch eher schlicht von Zertifikatskette reden und den Rest Lesern/Entwicklern überlassen ... (bei mysite.pem zum Beispiel ist "mysite_pro" aus der Spalte "subject name" der Common Name (CN)) 
// SH: Das ist einer der Knackpunkte im Artikel. Wie präzise können, wollen und müssen wir sein? Je präziser der Artikel ist, desto hilfreicher für die Leser. Aber wenn der Artikel präziser ist als die Ansprache in der GUI, haben wir eine Disprepanz zwischen Erklärtext und Erklärtem. Das stiftet Verwirrung. Hierzu möchte ich das Review von Thomas abwarten. TK, wie würdest du den Begriffskonflikt lösen?
// TK: Sorry, hier muss ich passen, siehe Kommentar oben. Nochmal ran, nachfragen und verstehen, was da gespielt wird.
// SH: Marcel lässt gerade auf dem kurzen Dienstweg die Bezeichnungen ändern. Dazu gibt es eine Kommunikation auf Slack mit Hannes, Maximilian, MFS und mir.
// SH: Ich habe den Kommentar aus diesem Grund drin gelassen, das ist noch nicht gelöst. 


// TK: Wie oben schon gesagt: Den folgenden Screenshot und den Absatz danach würde ich in das nächste Kapitel schieben (Arbeitstitel: Die Zertifikate im Detail).
// [discrete]
// === Screenshot-Platzhalter
.[.guihint]#Certificate overview#: Übersicht der internen {CMK}-Zertifikate
image::certificate_overview_page.png[alt="Certificate Overview Page in {CMK}.",fullscreen=1]
// TK: BU: [.guihint]#Certificate overview#: würde ich löschen: Man sieht ja im Screenshot, wie die Seite heißt.
// TK: BU: internen: Da stolpere ich schon wieder drüber und frage mich, wo die externen {CMK}-Zertifikate sind.
// TK: Alt-Text: Da wir da nicht mit guihints auszeichnen können, steht im Dokleitfaden: GUI-Texte in Alt-Texten möglichst vermeiden. Wenn doch notwendig, dann den GUI-Text in einfache Anführungszeichen setzen. Also hier sowas wie: alt="Die Seite 'Certificate overview' in {CMK}."
// TK: Screenshot-Inhalt: Navigationsleiste links löschen, die Margin unter der Tabelle verkleinern, No pending changes oben rechts löschen
// ML: Der erste Satz ist etwas verwirrend, die Einträge enthalten ja alle die Metadaten
// SH: Stimmt, ich schreibe einen neuen ersten Satz davor, der das übergeordnet umreißt. Statt "Die CAs und die CA-Zertifikate als Herausgeberzertifikate" schreibe ich wohl besser allgemein von "Zertifikatsketten".
Die Übersicht listet die internen Zertifikatsketten mit ihren Metadaten auf.
// TK: Zertifikatskette hilft nicht beim Verständnis, wenn Du nicht beschreibst, was es ist (am besten ganz vorne bei der Einführung der Begriffe).
Darin finden Sie in der Rubrik [.guihint]#Subject Name# die ausgegebenen Zertifikate und unter [.guihint]#Issuer# deren ausgebende Stelle (die Ursprungs-CA), jeweils mit dem dazugehörigen Erstellungs- und Ablaufdatum.
// TK: Statt Ursprungs-CA Root-CA schreiben?
Für jedes Zertifikat sind neben der Laufzeit dessen genaue Bezeichnung, der individuelle Fingerprint, der Schlüsseltyp (RSA), die Schlüssellänge in Bits und der Speicherort hinterlegt.
Diese Daten unterscheiden sich von Instanz zu Instanz und sind im Screenshot nur beispielhaft veranschaulicht.
// TK: Obiger Satz ist für mich überflüssig.
Werfen Sie zur Orientierung ruhig einen Blick in Ihre eigene Instanz, die Schlüssellänge und andere Elemente können vom Beispiel abweichen.
// TK: Der Satz ist dagegegen ok.

Die [.guihint]#Certificate overview page# listet Ihnen dort per Default fünf Zertifikate auf:

// SH: Direkt als Tabelle anlegen mit Referenzen? Oder erst Bullet Points für den Überblick und dann die Tabelle? Inhaltlich sollte ich das nochmal mit MFS durchgehen, um Konsistenz zur Tabelle zu wahren. Die Bezeichnung Site-Zertifikat ist zu prüfen. Was ist der korrekte Begriff für die Zertifikatsklasse, die mTLS absichert?

* das Root-Zertifikat der Instanz.
* ein Zertifikat, das mTLS absichert -- es ist für das "m" in mTLS zuständig, also für die beidseitige (mutual) sichere Authentifizierung von Client und Server, die das Standard-TLS-Protokoll erweitert: So werden bei {CMK} die Agenten signiert.
* das lokale Message-Broker-Zertifikat.
* das CA-Zertifikat, mit dem die individuellen Zertifikate für die Message-Broker-Kommunikation mittels der quelloffenen Broker-Software RabbitMQ abgesichert werden.
* ein Zertifikat, das der SSL-Verschlüsselung dient.
// TK: Die Liste braucht es hier gar nicht, weil es die Informationen der Tabelle unten doppelt bzw. wg. Inkonsistenz der Begriffe zusätzliche Fragen aufwirft.
// TK: Die Spalte Funktion der Tabelle unten sollte dann eine vollständige Beschreibung liefern.
// TK: In der Einleitung würde mir genügen zu erfahren, für welche Kommunikationswege in CMK die Zertifikate verwendet werden können.

[TIP]
====
Dabei handelt es sich um den Standard-Bausatz, der systemintern jeder Instanz für den Betrieb mit auf den Weg gegeben wird.

Die Liste erhebt keinen Anspruch auf Vollständigkeit.
====

// Link zu omd_https einbauen in AsciiDoc-Syntax: nachschauen.

// SH: MFS betonte, dass wir einen Satz zum Ausschluss von Vollständigkeit hineintexten müssten. Allerdings kann die Certificate Overview Page im jetzigen Zustand vom User gar nicht erweitert werden, soweit ich Maximilian Wirtz verstanden habe. Zumindest nicht in absehbarer Zeit. Ist der Ausschluss auf künftige Szenarien bezogen -- rein prophylaktisch, oder könnten da auch jetzt schon mehr Einträge stehen? Im Distributed Monitoring vielleicht?
// TK: Ich bin da nicht bei MFS. Der Satz "Die Liste erhebt keinen Anspruch auf Vollständigkeit." gefällt mir gar nicht. Keine Vollständigkeit liest sich so, als ob wir bei Checkmk nicht wissen, was wir mitliefern.
// TK: Aber: Ausweg? Warum überhaupt eine Aussage zur Vollständigkeit treffen?

// SH: Warum ist das so, dass Cmk eine eigene CA hat/ mitliefert? Sukzessive aufbaubar.

// SH: Hier werden die Zertifikate für die interne Kommunikation beschrieben:
// Root-Zertifikat.
// Site-Zertifikat für die mTLS-Kommunikation zwischen Agent Controller und Agent Receiver. Stimmt hier der Begriff Site-Zertifikat?
// Local Message Broker CA und
// Zertifikat für die Absicherung der Distributed Piggyback-Kommunikation.
// Zertifikat Signing Agent: Für das "m" in mTLS zuständig, weil den Zertifikaten gegenseitig vertraut werden muss.
// Das sind die Stichwörter, nach denen ich suchen kann im Handbuch.

[#table]
== Zertifikate für die interne {CMK}-Kommunikation
// TK: Referenztabelle hat meiner Meinung nach nichts in der Überschrift zu tun. So nennen *wir* so ein Ding, aber unseren Lesern ist das doch egal.

[cols=4, options="header"]
|===
| Dateipfad im Ordner `~/etc` | Funktionsbeschreibung | Position in der Zertifikatskette | Komponenten in {CMK}
// SH: Reicht in der fünften Spalte als Header "Komponente" oder brauchen die Leser einen Hinweis, dass sie hier vertiefend weiterlesen können?
| [.guihint]#ssl/ca.pem# | _Root-Zertifikat_: sichert die Instanz | CA-Zertifikat | xref:livestatus#[Livestatus], xref:wato_monitoringagents#[Monitoring-Agenten], ... (Link folgt)
// SH: Livestatus und Agent Monitoring sind verlinkt. MFS recherchiert, was da weiter zu referenzieren ist.
| [.guihint]#ssl/agent/ca.pem#| _CA-Zertifikat für Signierung der Agentenschlüssel_: signiert den Agenten und sichert mTLS ab – Certificate Signing Request von der Gegenseite (Agent Controller von Hosts im Monitoring) wird mit diesem Zertifikat signiert  | CA-Zertifikat  | xref:wato_monitoringagents#[Monitoring-Agenten], darin: xref:wato_monitoringagents#bakery[Agent Bakery]
// SH: Bezeichnung unklar: Ist es ein Intermediate-Zertifikat? Laut Maximilian haben wir in der Overview aber keine Intermediates. Dann müsste es ein Root-Zertifikat sein. Wir klären die korrekte Bezeichnung noch. Zur Komponente: auf die Monitoring-Agenten verweisen.
| [.guihint]#​sites/mysite.pem# | _Instanz-Zertifikat_: bestätigt die Echtheit des Schlüssels, der für die Netzwerkkommunikation verwendet wird | sichert Kommunikation ab | xref:livestatus#[Livestatus] und xref:wato_monitoringagents#[Monitoring-Agenten] (Agent Receiver)
// SH: Agent Receiver und Livestatus, verweisen auf Monitoring-Agenten. Braucht der Agent Receiver dann noch einen eigenen Link?
| [.guihint]#rabbitmq/ssl/ca_cert.pem# | _CA-Zertifikat für RabbitMQ_: sichert die Zertifikate der individuellen Message Broker, etwa für Distributed Piggyback-Kommunikation | CA-Zertifikat | xref:piggyback#[Piggyback] und xref:distributed_monitoring#[Verteiltes Monitoring] 
| [.guihint]#​rabbitmq/ssl/cert.pem# | _SSL-Zertifikat_: dient der SSL-Verschlüsselung und sichert Netzwerkkommunikation des Message Brokers ab |  sichert Kommunikation ab | xref:piggyback#[Piggyback] und xref:distributed_monitoring#[Verteiltes Monitoring]
// SH: Wording noch nicht präzise genug. Die exakte Formulierung finden wir noch mit MFS. 
|===
// TK: Dateipfad im etc-Ordner > Dateipfad im ~/etc-Ordner: Tilde ist das Home-Verzeichnis = Instanzverzeichnis
// TK: Kursive Formatierung der Pfade: Ich weiß, dass das so in der GUI steht, also liegt guihint nahe. Ich würde trotzdem als Befehlstext mit `blabla` auszeichnen, weil das eben auch Pfadnamen sind.
// TK: Unter Typ steht CA-Zertifikat. Was ist ein CA-Zertifikat?
// TK: Unter Typ steht sichert Kommunikation ab. Das ist aber kein Typ.
// SH: Die Begriffe habe ich von meinen Expertenquellen übernommen. Das ist mit MFS von technischer Seite abgestimmt. Wir haben es hier entweder mit CAs (korrekter Begriff: Zertifikatsinstanzen) zu tun oder mit solchen, die zum Absichern der Kommunikation gedacht sind. Genauer als meine technischen Expertenquellen kann ich Newjoiner das nicht beschreiben. Wenn ich Zertifikatsinstanz sage, bekommen wir wilden Begriffsalat mit den Monitoringinstanzen (Sites). 

// TK: Braucht es die Spalte Bezeichnung? Denn die Einträge sind eben nicht die, die man in der GUI sieht. Ich finde das verwirrend, weil ich die Einträge in der GUI + im Handbuch nicht zuordnen kann. Das geht nur über den Pfadnamen.
// SH: Begriffe in die Spalte Funktion ziehen. Kursiv auszeichnen: _TEXT_

// TK: Spalte Komponente: Ist nicht besonders treffend benannt (wie Du ja selbst angemerkt hast). Evtl. Weiterführende Informationen? Das setzt aber voraus, dass es immer einen Handbuchlink gibt.
// TK: Spalte Komponente: Direkt in das Kapitel verlinken, wo auch was zu Deinem Thema steht. Wenn da nichts steht, dann besser einen Glossar-Link einfügen, sofern vorhanden.
// TK: Spalte Komponente: Schon der 1. Link zu Livestatus wirft allerdings Fragen auf. 1. Fundstelle für Zertifikat in diesem Artikel: "Livestatus nutzt ein Zertifikat, welches beim Erstellen der Site automatisch generiert wird. Dieses befindet sich mit allen anderen CA-Zertifikaten, denen die Site vertraut in der Datei var/ssl/ca-certificates.crt." Uff, das hat ja so ziemlich gar nichts mit dem zu tun, was auf Deiner Seite zu sehen ist. 
// SH: Das war alles so mit MFS in München abgestimmt. Die Zertifikate sind im Handbuch weit verstreut, ich habe nicht überall einen exakten Deep Link.
// TK: Link zu Distributed Monitoring > Verteiltes Monitoring

Die allgemeine Steuerung vertrauenswürdiger Zertifikate für die TLS-verschlüsselte Kommunikation zwischen dem {CMK}-Server und den Agenten auf Ihren überwachten Hosts ist in einem gesonderten Bereich der Benutzeroberfläche zu finden.
Die Einstellungen dafür lassen sich unter [.guihint]#Setup > General > Global Settings > Edit global setting# einsehen und verwalten.
// TK: In dem GUI-Pfad fehlt gerade die Einstellung, um die es geht.
Von der Seite [.guihint]#Certificate overview# können Sie die [.guihint]#settings# wahlweise über den gleichnamigen Text-Link oberhalb der Zertifikatstabelle ansteuern oder dem Menüeintrag [.guihint]#Related > Trusted certificate authorities for SSL# dorthin folgen.
// TK: Menü-Eintrag > Menüeintrag
// TK: Man kann beide Wege beschreiben. Trotzdem würd ich mich für einen Weg entscheiden. Ich würde den Text-Link nicht erwähnen.
// TK: Von der [.guihint]#Certificate overview# Ihrer Instanz aus können Sie die [.guihint]#settings#: Das liest sich holprig, evtl. so: Von der Seite Certificate overview können Sie diese Einstellung öffnen mit dem Menüeintrag Related > Trusted certificate authorities for SSL.

Zertifikate des System-Apache, also des Apache-HTTP-Webservers Ihres Systems, sind relevant etwa für ein Agenten-Update, für die Nutzung der REST-API und die Weboberfläche.
Dafür sind Sie als Serveradministrator selbst verantwortlich.
Der Instanzbenutzer einer {CMK}-Instanz hat in der Regel keine Zugriffsrechte: Diese Zertifikate sind zwar wichtig, werden aber in der Seite nicht aufgelistet, weil sie nicht Bestandteil der {CMK}-Software sind.

[IMPORTANT]
====
Diese Zertifikate müssen mit Root-Rechten durch den Serveradministrator ausgerollt werden!
====

// SH: Schön ausformulieren später noch. "Diese Zertifikate" ausformulieren ohne Doppelung.
// TK: Inhaltlich steig ich hier mal aus ;-)
// TK: Nutzer > Benutzer, Web-Interface > Weboberfläche
// TK: eventuell hinzufügen, dass diese zwar wichtig sind, aber in der Seite nicht aufgelistet werden, weil sie nicht Bestandteil der CMK-SW sind.
Hier ist noch zu erwähnen, dass auch in einem verteilten Monitoring mit zentralem Setup die Weitergabe von Einstellungen über eine REST-API läuft.
// TK: Hier ist noch zu erwähnen, dass: Puh, etwas unelegant. Ich versteh auch nicht, warum das überhaupt hier und jetzt erwähnenswert ist.
// TK: Übrigens gibt es auch einen Glossareintrag für verteiltes Monitoring mit zentralem Setup 
Wenn Sie wissen wollen, wie Sie Ihre Weboberfläche mit HTTPS absichern, können Sie im xref:omd_https#[HTTPS-Monitoring-Kapitel] weiterlesen.
// TK: HTTPS-Monitoring-Kapitel: Aus 2 Gründen nicht so gut: 1. Dein Linkziel ist ein Artikel, kein Kapitel. 2. Im Artikel geht es nicht um HTTPS-Monitoring, sondern wie man den Server (meinetwegen auch Monitoring-Server) per HTTPS absichert.
// SH: Ich wollte eine Tautologie vermeiden, das ist schon in "wie Sie Ihre Weboberfläche mit HTTPS absichern" fast wortgleich enthalten.
// TK: Was mir sonst noch so eingefallen ist:
// TK: Über das verteilte Monitoring hatten wir ja schon gesprochen. Zusätzliche Zertifikate in die Tabelle aufnehmen und anmerken, dass die nur in einer Zentral- und/oder Remote-Instanz angezeigt werden/relevant sind.
// TK: Schon mal vormerken: In der 2.5.0 kann man sich die PEM-Dateien per Download-Button speichern (Werk 18677).
// TK: Dann könnte man auch ein,zwei,drei Worte über das PEM-Dateiformat verlieren.
// TK: Von der Komplexität sehr ähnlich zu Deiner Seite ist übrigens der Artikel analyze_configuration (1 Seite in der GUI, aber da kann man wenigstens ein bischen was tun).
// TK: Letzte Kommentarzeile :-)

// Schlüssellänge etc. kann sich ändern, die sollen User in ihren eigenen Instanzen anschauen. Beim Distributed Monitoring gibt es mehr Einträge. 
// Rein muss: "kein Anspruch auf Vollständigkeit" --> habe ich in eine Admonition gepackt. Dazu ist eine Frage anhängig.
// Bezeichnung des Zertifikats, Typ des Zertifikats: Handelt es sich um ein CA-Zertifikat oder um eines, mit dem Kommunikation abgesichert wird?
// Dann Link zu der Komponente im Handbuch ergänzen. Done.

// SH: Abgrenzung zu omd_https, separat: Expliziter Hinweis evtl. als Admonition oder unter die Tabelle, dass die Zertifikate für die HTTPS-Kommunikation in der Verantwortung der Server-Admins liegen, und auf omd_https verlinken. Done. 

// SH nach Gespräch mit MW: Einen direkten Nutzen für die Anwenderinnen und Anwender erfüllt diese Seite nicht. Sie dient einem internen Zweck als Schnellzugriff für das Troubleshooting durch Checkmk-Consultants, die hier auf einen Blick die drei Checkmk-eigenen Certificate Authorities finden, die Ihre Instanz absichern.

// Scope eng halten. Consultants machen damit was. Die Seite ist eine reine Information zur Recherche. "Ich habe ein Problem, ich möchte etwas wissen" - nicht: ich möchte etwas tun. Informationsseite. Es gibt hier nichts zu tun. Scope: diese Seite, die Certificate Overview Page. Wenn ich ein Problem habe mit Zertifikaten, die von Checkmk selbst ausgestellt werden, ist das die erste Anlaufstelle.

// Information reinbringen: Wie sie mit anderen Bereichen zusammenhängt. "Wenn du mehr Informationen zu xy haben willst... dann schau hier: ... (Link)" ----> Wo werden die Zertifikate benutzt? Querverweis auf die Artikel. "Guck dir das an, dann siehst du unter Umständen schon, woran es liegen könnte." ---> Referenztabelle

// ... zwischen Central und Remote site. Für REST-API etc. geh rüber zu omd_https. Möglicherweise reicht eine Tabelle, von der aus die Leser in die jeweiligen Artikel weitergeschickt werden. Livestatus-Zertifikate > Remote und Central site etc.

// SH Abgrenzung: Für die Zertifikate des System-Apache ist der Nutzer selber verantwortlich. Diese Zertifikate sind relevant für Agenten-Update, REST-API und Web-Interface. Hier ist noch zu erwähnen, dass auch in einem Distributed Setup (in einem verteilten Monitoring mit einem zentralen Setup) die Propagation von Einstellungen über eine REST-API läuft und hinsichtlich des System-Apache: omd_https.

// Für die 2.5 müssen wir nochmal ran. Für die 2.4 haben wir erstmal alles, was rein muss.

// Wir haben noch keine Möglichkeit, die Zertifikate auszutauschen zurzeit. Ist der Download-Button schon drin? Nachgeschaut: Button, um Zertifikate auch herunterzuladen: Nein, existiert noch nicht. Künftige Erweiterung: Den Austausch von Zertifikaten zu beschreiben, wenn Zertifikate kompromittiert sind. Da gibt es bisher eine Möglichkeit, das auf der Kommandozeile zu tun (sagte Max, siehe Notizen). Sehr hacky, eher für die KB. ---> Sollten wir das im Artikel überhaupt erwähnen?


// ML: Oder mach es Dir einfach, lies eine der pem-Dateien aus und füge den Kram als Terminal-Session ein - würde dem Artikel was Hübsches hinzufügen ;) Etwa so:
////
[{shell}]
----
{c-user} while openssl x509 -noout -text; do :; done < ca.pem
Certificate:
    Data:
        Version: 3 (0x2)
        Serial Number:
            6a:c7:03:96:e7:e1:f9:09:04:d5:65:91:21:e8:ba:80:c4:74:85:46
        Signature Algorithm: sha512WithRSAEncryption
        Issuer: CN = Site 'mysite_pro' local CA, O = Checkmk Site mysite_pro
        Validity
            Not Before: Nov  7 14:50:38 2025 GMT
            Not After : Nov  7 14:50:38 2035 GMT
        Subject: CN = Site 'mysite_pro' local CA, O = Checkmk Site mysite_pro
        Subject Public Key Info:
            Public Key Algorithm: rsaEncryption
                Public-Key: (4096 bit)
                Modulus:
                    00:b3:6d:d4:f9:35:d6:2d:fd:1f:aa:5d:ec:26:0b:

----
////
// TK: Dass man per openssl-Befehl selbst in die Zertifikatsdetails reinschauen kann, finde ich interessant, würde das aber nur ganz hinten im Artikel als neues Kapitel anhängen.
// TK: Kann für Dich ganz interessant sein, um zu sehen, welche der Zertifikatsdetails wie in der GUI aufbereitet werden.
// TK: Bytheway: openssl x509 -in ca.pem -text scheint genauso zu funktionieren und ist für mich leichter lesbar als Mircos Befehl.
// TK: In der Befehlszeile den kompletten Pfad zum Instanzverzeichnis angeben: ~/etc/ssl/ca.pem, sonst funktioniert weder der eine noch der andere Befehl.
