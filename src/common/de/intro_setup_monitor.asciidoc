// -*- coding: utf-8 -*-
// IGNORE 2c muc Willkommens
// NONASCII
include::global_attr.adoc[]
= Das Monitoring einrichten
:title: Das Monitoring einrichten
:description: Nach der Einrichtung von {CMK} nehmen Sie Hosts ins Monitoring auf. Lesen Sie hier, wie Sie Services von Hosts konfigurieren und Änderungen aktivieren.

{related-start}
xref:hosts_setup#[Verwaltung der Hosts]
xref:agent_linux#[Linux überwachen]
{related-end}


[#welcome]
== Willkommen bei Checkmk!

So, {CMK} steht bereit.
Nachdem Sie sich im vorherigen Kapitel erfolgreich bei {CMK} angemeldet haben, werden Sie mit einem herzlichen Willkommen bei {CMK} begrüßt.
Seit Version {v25} ist die Willkommens-Seite der neue Startpunkt für frisch angelegte Instanzen, bei denen sich ein {CMK}-Administrator anmeldet.
Die Einschränkung auf Administrator-Benutzer liegt daran, dass die Aktionen, die hier ausgeführt werden können, Berechtigungen benötigen, die in der Regel nur {CMK}-Administratoren haben.
// ES: Umformulierungsvorschlag, weil "das liegt daran" für mich irgendwie unerwartet kam, worauf bezieht sich "das"?

ifdef::onprem[]
.Standardmäßig begrüßt Sie {CMK} mit der Willkommens-Seite
image::intro_welcome.png[alt="Die Willkommens-Seite als {CMK}-Startseite.",fullscreen=1]
endif::[]
ifdef::saas[]
.Standardmäßig begrüßt Sie {CMK} mit der Willkommens-Seite
image::intro_welcome_saas.png[alt="Die Willkommens-Seite als {CMK}-Startseite.",fullscreen=1]
endif::[]

Die Willkommens-Seite verankert den Zugang zu hilfreichen Informationen direkt in der Benutzeroberfläche.
Sie hilft Ihnen dabei, schnell die wichtigsten Konfigurationsaufgaben in {CMK} zu erledigen, z. B. die Erstellung von xref:glossar#host[Hosts], die Anpassung von xref:glossar#service[Services] oder die Einrichtung von xref:glossar#notification[Benachrichtigungen].

Dazu dient die Liste der Themen [.guihint]#Topics to explore#.
Die einzelnen Themen sind so aufgebaut, dass Sie schnell zum Ziel kommen.
Ein Thema zeigt zuerst eine kurze, einführende Information und gibt dann konkrete Anweisungen, die Sie anschließend direkt in mehreren Schritten in der GUI ausführen können.
Die zugehörige Seite in {CMK} können Sie dabei durch Anklicken eines Knopfs in der Aufgabe direkt öffnen, ohne manuell durch die GUI zu navigieren.
// ES: Wenn "Aufgabe" die Unterpunkte jedes Themas meint, brauche ich als Leserin eine explizite Erklärung dieses Terms.
Wenn Sie ein Thema erledigt haben, können Sie dieses als abgeschlossen markieren und mit dem nächsten Thema fortsetzen.
Trotzdem haben Sie die Möglichkeit, zu bereits erledigten Schritten zurückzukehren.

Gleich das erste Thema in den [.guihint]#Topics to explore# erklärt, wie Sie in wenigen Schritten Ihren ersten Host ins Monitoring aufnehmen können.
{CMK} ohne Hosts zu verwenden, ist nur mäßig spannend, denn ohne etwas zu überwachen, bleibt die Monitoring-Oberfläche leer und man sieht nicht wirklich das, was {CMK} kann.

.Das erste Thema auf der Willkommens-Seite
image::intro_welcome_add_host.png[alt="Das Thema zum Erstellen des ersten Hosts auf der Willkommens-Seite."]

In den Themen der Willkommens-Seite steht das „Wie?“ im Vordergrund und das „Warum?“ im Hintergrund.
Wenn Sie ausführlichere Informationen suchen, dann finden Sie diese, wie von {CMK} gewohnt, in diesem Handbuch und insbesondere auch in diesem Leitfaden für Einsteiger.
Willkommens-Seite und Leitfaden haben das gleiche Ziel, Sie bei der Einrichtung des Monitorings zu unterstützen.
Auch in diesem Kapitel des Leitfadens für Einsteiger werden wir Ihnen noch zeigen, wie Sie Ordner und Hosts erstellen können.
Versprochen.

Wenn Sie gleich mit dem ersten Thema in den [.guihint]#Topics to explore# beginnen wollen, beachten Sie zuvor noch einige Hinweise zum Umgang mit der Willkommens-Seite.
Wenn Sie auf eine andere Seite in {CMK} abgesprungen sind, können Sie sich die Willkommens-Seite auf verschiedenen Wegen zurückholen:

* Auf der linken Seite der {CMK}-Benutzeroberfläche finden Sie die xref:intro_gui#navigation_bar[Navigationsleiste].
Ein Klick auf das {CMK}-Logo ganz oben in der Navigationsleiste öffnet wieder die Startseite.
Diese Startseite ist und bleibt die Willkommens-Seite, sofern Sie das nicht selbst manuell geändert haben.

* Die Willkommens-Seite können Sie immer öffnen über die Navigationsleiste, das [.guihint]#Help#-Menü, das Thema [.guihint]#Learning {CMK}# und den Eintrag [.guihint]#Welcome page# -- oder kürzer über [.guihint]#Help > Learning {CMK} > Welcome page#. 

* In der xref:intro_gui#sidebar[Seitenleiste] auf der rechten Seite befindet sich ganz oben das Snapin [.guihint]#Welcome to {CMK}#: +
+
.Mit dem obersten Snapin kommen Sie zurück zu den Themen der Willkommens-Seite
image::intro_snapin_welcome.png[alt="Das Snapin Welcome to {CMK}.",width=50%]
+
Ein Klick auf [.guihint]#Continue exploration# öffnet ein sogenanntes _Slideout_.
In einem Slideout werden temporär für den aktuellen Kontext passende Informationen angezeigt.
Ein Slideout schiebt sich von der rechten Seite ein Stück weit über die aktuelle Seite in {CMK}, die dabei abgeblendet wird.
Wenn das Slideout nicht mehr benötigt wird, können Sie es einfach wieder schließen. +
Das Snapin [.guihint]#Welcome to {CMK}# öffnet ein Slideout, dass die [.guihint]#Topics to explore# zeigt.
Es wird das erste Thema angezeigt, das noch nicht abgeschlossen ist, das heißt Sie können dort weitermachen, wo Sie aufgehört haben.

Wenn Sie sich sicher genug in der {CMK}-Benutzeroberfläche zurechtfinden und die Willkommens-Seite nicht länger als Startseite benötigen, können Sie die Startseite wechseln.
Auf der Willkommens-Seite ganz unten finden Sie die Checkbox [.guihint]#Show welcome page on start#.
Indem Sie diese Checkbox abwählen, wird die Startseite ausgewechselt und auf das Standard-xref:glossar#dashboard[Dashboard] gesetzt.
Die zugehörige Änderung können Sie nachverfolgen, indem Sie im [.guihint]#User#-Menü der Navigationsleiste den Eintrag [.guihint]#User profile > Edit profile# auswählen.
Die Option [.guihint]#Start URL to display in main frame# ist nun auf [.guihint]#Default start URL# gesetzt.
Durch Auswahl von [.guihint]#Welcome page# können Sie sich jederzeit die Willkommens-Seite als Startseite zurückholen.


[#hosts_services_agents]
== Hosts, Services und Agenten

Bevor wir in diesem Leitfaden mit den ersten Schritten ins Monitoring beginnen, werden wir kurz einige wichtige Begriffe erläutern.
Das beginnt mit dem *Host*:
Ein Host ist in {CMK} jedes eigenständige, physische oder virtuelle System, das von {CMK} überwacht wird.
// TK: Wegen {CMK} Relay passen SNMP-Geräte im folgenden Satz jetzt auch in die saas.
In der Regel handelt es sich um Dinge mit eigener IP-Adresse (Server, Switches, SNMP-Geräte, virtuelle Maschinen), aber auch um beispielsweise Docker Container oder andere logische Objekte ohne eine solche IP-Adresse.
Jeder Host hat immer einen der Zustände {UP}, {DOWN}, {UNREACH} oder {PEND}.

Auf jedem Host wird eine Anzahl von *Services* überwacht.
Ein Service kann dabei alles Mögliche sein, zum Beispiel ein Dateisystem, ein Prozess, ein Hardware-Sensor -- aber auch einfach nur eine bestimmte Metrik wie die CPU-Auslastung oder die RAM-Nutzung.
Jeder Service hat einen der Zustände {OK}, {WARN}, {CRIT}, {UNKNOWN} oder {PEND}.

Damit {CMK} von einem Host Daten abfragen kann, ist ein *Agent* notwendig.
Das ist ein kleines Programm, das auf dem Host installiert wird, und  Daten über den Zustand (oder die „Gesundheit“) des Hosts liefert.
Server, auf denen Windows, Linux oder Unix läuft, können von {CMK} nur dann sinnvoll überwacht werden, wenn Sie dort einen von uns gelieferten {CMK}-Agenten installieren.
// TK: Wegen {CMK} Relay passt jetzt auch der folgenden Satz in die saas.
Bei Netzwerkgeräten und vielen Appliances hat meist der Hersteller bereits einen Agenten eingebaut, den {CMK} ohne Weiteres mit dem standardisierten Protokoll SNMP abfragen kann.
Cloud-Dienste wie Amazon Web Services (AWS) oder Azure stellen stattdessen eine Schnittstelle („API“) bereit, die von {CMK} per HTTP abgefragt werden kann.


ifdef::onprem[]
[#dns]
== Vorüberlegungen zu DNS

Auch wenn {CMK} keine Namensauflösung von Hosts voraussetzt, erleichtert ein gut gepflegtes Domain Name System (DNS) die Konfiguration erheblich und vermeidet Fehler, denn {CMK} kann dann die Namen der Hosts selbständig auflösen, ohne dass Sie IP-Adressen in {CMK} eintragen müssen.

Der Aufbau des Monitorings ist daher ein guter Anlass, zu überprüfen, ob Ihr DNS auf dem neuesten Stand ist und gegebenenfalls dort fehlende Einträge zu ergänzen.
endif::[]


[#folders]
== Ordnerstruktur für Hosts

{CMK} verwaltet Ihre Hosts in einem hierarchischen Baum von Ordnern -- ganz analog zu dem, was Sie von Dateien in Ihrem Betriebssystem kennen.
Wenn Sie nur eine Handvoll Hosts überwachen, mag das für Sie weniger wichtig sein.
Aber erinnern Sie sich:
{CMK} ist für das Überwachen von Tausenden und Zigtausenden Hosts geschaffen -- und dabei ist Ordnung die halbe Miete.

Bevor Sie die ersten Hosts in {CMK} aufnehmen, ist es daher von Vorteil, wenn Sie sich Gedanken über die Struktur dieser Ordner machen.
Die Ordnerstruktur ist zum einen für Ihre eigene Übersicht nützlich.
Wichtiger aber ist, dass sie für die Konfiguration von {CMK} verwendet werden kann:
Alle Konfigurationsattribute von Hosts können in einem Ordner definiert werden, die dann automatisch an die dort enthaltenen Unterordner und Hosts *vererbt* werden.
Daher ist es nicht nur, aber insbesondere für die Konfiguration großer Umgebungen elementar, von Beginn an eine wohlüberlegte Ordnerstruktur aufzusetzen.

Eine einmal erstellte Ordnerstruktur können Sie verändern -- müssen dabei allerdings sehr gewissenhaft vorgehen.
Das Verschieben eines Hosts in einen anderen Ordner kann nämlich zur Folge haben, dass sich dessen Attribute ändern, ohne dass Sie sich dessen vielleicht bewusst sind.

Die eigentliche Frage beim Aufbau einer für Sie sinnvollen Ordnerstruktur ist, nach welchen Kriterien Sie die Ordner organisieren möchten.
Die Kriterien können in jeder Ebene des Baums andere sein.
So können Sie z.B. in der ersten Ebene nach Standorten unterscheiden und in der zweiten Ebene nach Technologie.

Folgende Ordnungskriterien haben sich in der Praxis bewährt:

ifdef::onprem[]
* Standort/Geografie
endif::[]
* Organisation
* Technologie

ifdef::onprem[]
Eine Sortierung nach Standort ist vor allem in größeren Unternehmen sehr naheliegend, insbesondere dann, wenn Sie das Monitoring über mehrere {CMK}-Server verteilen.
Jeder Server überwacht dann z.B. eine Region oder ein Land.
Wenn Ihre Ordner diese Aufteilung abbilden, dann können Sie z.B. im Ordner „München“ definieren, dass alle Hosts in diesem Ordner von der {CMK}-Instanz „muc“ aus überwacht werden sollen.

Alternativ dazu kann die Organisation (d.h. die Antwort auf die Frage "Wer ist für einen Host zuständig?“) ein sinnvolleres Kriterium sein, denn nicht immer ist Standort und Verantwortung das Gleiche.
So mag es sein, dass eine Gruppe Ihrer Kollegen für die Administration von Oracle zuständig ist, und zwar unabhängig davon, an welchem Standort die entsprechenden Hosts stehen.
Ist also z.B. der Ordner „Oracle“ für die Hosts der Oracle-Kollegen vorgesehen, so ist es in {CMK} einfach zu konfigurieren, dass alle Hosts unterhalb dieses Ordners nur für diese Kollegen sichtbar sind, und dass diese ihre Hosts dort sogar selbst pflegen können.
endif::[]

ifdef::saas[]
Eine Sortierung nach Organisation (d.h. die Antwort auf die Frage "Wer ist für einen Host zuständig?“) kann ein sinnvolles Kriterium sein.
So mag es sein, dass eine Gruppe Ihrer Kollegen für die Administration von Oracle zuständig ist.
Ist also z.B. der Ordner „Oracle“ für die Hosts der Oracle-Kollegen vorgesehen, so ist es in {CMK} einfach zu konfigurieren, dass alle Hosts unterhalb dieses Ordners nur für diese Kollegen sichtbar sind, und dass diese ihre Hosts dort sogar selbst pflegen können.
endif::[]

Eine Strukturierung nach Technologie könnte z.B. einen Ordner für Windows-Server und einen für Linux-Server vorsehen.
Das würde die Umsetzung des Schemas „Auf allen Linux-Servern muss der Prozess `sshd` laufen.“ vereinfachen.
// TK: Wegen {CMK} Relay passen jetzt auch die 3 folgenden Sätze in die saas.
Ein anderes Beispiel ist die Überwachung von Geräten via SNMP, wie beispielsweise Switches oder Router.
Hier kommt kein {CMK}-Agent zum Einsatz, sondern die Geräte werden über das Protokoll SNMP abgefragt.
Sind diese Hosts in eigenen Ordnern zusammengefasst, so können Sie direkt am Ordner die für SNMP notwendigen Einstellungen wie etwa die „Community“ vornehmen.
Da eine Ordnerstruktur nur in seltenen Fällen die Komplexität der Wirklichkeit abbilden kann, bietet {CMK} mit den Host-Merkmalen (_host tags_) eine weitere ergänzende Möglichkeit zur Strukturierung:
doch dazu in einem xref:intro_finetune#host_tags[anderen Kapitel] mehr.
Weiterführende Informationen zur Ordnerstruktur finden Sie in den Artikeln über die xref:hosts_setup#folder[Verwaltung] und die xref:hosts_structure#folder[Strukturierung] von Hosts.


[#create_folders]
== Ordner erstellen

Den Einstieg in die Verwaltung von Ordnern und Hosts finden Sie über die Navigationsleiste, das [.guihint]#Setup#-Menü, das Thema [.guihint]#Hosts# und den Eintrag [.guihint]#Hosts# -- oder kürzer über [.guihint]#Setup > Hosts > Hosts#.
Dann wird die Seite [.guihint]#Main# angezeigt:

ifdef::onprem[]
.Der Ordner [.guihint]#Main# ist noch leer, bietet aber verschiedene Aktionen zur Erstellung an
image::intro_default_main.png[alt="Ordneransicht 'Main' ohne Ordner und Hosts."]
endif::[]

ifdef::saas[]
.Der Ordner [.guihint]#Main# bietet verschiedene Aktionen zur Erstellung an
image::intro_default_main_saas.png[alt="Ordneransicht 'Main' mit einem Ordner und ohne Hosts."]
endif::[]

ifdef::onprem[]
Bevor Sie den ersten Ordner selbst erstellen, werden wir kurz auf den Aufbau dieser Seite eingehen, da Sie die verschiedenen Elemente auf den meisten {CMK}-Seiten so oder so ähnlich wiederfinden werden.
endif::[]
ifdef::saas[]
Bevor wir uns mit dem Inhalt des gezeigten Ordners beschäftigen, werden wir kurz auf den Aufbau dieser Seite eingehen, da Sie die verschiedenen Elemente auf den meisten {CMK}-Seiten so oder so ähnlich wiederfinden werden.
endif::[]

Oberhalb des Seitentitels [.guihint]#Main# finden Sie den Breadcrumb-Pfad, der Ihnen zeigt, wo Sie sich innerhalb der {CMK}-Oberfläche gerade befinden.
Darunter wird die Menüleiste angezeigt, die die möglichen Aktionen auf dieser Seite in Menüs und Menüeinträgen zusammenfasst.
Die Menüs sind in {CMK} stets kontextspezifisch, d.h. sie finden nur Menüeinträge für Aktionen, die auf der aktuellen Seite Sinn ergeben.

Unter der Menüleiste finden Sie die Aktionsleiste, in der die wichtigsten Aktionen aus den Menüs als Knöpfe zum direkten Anklicken angeboten werden. 
Die Aktionsleiste können Sie mit dem Knopf icon:button_hide_toolbar[alt="Symbol zum Ausblenden der Aktionsleiste."] rechts neben dem [.guihint]#Help#-Menü ausblenden und mit icon:button_show_toolbar[alt="Symbol zum Einblenden der Aktionsleiste."] wieder einblenden. 
Bei ausgeblendeter Aktionsleiste werden die Symbole für die Aktionen in der Menüleiste rechts neben icon:button_show_toolbar[alt="Symbol zum Einblenden der Aktionsleiste."] angezeigt.

ifdef::onprem[]
Da Sie sich zurzeit auf einer leeren Seite befinden (ohne Ordner und ohne Hosts), werden die wichtigen Aktionen zum Erstellen des ersten Objekts zusätzlich über noch größere Knöpfe angeboten -- damit die Möglichkeiten auch nicht übersehen werden, die die Seite bietet.
Diese Knöpfe werden nach dem Erstellen des ersten Objekts verschwinden.
endif::[]

Nun aber zurück zum Thema, weswegen Sie sich eigentlich auf dieser Seite befinden: den Ordnern und wie man sie erstellen und bearbeiten kann.
_Einen_ Ordner -- den Hauptordner -- gibt es in jedem frisch aufgesetzten {CMK}-System.
Er heißt [.guihint]#Main#, wie Sie im Titel der Seite sehen können.

ifdef::onprem[]
Unterhalb des Hauptordners werden Sie nun für ein einfaches Beispiel die drei Ordner `Windows`, `Linux` und `Network` erstellen.
Legen Sie den ersten der drei Ordner an, indem Sie eine der angebotenen Aktionen zum Erstellen eines Ordners auswählen, z.B. den Aktionsknopf icon:icon_newfolder[alt="Symbol zum Erstellen eines Ordners."] [.guihint]#Add folder#.
Auf der neuen Seite [.guihint]#Add folder# tragen Sie im ersten Kasten [.guihint]#Basic settings# den Ordnernamen ein:

.Der erste Ordner soll `Windows` heißen
image::intro_folder_basic_settings.png[alt="Dialog mit Eigenschaften beim Erstellen eines Ordners: die 'Basic settings' mit Titel."]

Im obigen Bild ist der xref:intro_gui#show_less_more[Show-less-Modus] aktiv, das heißt es wird nur derjenige Eintrag angezeigt, der zum Erstellen eines Ordners unbedingt notwendig ist.
Bestätigen Sie die Eingabe mit [.guihint]#Save#.

Erstellen Sie analog zum Ordner `Windows` die anderen beiden Ordner `Linux` und `Network`.
Danach sieht die Situation so aus:

.Die drei neuen Ordner, einer davon aufgeklappt zeigt die Symbole für Ordneraktionen
image::intro_empty_folders.png[alt="Ansicht 'Main' mit drei Ordnern, einer davon aufgeklappt mit Symbolen für Ordneraktionen."]
endif::[]

ifdef::saas[]
In {CE} gibt es im Ordner [.guihint]#Main# einen weiteren Ordner `preconfigured_agent`.
Dieser dient dazu, die Hosts aufzunehmen, die automatisch mit den vorkonfigurierten Agentenpaketen erstellt werden.
Mehr dazu gleich im folgenden xref:first[Abschnitt].

Um einen weiteren Ordner in [.guihint]#Main# zu erstellen, können Sie eine der angebotenen Aktionen zum Erstellen eines Ordners auswählen, z.B. den Aktionsknopf icon:icon_newfolder[alt="Symbol zum Erstellen eines Ordners."] [.guihint]#Add folder#.
Auf der neuen Seite [.guihint]#Add folder# tragen Sie im ersten Kasten [.guihint]#Basic settings# den Ordnernamen ein und bestätigen dann die Eingabe mit [.guihint]#Save#.
Danach sieht die Situation ungefähr so aus:

.Der neue Ordner, aufgeklappt mit Symbolen für Ordneraktionen
image::intro_empty_folders_saas.png[alt="Ansicht 'Main' mit zwei Ordnern, einer davon aufgeklappt mit Symbolen für Ordneraktionen."]
endif::[]

[TIP]
====
Wenn Sie mit der Maus auf den Reiter oder den oberen Bereich eines Ordner-Symbols zeigen, klappt der Ordner auf und enthüllt die Symbole, die Sie benötigen, um wichtige Aktionen mit dem Ordner auszuführen (die Eigenschaften ändern, den Ordner verschieben oder ihn löschen).
====

// TK: Dieser Hinweis ist m.E. überflüssig, das die dicke Zahl auf gelbem Hintergrund nicht mehr auf der Hauptseite, sondern nun vergleichsweise dezent in der Navigationsleiste erscheint.
////
*Noch ein Tipp:* Rechts oben auf jeder Seite finden Sie die Information, ob -- und wenn ja, wie viele -- Änderungen inzwischen bereits aufgelaufen sind.
ifdef::onprem[]
Da wir drei Ordner erstellt haben, gibt es drei Änderungen, die jetzt aber noch nicht aktiviert werden müssen.
Wir werden uns mit dem Aktivieren von Änderungen weiter unten genauer beschäftigen.
endif::[]
ifdef::saas[]
Da wir einen Ordner erstellt haben, gibt es eine Änderung, die jetzt aber noch nicht aktiviert werden muss.
Wir werden auf das Aktivieren von Änderungen weiter unten zurückkommen.
endif::[]
////


ifdef::onprem[]
[#linux]
== Den ersten Host aufnehmen
// TK: Diesen Abschnitt mit alle Unterabschnitten hab ich komplett überarbeitet.

Jetzt ist alles dafür vorbereitet, um den ersten Host in das Monitoring aufzunehmen
-- und was wäre naheliegender, als den {CMK}-Server selbst zu überwachen?
Natürlich wird dieser nicht seinen eigenen Totalausfall melden können, aber nützlich ist das trotzdem, denn Sie erhalten so nicht nur eine Übersicht über die CPU- und RAM-Nutzung, sondern auch etliche
Metriken und Checks, die das {CMK}-System selbst betreffen.

Das Vorgehen zum Aufnehmen eines Linux-Hosts (wie übrigens auch eines Windows-Hosts) ist im Prinzip das Folgende:

// TK: Liste umsortiert und auf 3 Punkte verkürzt, damit es zum Slideout passt
// TK: Die unterschiedliche Reihenfolge der einzelnen Schritte in onprem und saas ist unschön. Ich kanns aber nicht vereinheitlichen, ohne mich zu weit von der Abfolge in der GUI zu entfernen.
. Host erstellen
. Agent herunterladen und installieren
. Host registrieren

Nachdem der Host in der xref:glossar#configuration_environment[Konfigurationsumgebung] erstellt wurde, werden zum Abschluss noch die Services konfiguriert und die Änderungen für die xref:glossar#monitoring_environment[Monitoring-Umgebung] aktiviert.


[#create_host]
=== Host erstellen

// ES: Da ich für KNW-2027 reviewe, vermisse ich hier den Bezug auf die Welcome Page bzw. auf "Continue exploration". Wenn wir im 1. Topic "Add your first host" die zweite Aufgabe "Add your first host" annavigieren, können wir "Server (Linux, Windows, Solaris, ...)" auswählen und kommen so direkt auf die Seite "Add host".
// ES: Es ist natürlich auch vollkommen in Ordnung, den "manuellen" Weg dorthin zu beschreiben. Aber dann würde ich gerne trotzdem einen kleinen Hinweis hier unterbringen, dass wir gerade an genau diesem Schritt der "Exploration" sind.
Öffnen Sie in der {CMK}-Oberfläche die gleiche Seite [.guihint]#Main#, auf der Sie bereits die drei Ordner erstellt haben: [.guihint]#Setup > Hosts > Hosts#.
Wechseln Sie dort in den Ordner [.guihint]#Linux#, indem Sie den Ordner anklicken.

Klicken Sie [.guihint]#Add host# und die Seite [.guihint]#Add host# wird geöffnet:

.Die wichtigsten Eigenschaften eines Hosts
image::intro_host_allsettings_less.png[alt="Dialog mit Eigenschaften beim Erstellen eines Hosts."]

Wie schon beim Anlegen der drei Ordner weiter oben ist immer noch der xref:intro_gui#show_less_more[Show-less-Modus] aktiv.
Daher zeigt {CMK} im Formular nur die wichtigsten und zum Erstellen eines Hosts notwendigen Host-Attribute an.
Falls es Sie interessiert, können Sie sich den Rest ansehen, indem Sie bei jedem der geöffneten Kästen die drei Auslassungspunkte icon:button_showmore[alt="Symbol zum Wechsel in den Show-more-Modus."] anklicken und die beiden zugeklappten Kästen am Ende der Seite öffnen.
{CMK} ist eben ein komplexes System, das auf jede Frage eine Antwort hat.
Deswegen kann man bei einem Host (aber nicht nur dort) auch sehr viel konfigurieren.

In diesem Formular müssen Sie nur ein einziges Feld ausfüllen, nämlich [.guihint]#Host name# bei den [.guihint]#Basic settings#.

Diesen Host-Namen können Sie recht frei vergeben und er darf bis zu 240 Zeichen lang sein.
Er darf aus Buchstaben, Ziffern, Punkten, Binde- und Unterstrichen bestehen.
Dabei sollten Sie aber wissen, dass der Host-Name von zentraler Bedeutung ist, denn er dient im Monitoring an allen Stellen als interne ID (oder Schlüssel) zur eindeutigen Identifizierung des Hosts.
Da er in {CMK} so wichtig ist und oft genutzt wird, sollten Sie sich die Benamsung Ihrer Hosts gut überlegen.
Ein Host-Name kann später geändert werden, aber da dies ein aufwendiger Vorgang ist, sollten Sie ihn vermeiden.

Am besten ist es, wenn der Host unter seinem Namen im DNS gefunden werden kann.
Die gute Nachricht:
{CMK} überprüft für Sie, ob das der Fall ist.
Schon während Sie den Host-Namen in das Eingabefeld eintippen, _pingt_ {CMK} im Hintergrund den Namen an und gibt Ihnen die Rückmeldung, ob dieser im DNS aufgelöst werden kann:
// TK: Für Host-Namen nslookup (wenn verfügbar) und dann ping. Im Leitfaden ist pingen ok, in host_setup sollen die Details rein.

.Der Host-Name `localhost` macht keine Probleme
image::intro_hostname_dns_resolvable.png[alt="Ergebnis der Überprüfung bei der Eingabe des Host-Namens."]

Wenn der Host-Name nicht aufgelöst werden kann, gibt es statt der gezeigten Erfolgsmeldung die passende Fehlermeldung in rot.

Falls Sie kein DNS verwenden möchten, können Sie die IP-Adresse auch von Hand im Feld [.guihint]#IPv4 address# eintragen.
Wenn Sie eine IP-Adresse eintragen, pingt {CMK} nicht länger den Host-Namen, sondern diese IP-Adresse.
Die Rückmeldung über das Ergebnis erhalten Sie dann neben dem Feld mit der IP-Adresse.
Die Details zu Host-Namen, IP-Adressen und DNS finden Sie übrigens im Artikel über die  xref:hosts_setup#dns[Verwaltung der Hosts].

// TK: Man könnte den folgenden Text und Screenshot auch in einen [TIP] packen. Ich habs versucht, aber verworfen, weil die Tipp-Box einfach zu mächtig ist.
*Tipp:* Auf vielen Seiten -- auch auf dieser -- können Sie sich zusätzlich Hilfetexte zu den Attributen anzeigen lassen.
Wählen Sie dazu im [.guihint]#Help#-Menü den Eintrag [.guihint]#Show inline help#.
Die gewählte Einstellung bleibt auch auf anderen Seiten aktiv, bis Sie die Hilfe wieder abschalten.
Das folgende Bild zeigt die Inline-Hilfe für den Parameter [.guihint]#IPv4 address#:

.Hilfreiche Information zum Thema IP-Adresse
image::intro_ipv4_inlinehelp.png[alt="Die Eigenschaften eines Hosts mit eingeblendeter Inline-Hilfe für die IPv4-Adresse."]

////
[TIP]
====
Damit {CMK} immer stabil und performant laufen kann, unterhält es einen eigenen Cache für die Auflösung der Host-Namen.
Daher führt der Ausfall des DNS-Dienstes nicht zum Ausfall des Monitorings.
Die Details zu Host-Namen, IP-Adressen und DNS finden Sie im xref:hosts_setup#dns[Artikel über die Verwaltung der Hosts].
====
////
// TK: Ich hab diesen [TIP] rausgenommen und nur den letzten Satz oben eingeschoben. Ist mir zu viel DNS in diesem Abschnitt. Und den DNS-Cache kann man im gezeigten Hilfetext lesen.

{CMK} stellt übrigens seine Überprüfungen per Ping im Hintergrund ein, wenn Sie im Feld [.guihint]#IP address family# den Wert [.guihint]#No IP# wählen.
„No IP“ ist relevant für Hosts, die über einen xref:glossar#special_agent[Spezialagenten] abgefragt werden.
Spezialagenten sind aber nicht relevant in diesem Beispiel, in dem der Host mit einem {CMK}-Agenten überwacht werden soll.


[#download_agent]
=== Agent herunterladen und installieren

Auf der Seite [.guihint]#Add host#, die Sie aus dem vorherigen Abschnitt hoffentlich noch geöffnet haben, gibt es den Kasten [.guihint]#Monitoring agents# und dort die Option [.guihint]#{CMK} agent / API integrations#.
Hier legen Sie fest, welche Daten für den Host herangezogen und welche verworfen werden.
Für jeden Wert mit {CMK}-Agenten bietet die Seite den Knopf [.guihint]#Test agent connection# an, so auch für den Standardwert [.guihint]#API integrations if configured, else {CMK} agent#:

.Der zuvor deaktivierte Knopf ist nach Eingabe des Host-Namens aktiv
image::intro_host_test_agent_connection.png[alt="Knopf zum Testen der Agentenverbindung."]

Der Standardwert passt, da zwar keine API-Integration, aber ein {CMK}-Agent die Daten liefern soll.
Ein Test der Agentenverbindung wird wohl nicht zum Erfolg führen, da bisher auf dem {CMK}-Server, das heißt dem zu überwachenden Host, kein Agent vorhanden ist -- jedenfalls keiner, von dem wir wissen.
Klicken Sie trotzdem auf [.guihint]#Test agent connection#, denn nach fehlgeschlagenem Test erhalten Sie anschließend die Möglichkeit, sich den Agenten zu besorgen:

.Die nicht überraschende Meldung, dass keine Kommunikation mit dem {CMK}-Agenten möglich ist 
image::intro_host_test_agent_connection_failed.png[alt="Fehlermeldung bei einem Host ohne installierten {CMK}-Agenten."]

Eine Kommunikation mit dem {CMK}-Agenten kann aus mehreren Gründen nicht möglich sein.
Einer davon ist, dass der Kommunikationspartner nicht vorhanden ist, also der {CMK}-Agent noch nicht installiert ist.
Das werden Sie jetzt ändern.
Nach einem Klick auf [.guihint]#Download {CMK} agent# öffnet sich das Slideout [.guihint]#Install Checkmk agent#, das Sie durch die drei Schritte führen wird, um den {CMK}-Agenten zum Laufen zu bringen:

.Das Slideout zur Erstellung eines On-Premises-Hosts mit aktiviertem ersten Schritt
image::intro_host_install_agent_slideout_1.png[alt="Das Slideout zur Installation des {CMK}-Agenten."]
// ES: Ich stolpere über die Formulierung, dass ein Schritt der Anleitung "aktiviert" ist, was ist denn hier aktiv? Eigentlich ist das einfach der aktuell sichtbare, also ausgewählte Schritt, oder?

Wählen Sie zuerst das passende Betriebssystem aus, auf dem der Agent installiert werden soll.
Da der {CMK}-Server ein Linux-Rechner ist, benötigen Sie den {CMK}-Agenten für Linux.
Für Linux müssen Sie noch die passende Paketdatei auswählen, also [.guihint]#RPM# für Red Hat Enterprise Linux (RHEL), dessen binärkompatible Distributionen und SUSE Linux Enterprise Server (SLES) oder [.guihint]#DEB# für Debian und Ubuntu.

Der erste Schritt ist einfach -- und genau das Richtige zum Aufwärmen.
Sichern Sie den Host mit [.guihint]#Save host & next step#.
Das ist nötig, da die abschließende Registrierung einen existierenden Host in {CMK} voraussetzt, so wie es im Text des Slideouts steht.
Anschließend wird der zweite Schritt aktiviert:
// TK: Download wird noch geändert zu einem REST-API-Aufruf mit zu generierendem Token (dann identisch in allen Editionen)

.Im zweiten Schritt wird der Befehl zum Herunterladen und Installieren des {CMK}-Agenten gezeigt
image::intro_host_install_agent_slideout_2.png[alt="Der zweite Schritt im Slideout zur Installation des {CMK}-Agenten."]

Der gezeigte Befehl kombiniert zwei einzelne Befehle und verbindet beide durch `&&`.
Dadurch wird der {CMK}-Agent zuerst auf den Host heruntergeladen und anschließend installiert.
Rechts neben dem Befehl finden Sie das Symbol icon:icon_copy_string[alt="Symbol zum Kopieren in die Zwischenablage."] zum Kopieren des Befehls in die Zwischenablage.

Öffnen Sie ein Terminal auf dem Ziel-Host, fügen Sie den kopierten Befehl ein und führen Sie ihn aus.
Sie müssen nur eine einzige Eingabe machen.
Nach dem Herunterladen und vor dem Ausführen des Installationsbefehls `dpkg` erfordert das `sudo` die Eingabe Ihres Passworts.

// TK: Nach Rücksprache mit SK zeige ich keine Befehle mehr und auch keine Ausgaben auf der Befehlszeile.

[TIP]
====
In unserem Beispiel wird der Agent auf dem {CMK}-Server installiert, d.h. Sie brauchen den Befehl nicht auf einem anderen Rechner auszuführen.
In dem Slideout können Sie aber auch ein anderes Betriebssystem auswählen, zum Beispiel Windows, und mit dem zugehörigen Befehl den {CMK}-Agenten auf einem Windows-Host herunterladen und installieren.
====

Mit dem Agenten wird der Agent Controller installiert, mit dem unter anderem bei der Registrierung die TLS-Verschlüsselung der Verbindung zum {CMK}-Server hergestellt wird.
Das wird im xref:register[nächsten Abschnitt] beschrieben.
Damit die Installation des Agent Controllers klappt, setzt dies eine Linux-Distribution mit dem init-System `systemd` voraus, das seit 2015 in den meisten Linux-Distributionen Standard ist.
Für die seltenen Fälle, in denen der Agent Controller nicht verwendet werden kann, finden Sie Informationen im Artikel xref:agent_linux_legacy#[Linux überwachen im Legacy-Modus].

Damit ist die Installation des Agenten abgeschlossen.
Das Slideout und die Befehlszeile können Sie geöffnet lassen.
Beide werden nochmal bei der Registrierung des Hosts benötigt.


[#register]
=== Host registrieren

// TK: Im Slideout wird der Agent registriert, im Handbuch der Host. Dies ist unschön, wenn wie hier beide Begriffe unterschiedlich aufeinanderprallen.
// TK: Ich lass es im Handbuch hier (und in agent_linux und agent_windows) unverändert, hab aber einen Satz zum Agent Controller des Hosts hinzugefügt.
// TK: Dadurch soll klarwerden, dass Agent und Host kein Widerspruch sind, sondern nur eine andere Perspektive bieten.
Nach erfolgreicher Installation des {CMK}-Agenten können Sie den zweiten Schritt im Slideout mit [.guihint]#Next step: Register agent# abhaken.
Jetzt bleibt nur noch der dritte und letzte Schritt übrig.
Mit der Registrierung des Hosts beim {CMK}-Server wird das Vertrauensverhältnis zwischen beiden eingerichtet.
Genau genommen wird das Vertrauensverhältnis zwischen dem _Agent Controller_ des Hosts und dem _Agent Receiver_ der Checkmk-Instanz hergestellt.
Nach der Registrierung erfolgt die Kommunikation zwischen Host und Server dann nur noch Transport Layer Security (TLS) verschlüsselt.

Die Registrierung erfolgt durch Aufruf des Agent Controllers `cmk-agent-ctl` auf der Befehlszeile.
Standardmäßig benötigt der Befehl den Namen und das Passwort eines {CMK}-Benutzers mit der Berechtigung zur Registrierung.
Eine Abkürzung und Vereinfachung bietet hier das Slideout mit der Möglichkeit, ein Einmal-Token (_one-time token_ oder _OTT_) zu generieren und die Registrierung damit durchzuführen.

Klicken Sie also zuerst auf [.guihint]#Generate token#.
Dann sieht das Slideout etwa so aus:

.Im dritten und letzten Schritt wird der Befehl zum Registrieren gezeigt
image::intro_host_install_agent_slideout_3.png[alt="Der dritte Schritt im Slideout zur Installation des {CMK}-Agenten."]

Das Einmal-Token wurde generiert und wird im gezeigten Befehl mit der Option `-ott` genutzt.
Die Registrierung läuft jetzt analog ab wie im vorherigen Abschnitt das Herunterladen und die Installation.
Kopieren Sie den Befehl und führen Sie ihn in einem Terminal aus.

Wie im Befehl zur Installation erfordert das `sudo` die Eingabe Ihres Passworts.
Dann werden Sie aufgefordert, die Identität der {CMK}-Instanz zu bestätigen, zu der Sie die Verbindung herstellen wollen.
Dazu wird das zu bestätigende Server-Zertifikat angezeigt.
Bestätigen Sie mit `Y`, um den Vorgang abzuschließen.
Falls keine Fehlermeldung angezeigt wird, ist die verschlüsselte Verbindung hergestellt.
Über diese Verbindung werden alle Daten komprimiert übertragen.

Nach diesem (vorerst letzten) Ausflug auf die Befehlszeile, geht es wieder weiter in der {CMK}-Oberfläche.
Schließen Sie den letzten Schritt ab mit [.guihint]#Close & test connection#.
Das Slideout wird geschlossen und bringt Sie zurück zu der Seite mit den Host-Eigenschaften.
Der Test der Agentenverbindung wird erneut gestartet und das Ergebnis sollte jetzt ungefähr so aussehen:

.Die Erfolgsmeldung zeigt, dass nun die Kommunikation mit dem {CMK}-Agenten möglich ist 
image::intro_host_test_agent_connection_success.png[alt="Erfolgsmeldung bei einem Host mit installiertem und registriertemn {CMK}-Agenten."]


[#diagnosis]
=== Diagnose
// TK: Abschnitt stark gekürzt
// TK: Da der Verbindungstest nun bereits in die Seite Properties of host integriert ist, bringt ein Ausflug auf die Seite Test connection to host hier keine neuen Informationen.

Murphys Gesetz („Alles, was schiefgehen kann, wird auch schiefgehen.“) kann leider auch von {CMK} nicht außer Kraft gesetzt werden.
Schiefgehen kann vor allem dann etwas, wenn man es zum ersten Mal probiert.
Daher sind gute Möglichkeiten zur Fehlerdiagnose wichtig.

Im vorherigen Abschnitt haben Sie bereits erfahren, wie Sie die die Kommunikation zwischen dem {CMK}-Server und dem {CMK}-Agenten auf dem Host testen können.
Weitere Möglichkeiten zur Fehlerdiagnose finden Sie im Artikel zu den xref:wato_monitoringagents#diagnosticpage[Monitoring-Agenten].
Dort wird auch der Test über die Weboberfläche beschrieben, den Sie auf der Seite [.guihint]#Properties of host# mit dem Knopf [.guihint]#Save & run connection tests# starten können.
Weitere Möglichkeiten zu Test und Diagnose finden Sie dann noch im Artikel zum xref:agent_linux#test[Linux-Agenten].


[#services]
=== Die Services konfigurieren

Nachdem der Host selbst aufgenommen wurde, kommt das eigentlich Interessante: die Konfiguration seiner Services.
Auf der Seite [.guihint]#Properties of host# klicken Sie [.guihint]#Save & run service discovery# und die Seite [.guihint]#Services of host# wird angezeigt.

.Die gekürzte Liste der gefundenen Services 
image::intro_services_of_host.png[alt="Liste der auf dem Host gefundenen Services zur Aufnahme ins Monitoring.",fullscreen=1]

Auf dieser Seite legen Sie fest, welche Services Sie auf dem Host überwachen möchten.
Außerdem zeigt Ihnen der oberste Kasten an, ob bei den Datenquellen für den Host Probleme erkannt wurden.
Wenn der Agent auf dem Host erreichbar ist und korrekt läuft, findet {CMK} automatisch eine Reihe von Services und schlägt diese für das Monitoring vor.

// TK: Der Tipp ist neu: Maximal einminütige Wartezeit hinzugefügt plus neues Feature, dass der Agent auch auf dieser Seite nachinstalliert/-registriert werden kann
[TIP]
====
Es kann bis zu maximal einer Minute dauern, bis ein frisch konfigurierter Agent die Informationen zu den gefundenen Services liefert.
Bei Problemen in der Service-Erkennung überprüft {CMK}, ob der Agent überhaupt installiert und registriert ist.
Falls dies nicht der Fall ist, bietet Ihnen {CMK} mit einer Meldung auch auf dieser Seite an, Installation und/oder Registrierung nachzuholen.
Dabei wird der gleiche Test der Agentenverbindung durchgeführt, der im Abschnitt xref:download_agent[Agent herunterladen und installieren] bei den Eigenschaften des Hosts beschrieben ist.
====

Für jeden dieser Services gibt es prinzipiell die folgenden Möglichkeiten:

* [.guihint]#Undecided# : Sie haben sich noch nicht entschieden, ob dieser Service überwacht werden soll.
* [.guihint]#Monitored# : Der Service wird überwacht.
* [.guihint]#Disabled# : Sie haben sich dafür entschieden, den Service grundsätzlich nicht zu überwachen.
* [.guihint]#Vanished# : Der Service wurde überwacht, existiert aber jetzt nicht mehr.

Die Seite zeigt alle Services nach diesen Kategorien in Tabellen an.
Da Sie noch keinen Service konfiguriert haben, sehen Sie nur die Tabelle [.guihint]#Undecided#.

Wenn Sie auf [.guihint]#Monitor undecided services# klicken, werden alle Services direkt in das Monitoring übernommen und alle [.guihint]#Undecided# zu [.guihint]#Monitored# Services.

Umgekehrt können Services auch verschwinden, z.B. weil ein Dateisystem entfernt wurde.
Diese erscheinen dann im Monitoring als {UNKNOWN} und auf dieser Seite als [.guihint]#Vanished# und können mit [.guihint]#Remove vanished services# aus dem Monitoring entfernt werden.

Für den Anfang ist es am einfachsten, wenn Sie jetzt auf den Knopf [.guihint]#Accept all# klicken, der alles auf einmal macht:
fehlende Services hinzufügen, verschwundene entfernen -- und zusätzlich gefundene Änderungen an Host- und Service-xref:glossar#label[Labels] übernehmen.

Sie können diese Seite jederzeit später aufrufen, um die Konfiguration der Services anzupassen.
Manchmal entstehen durch Änderungen an einem Host neue Services, z.B. wenn Sie eine Logical Unit Number (LUN) als Dateisystem einbinden oder eine neue Oracle Datenbankinstanz konfigurieren.
Diese Services erscheinen dann wieder als [.guihint]#Undecided#, und Sie können sie einzeln oder alle auf einmal in das Monitoring aufnehmen.

Weiterführende Informationen zu den Services, die ein {CMK}-Server standardmäßig mitbringt, finden Sie übrigens im Artikel xref:self_monitoring#[Das eigene System überwachen].


[#activate_changes]
=== Änderungen aktivieren

{CMK} speichert alle Änderungen, die Sie vornehmen, zunächst nur in einer vorläufigen „Konfigurationsumgebung“, die das aktuell laufende Monitoring noch nicht beeinflusst.
Erst durch das „Aktivieren der ausstehenden Änderungen“ werden diese in die „Monitoring-Umgebung“ übernommen.

Es ist oft sinnvoll, mehrere Aktionen in der Konfigurationsumgebung zusammen zu aktivieren.
Ein gutes Beispiel dafür sind die Aktionen, die Sie bisher in diesem Kapitel ausgeführt haben.
Nur wenn der neu erstellte Host mit den in der Service-Erkennung gefundenen und übernommenen Services aktiviert wird, sind Host und Services zusammen auf einen Schlag im Monitoring sichtbar.

Wie viele Änderungen sich bisher angesammelt haben, die noch nicht aktiviert wurden, sehen Sie in der Navigationsleiste, im Menü [.guihint]#Changes#, und dort an der Nummer im gelben Kreis.
Wenn Sie das Menü anklicken, sehen Sie die Details dieser noch ausstehenden Änderungen:

.Alle Änderungen im Detail, die per Knopfdruck aktiviert werden können
image::intro_menu_changes.png[alt="Das Menü 'Changes' zeigt die Liste der ausstehenden Änderungen.",width=86%]

Im Menü werden die wichtigsten Informationen angezeigt.
Den vollen Überblick können Sie sich mit dem Knopf [.guihint]#Open full view# verschaffen, der die Seite [.guihint]#Activate pending changes# öffnet.
Das ist zum Beispiel dann notwendig, falls das Menü Probleme anzeigt, die die Aktivierung verhindern können.

Klicken Sie jetzt auf den Knopf [.guihint]#Activate pending changes#, um die Änderungen anzuwenden.
Nach kurzer Wartezeit erhalten Sie die Rückmeldung, dass die Änderungen erfolgreich aktiviert wurden und alles auf dem neuesten Stand ist.
Die Nummer im Menü [.guihint]#Changes# ist verschwunden und bleibt es auch solange, bis die nächste Änderung ansteht.

Im Artikel über die xref:wato#activate_changes[Konfiguration von {CMK}] erfahren Sie mehr über den Unterschied zwischen Konfigurations- und Monitoring-Umgebung.
Dort steht auch, wie Sie ausstehende Änderungen wieder rückgängig machen können, statt sie zu aktivieren.

Zur Erfolgskontrolle wechseln Sie abschließend einmal in die Monitoring-Umgebung, zum Beispiel indem Sie in der Navigationsleiste den Eintrag [.guihint]#Monitor > Overview > Main dashboard# auswählen.

.Das [.guihint]#Main dashboard# von {RE} zeigt den ersten Host im Monitoring
image::intro_dashboard.png[alt="Das 'Main dashboard' von {RE}.",fullscreen=1]
// ES: Ist eine Kleinigkeit, aber: Im Screenshot wird oben rechts angezeigt, dass "2/6 Topics explored" sind. Bei mir steht da 0/6, nachdem ich den Host und die Services ordnungsgemäß eingerichtet habe und im Monitoring sehe. Wollen wir aktiv darauf hinweisen, dass diese Checkliste sich nicht von selbst abhakt, sondern nur dann, wenn man auf "Mark as done" klickt?

Damit haben Sie den ersten Host mit seinen Services erfolgreich ins Monitoring übernommen: Gratulation!
endif::[]


// TK: Auch schon überarbeitet
ifdef::saas[]
[#first]
== Den ersten Host aufnehmen

Jetzt ist alles dafür vorbereitet, um den ersten Host in das Monitoring aufzunehmen.
Eine Möglichkeit ist, den Rechner zu überwachen, von dem aus Sie die Weboberfläche von {CE} aufrufen.

Dies können Sie bequem mit Hilfe der xref:welcome[Willkommens-Seite] erledigen.
Im ersten Thema [.guihint]#Add your first host# finden Sie einen Knopf zum Erstellen eines _On-Premises_-Hosts.
Nach Klick auf [.guihint]#Server (Linux, Windows, Solaris, ...)# öffnet sich das Slideout [.guihint]#Add your first host#:

.Das Slideout zur Erstellung eines On-Premises-Hosts mit dem aktiviertem ersten Schritt
image::intro_host_install_agent_slideout_1_saas.png[alt="Das Slideout zur Erstellung eines On-Premises-Hosts."]

Das Thema zeigt, wie Sie in wenigen Schritten Ihren _On-Premises_-Host (Linux- oder Windows) in das Monitoring aufnehmen.
Dabei haben Sie die Auswahl zur Installation des {CMK}-Agentenpakets für Debian und Ubuntu (`DEB`), für Red Hat Enterprise Linux basierte Systeme und SLES (`RPM`), sowie für Windows.

Die Authentisierung zum Herunterladen des Agentenpakets erfolgt mit einem temporär gültigen _Token_.
Bevor das Token genutzt werden kann, muss es erstellt werden.
Klicken Sie also zuerst auf [.guihint]#Generate token#.
Dann sieht das Slideout etwa so aus:

.Nach der Generierung des Tokens wird der Befehl zum Herunterladen des {CMK}-Agenten gezeigt
image::intro_host_install_agent_slideout_2_saas.png[alt="Der erste Schritt im Slideout mit dem Befehl zum Herunterladen des {CMK}-Agenten."]

Mit dem gezeigten Befehl wird das {CMK}-Agentenpaket auf den Host heruntergeladen.
Rechts neben dem Befehl finden das Symbol icon:icon_copy_string[alt="Symbol zum Kopieren in die Zwischenablage."] zum Kopieren des Befehls in die Zwischenablage.
Öffnen Sie ein Terminal auf dem Ziel-Host, fügen Sie den kopierten Befehl ein und führen Sie ihn aus.

Nach der Ausführung des Befehls kehren Sie zum Slideout zurück und klicken dort [.guihint]#Next step#.
Der zweite Schritt zeigt dann den Befehl zur Installation des heruntergeladenen Agentenpakets.
Führen Sie auch diesen Befehl im Terminal aus.
Nach der Installation dauert es nur wenige Minuten, bis der Host in {CMK} sichtbar ist.

Im Slideout können Sie mit [.guihint]#Next step# den dritten und letzten Schritt aktivieren, mit [.guihint]#View hosts# das Slideout schließen und die Seite [.guihint]#Main# in der xref:glossar#configuration_environment[Konfigurationsumgebung] öffnen.

.Der automatisch erstellte Host ist im vorbereiteten Ordner `preconfigured_agent` gelandet
image::intro_setup_first_host_saas.png[alt="Der Ordner 'preconfigured_agent' mit dem automatisch erstellten Host."]

In der xref:glossar#monitoring_environment[Monitoring-Umgebung] finden Sie den Host zum Beispiel via [.guihint]#Monitor > Overview > All hosts#:

.Der automatisch erstellte Host in der Monitoring-Umgebung
image::intro_monitor_first_host_saas.png[alt="Die Tabellenansicht 'All hosts' mit dem automatisch erstellten Host."]

Damit haben Sie den ersten Host mit seinen Services erfolgreich ins Monitoring übernommen: Gratulation!

Dass das alles so einfach funktioniert, liegt daran, dass in {CE} für alle unterstützten Betriebssysteme die Pakete mit dem {CMK}-Agenten vorkonfiguriert bereitstehen -- für die automatische Registrierung des Agenten und die Erstellung des Hosts.
Sie finden diese Pakete in der {CMK}-Oberfläche in [.guihint]#Setup > Agents > Windows, Linux, Solaris, AIX# in der Zeile [.guihint]#Agent Controller auto-registration#.

Die Pakete sind dabei so konfiguriert, dass der Host stets im vorbereiteten Ordner `preconfigured_agent` Ihrer Instanz in {CE} abgelegt wird.
Wenn Sie stattdessen Ihre Hosts in Ihrer eigene Ordnerstruktur ablegen wollen, haben Sie mehrere Möglichkeiten:
Sie können bereits erstellte Hosts in andere Ordner verschieben, mit der xref:glossar#agent_bakery[Agentenbäckerei] eigene Pakete für die xref:hosts_autoregister#[Autoregistrierung von Hosts] erstellen oder die einzelnen Schritte manuell durchführen.

[#activate_changes]
Vor allem für die manuelle Variante ist es von Vorteil, die einzelnen Schritte im halbautomatischen Prozess zu kennen, mit der ein Host in das Monitoring aufgenommen wird.
Das prinzipielle Vorgehen für einen Linux- und Windows-Hosts ist dabei stets das Folgende:

. Agent herunterladen +
Das passiert in Schritt 1 des Themas [.guihint]#Add your first host#.
Alternativ zum gezeigten Befehl, der die {CMK} xref:rest_api#[REST-API] nutzt, kann ein Installationspaket auch über die {CMK}-Oberfläche heruntergeladen werden.
Unter [.guihint]#Setup > Agents > Windows, Linux, Solaris, AIX# finden Sie auch die nicht vorkonfigurierten sogenannten _Vanilla_-Pakete.

. Agent installieren +
Die Installation erfolgt in Schritt 2 des Themas [.guihint]#Add your first host#.
Die Details zur Installation können Sie in den Artikeln zu xref:agent_linux#install[Linux] und xref:agent_windows#install[Windows] nachlesen.

. Host erstellen +
Dies ist der erste der verbleibenden Schritte, die alle während der Autoregistrierung mit dem vorkonfigurierten Agentenpaket ausgeführt werden.
Bei der Anfrage zur Registrierung hat der Agent dem {CMK}-Server die zur Erstellung des Hosts notwendigen Daten übermittelt.
Dadurch kann bei der Autoregistrierung der Host automatisch erstellt werden.
Sonst müsste das xref:hosts_setup#create_hosts[manuell] im [.guihint]#Setup#-Menü erfolgen.

. Host registrieren +
Mit der Registrierung des Hosts beim {CMK}-Server wird das Vertrauensverhältnis zwischen beiden eingerichtet.
Die Kommunikation zwischen Host und Server erfolgt dann nur noch Transport Layer Security (TLS) verschlüsselt.
Ohne Autoregistrierung muss die Registrierung manuell per Befehlszeile durchgeführt werden, wie es in den Artikeln zu xref:agent_linux#registration[Linux] und xref:agent_windows#registration[Windows] beschrieben ist.

. Service-Erkennung durchführen +
Auch die Festlegung der Services, die auf dem Host überwacht werden, d. h. die xref:glossar#service_discovery[Service-Erkennung,] läuft bei der Autoregistrierung automatisch im Hintergrund.

. Änderungen aktivieren +
Zum Abschluss werden bei der Autoregistrierung alle in der Konfigurationsumgebung ausstehenden Änderungen aktiviert, damit der neue Host im Monitoring erscheint.
Dem manuellen Weg zur xref:glossar#activate_changes[Aktivierung der Änderungen] spendieren wir im Kapitel zur xref:intro_finetune#activate_changes[Feinjustierung des Monitorings] einen eigenen Abschnitt.

Bei so vielen einzelnen Schritten kann es vorkommen, dass etwas nicht erfolgreich durchläuft.
Murphys Gesetz („Alles, was schiefgehen kann, wird auch schiefgehen.“) kann leider auch von {CMK} nicht außer Kraft gesetzt werden.
Schiefgehen kann vor allem dann etwas, wenn man es zum ersten Mal probiert.
Daher sind gute Möglichkeiten zur Fehlerdiagnose wichtig.

Die Fehlersuche starten Sie am besten in umgekehrter Reihenfolge der Ausführung.
Falls also die zuletzt ausgeführte Autoregistrierung fehlgeschlagen ist, finden Sie im xref:hosts_autoregister#test[Artikel zur Autoregistrierung] erste Hinweise zur Fehlersuche. 

Wenn dagegen alles geklappt hat, können Sie nach dem gleichen Muster weitere Linux- und Windows-Hosts aufnehmen.
Falls sich die heruntergeladene Datei mit dem Installationspaket nicht auf dem Ziel-Host für die Installation des Agenten befinden sollte, müssen Sie die Datei zuerst auf den Ziel-Host kopieren, zum Beispiel mit dem Befehlszeilentool `scp`.
endif::[]


// TK: Struktur geändert
[#more_hosts]
== Weitere Hosts aufnehmen

Auch bei der Einrichtung von Hosts für gängige Anwendungsfälle erhalten Sie Unterstützung in der xref:welcome[Willkommens-Seite].
Gleich im ersten Thema [.guihint]#Add your first host# finden Sie Knöpfe, mit denen Sie die Erstellung von Hosts sowohl für On-Premises- als auch für Cloud-Umgebungen starten können.


ifdef::onprem[]
[#windows]
=== Windows überwachen

Ebenso wie für Linux hat {CMK} auch für Windows einen eigenen Agenten.
Dieser ist als MSI-Paket verpackt.
Sie können den {CMK}-Agenten für Windows auf die gleiche Art herunterladen, installieren und registrieren, wie es im xref:linux[vorherigen Abschnitt] für einen Linux-Host beschrieben ist.
Um die passenden Windows-Befehle angezeigt zu bekommen, wählen Sie im Slideout zur Installation des {CMK}-Agenten einfach [.guihint]#Windows# statt [.guihint]#Linux#.
Und Sie sollten den Host im dafür vorgesehenen Ordner `Windows` erstellen.

Da Windows anders aufgebaut ist als Linux, findet der Agent natürlich andere Services.
Die detaillierte Einführung ins Thema finden Sie im Artikel über die xref:agent_windows#[Überwachung von Windows].
endif::[]


[#snmp]
=== Mit SNMP überwachen

Professionelle Switches, Router, Drucker und viele andere Geräte und Appliances haben bereits vom Hersteller eine eingebaute Schnittstelle für das Monitoring:
das Simple Network Management Protocol (SNMP).
Solche Geräte lassen sich sehr einfach mit {CMK} überwachen -- und Sie müssen noch nicht einmal einen Agenten installieren.

ifdef::onprem[]
{cee-only}
In {UE} haben Sie die Möglichkeit, SNMP-Geräte, die ihre Daten nicht direkt an den {CMK}-Server übermitteln können, mithilfe des xref:glossar#checkmk_relay[{CMK} Relay] zu überwachen.
endif::[]
ifdef::saas[]
In {CE} werden SNMP-Geräte mithilfe des xref:glossar#checkmk_relay[{CMK} Relay] überwacht.
endif::[]

Bevor SNMP-Geräte für die Nutzung eines {CMK} Relay konfiguriert werden können, muss das Relay zuerst einmal eingerichtet werden.
Wie Sie dabei vorgehen, erfahren Sie im Artikel xref:relay#[Das {CMK} Relay].

Das grundsätzliche Vorgehen zur Einrichtung eines SNMP-Geräts ist immer das folgende:

. In der Management-Oberfläche des Geräts schalten Sie SNMP frei für *lesende* Zugriffe von der IP-Adresse des {CMK}-Servers.

. Vergeben Sie dabei eine *Community*.
Das ist nichts anderes als ein Passwort für den Zugriff.
Da dieses im Netzwerk in der Regel im Klartext übertragen wird, ist es nur begrenzt sinnvoll, das Kennwort sehr kompliziert zu wählen.
Die meisten Anwender verwenden für alle Geräte innerhalb eines Unternehmens einfach die gleiche Community.
Das vereinfacht auch die Konfiguration in {CMK} sehr.

ifdef::onprem[]
. Erstellen Sie in {CMK} den Host für das SNMP-Gerät wie xref:create_host[oben beschrieben], diesmal im dafür vorgesehenen Ordner `Network`.
endif::[]
ifdef::saas[]
. Erstellen Sie in {CMK} den Host für das SNMP-Gerät mit [.guihint]#Setup > Hosts > Hosts > Add host#.
endif::[]

ifdef::onprem[]
. Falls der Host über ein {CMK} Relay überwacht wird, aktivieren Sie in den Eigenschaften des Hosts im Kasten [.guihint]#Basic settings# das Attribut [.guihint]#Monitored on relay# und wählen Sie den Namen des zuvor eingerichteten {CMK} Relay aus.
endif::[]
ifdef::saas[]
. In den Eigenschaften des Hosts, im Kasten [.guihint]#Basic settings# aktivieren Sie [.guihint]#Monitored on relay# und wählen Sie den Namen des zuvor eingerichteten {CMK} Relay aus.
endif::[]
Dieses Attribut wird Ihnen nur dann angezeigt, wenn in diesem Kasten der xref:intro_gui#show_less_more[Show-more-Modus] eingeschaltet ist. +
+
.Ein {CMK} Relay kann erst dann ausgewählt werden, wenn es zuvor eingerichtet wurde
image::intro_snmp_configuration_basic.png[alt="Dialog mit Eigenschaften beim Erstellen eines Hosts per SNMP: die 'Basic settings'."]

. In den Eigenschaften des Hosts im Kasten [.guihint]#Monitoring agents# aktivieren Sie [.guihint]#{CMK} agent / API integrations# und wählen Sie [.guihint]#No API integrations, no {CMK} agent# aus.

. Im gleichen Kasten aktivieren Sie [.guihint]#SNMP# und wählen Sie [.guihint]#SNMPv2 or v3# aus.

. Falls die Community nicht `public` lautet, aktivieren Sie den Eintrag [.guihint]#SNMP credentials#, wählen Sie [.guihint]#SNMP community (SNMP Versions 1 and 2c)# aus und tragen Sie im Eingabefeld darunter die Community ein. +
Für die letzten 3 Punkte sollte das Ergebnis dann so aussehen wie im folgenden Bild: +
+
.Die Konfiguration des Monitoring-Agenten für SNMP
image::intro_snmp_configuration.png[alt="Dialog mit Eigenschaften beim Erstellen eines Hosts per SNMP: die 'Monitoring agents'."]

[TIP]
====
Wenn Sie alle SNMP-Geräte in einem eigenen Ordner angelegt haben, führen Sie die Konfiguration der [.guihint]#Monitoring agents# einfach für den Ordner aus.
Damit gelten die Einstellungen automatisch für alle Hosts in diesem Ordner.
====

Der Rest läuft wie gehabt.
Wenn Sie möchten, können Sie noch mit dem  Knopf [.guihint]#Save & go to connection tests# einen Blick auf die Seite [.guihint]#Test connection to host# werfen.
Dort sehen Sie auch sofort, ob der Zugriff via SNMP funktioniert, hier z.B. für einen Switch:

image::intro_snmp_diagnostics.png[alt="Ergebnis des Verbindungstests zum Host per SNMP."]

Klicken Sie auf der Seite [.guihint]#Properties of host# anschließend auf [.guihint]#Save & run service discovery#, um die Liste aller Services angezeigt zu bekommen.
Diese sieht natürlich komplett anders aus als bei Linux oder Windows.
Auf allen Geräten überwacht {CMK} per Default alle Ports, die aktuell in Benutzung sind.
Dies können Sie später nach Belieben anpassen.
Außerdem zeigt Ihnen ein Service, der immer {OK} ist, die allgemeinen Informationen zu dem Gerät, und ein anderer Service die Uptime an.

Die ausführliche Beschreibung finden Sie im xref:snmp#[Artikel über die Überwachung via SNMP].


[#cloud]
=== Cloud, Container und virtuelle Maschinen überwachen

Auch Cloud-Dienste, Container und  virtuelle Maschinen (VM) können Sie mit {CMK} überwachen, selbst wenn Sie keinen Zugriff auf die eigentlichen Server haben.
{CMK} nutzt dafür die von den Herstellern vorgesehenen Anwendungsprogrammierschnittstellen (API).
Diese verwenden für den Zugriff durchgehend HTTP bzw. HTTPS.

Das Grundprinzip ist immer das Folgende:

. Bereiten Sie in der Management-Oberfläche des Herstellers den Zugriff für {CMK} vor.
. Erstellen Sie in {CMK} einen Host für den Zugriff auf die API.
. Konfigurieren Sie diesen Host, indem Sie unter anderem die Objekte bestimmen, die überwacht werden sollen, wie VMs, EC2-Instanzen, Container usw.
. Für die überwachten Objekte legen Sie weitere Hosts in Checkmk an bzw. automatisieren die Erstellung.

// TK: Nun gilt der folgende Absatz auch für die saas.
Sie finden im Handbuch Schritt-für-Schritt-Anleitungen zur Einrichtung der Überwachung von xref:monitoring_aws#[Amazon Web Services (AWS)], xref:monitoring_azure#[Microsoft Azure], xref:monitoring_gcp#[Google Cloud Platform (GCP)], xref:monitoring_docker#[Docker], xref:monitoring_kubernetes#[Kubernetes] und xref:monitoring_vmware#[VMware ESXi].

xref:intro_gui#[Weiter geht es mit der {CMK}-Oberfläche]
