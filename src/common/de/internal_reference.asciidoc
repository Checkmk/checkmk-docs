// -*- coding: utf-8 -*-
// IGNORE Lorem accusam aliquyam amet clita consetetur dolore dolores eirmod elitr eos erat gubergren invidunt ipsum justo kasd labore magna nonumy rebum sadipscing sanctus sed takimata tempor vero voluptua 21+31 22+32 Asciidoc Stylesheet  Konsolensitzungen gefetteter © ™ Fettung Neute letten Lorem adipiscing aliqua aliquip amet commodo consectetur consequat dolore eiusmod elit enim incididunt ipsum labore laboris magna nostrud quis sed tempor ullamco veniam Duis Excepteur Lorem adipiscing aliqua aliquip amet aute cillum commodo consectetur consequat cupidatat deserunt dolore eiusmod elit enim eu fugiat incididunt ipsum irure labore laboris laborum magna mollit nostrud nulla occaecat officia pariatur proident qui quis reprehenderit sed sint sunt tempor ullamco velit veniam voluptate Duis Excepteur aute cillum cupidatat deserunt dolore eu fugiat irure laborum mollit nulla occaecat officia pariatur proident qui reprehenderit sint sunt velit voluptate fullscreen dicktengleichem → dicktengleichem → → → 132x43 80x24 gescriptet Konsolensitzungen TOC %
// NONASCII
include::global_attr.adoc[]

= Referenzartikel
:title: Referenzartikel
:description: In diesem Referenzartikel werden sehr viele Formatierungselemente einmal verwendet, die wir in den Artikeln für das {CMK}-Handbuch brauchen.
:experimental:

{related-start}
xref:wato_monitoringagents#[Monitoring-Agenten]
xref:datasource_programs#[Datenquellprogramme]
{related-end}


[#intro]
== Einleitung

[#intro2]#Dieser# Referenzartikel enthält Beispiele für fast alle (AsciiDoc-)Formatierungen, die wir im {CMK}-Handbuch verwenden.
Die zugehörige Quelldatei in AsciiDoc kann man sich auf link:https://github.com/Checkmk/checkmk-docs/blob/master/src/common/de/internal_reference.asciidoc?plain=1[GitHub^] ansehen.

Alle Erläuterungen zur Verwendung finden sich im link:https://docs.google.com/document/d/1S948ptXcQ6Bbncs00ZENvmAXXD1GSSmLkmvnK7pts0U/edit?usp=sharing[Dokumentationsleitfaden^],
der übrigens bald aus Google Docs aus- und ins link:https://wiki.lan.checkmk.net/spaces/KNW/pages/83526663/Knowledge-Team[Wiki^] einzieht.


[#ueberschriften]
== Überschrift eines Kapitels (Level 1)

=== Überschrift eines Abschnitts (Level 2)

==== Überschrift eines Abschnitts (Level 3)

[discrete]
==== Überschrift eines weiteren Abschnitts (Level 3), der nicht im TOC steht

=== Überschrift eines weiteren Abschnitts (Level 2)

Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat, sed diam voluptua. At vero eos et accusam et justo duo dolores et ea rebum. Stet clita kasd gubergren, no sea takimata sanctus est Lorem ipsum dolor sit amet. Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat, sed diam voluptua. At vero eos et accusam et justo duo dolores et ea rebum. Stet clita kasd gubergren, no sea takimata sanctus est Lorem ipsum dolor sit amet.


[#listen]
== Aufzählungen und Listen

=== Ungeordnete Liste (Aufzählung)

Die unterstützten Distributionen sind:

* Debian
* Ubuntu in den LTS-Versionen
* Red Hat Enterprise Linux (RHEL) und binärkompatible Distributionen (CentOS, AlmaLinux, Rocky Linux, Oracle Linux...)
* SUSE Linux Enterprise Server (SLES)

Listen mit sehr vielen, sehr kurzen Einträgen können mehrspaltig dargestellt werden.
Die Darstellung ist momentan eher grob am Viewport orientiert, eine echte Umsetzung mit Flexboxen ist nicht vorgesehen.
Bei Viewports größer ca. 1200px erfolgt die Darstellung dreispaltig, beim Tablet zweispaltig, auf dem Smartphone einspaltig.
Um diesen Listentyp zu aktivieren, ist die Klasse `multicol` zuzuordnen.

[multicol]
* active check helpers
* agent receiver
* alert helper
* apache
* automation helpers
* checker helpers
* cmc
* dcd
* event console
* fetcher helpers
* jaeger
* livestatus proxy
* notification spooler
* notify helper
* piggyback hub
* rabbitmq
* real-time helper
* redis-server
* rrdcached
* rrd helper

=== Geordnete Liste

Die Installation von {CMK} geschieht dann in vier Schritten:

. Vorbereiten des Linux-Systems.
. Einrichten der Paketquellen.
. Herunterladen des passenden {CMK}-Pakets.
. Installation des Pakets.

=== Beschreibende Liste (_description list_)

CPU:: The brain of the computer.
Hard drive:: Permanent storage for operating system and/or user files.
RAM:: Temporarily stores information the CPU uses during operation.
Keyboard:: Used to enter text or control items on the screen.

Eine Sonderform der `dlist` wird für die Erzeugung von xref:tabs[Tabs] verwendet.

[#tabellen]
== Tabellen

Tabelle mit 3 Spalten gleicher Breite, ohne Titel:

[cols=3]
|===
|Spalte 1 |Spalte 2 |Spalte 3
|Zelle 1.1 |Zelle 1.2 |Zelle 1.3
|Zelle 2.1 |Zelle 2.2 |Zelle 2.3
|===

Tabelle mit 4 Spalten (1. Spalte mit 10 % Breite, 4. Spalte mit 20 % Breite, Breite der beiden mittleren Spalten gleich verteilt), mit Titel:

[cols="10,~,~,20",options="header"]
|===
|Header 1 |Header 2 |Header 3 |Header 4
|Zelle 1.1 |Zelle 1.2 | Zelle 1.3| Zelle 1.4
|Zelle 2.1 |Zelle 2.2 | Zelle 2.3| Zelle 2.4
|===

Wie zuvor, aber mit 2 zusätzlichen Optionen (frame="none",grid="none") für eine Tabelle ohne _borders_ (offensichtlich ohne durchschlagenden Erfolg, weil unser Stylesheet noch nicht angepasst wurde): 

[cols="10,~,~,20",options="header",frame="none",grid="none"]
|===
|Header 1 |Header 2 |Header 3 |Header 4
|Zelle 1.1 |Zelle 1.2 | Zelle 1.3| Zelle 1.4
|Zelle 2.1 |Zelle 2.2 | Zelle 2.3| Zelle 2.4
|===

Eine Tabelle mit 3 Spalten, in der zweimal 2 Zellen miteinander verbunden werden:

[cols="20,20,~",options="header"]
|===
|Header 1 |Header 2 |Header 3
|Zelle 1.1 | Zelle 1.2 | Zelle 1.3
.2+| Zellen 2.1 und 3.1 werden verbunden .2+| Zellen 2.2 und 3.2 auch |Zelle 2.3 steht alleine
|Zelle 3.3 steht auch alleine
|===

Eine Tabelle, mit der wir einen Spezialtyp der kollabierbaren Tabellen testen:

// [.tablecollapsible]
[.tablecollapsible,cols="10,10,~,~",options="header"]
|===
|Port |Protokoll |Bezeichnung |Ergänzende Informationen
ifdef::onprem[]
|80 |TCP |Hypertext Transfer Protocol (HTTP) |xref:glossar#agent_updater[Agent Updater] (xref:glossar#agent_bakery[Agentenbäckerei]), Discovery des Agent Controller Ports
|162 |UDP |Simple Network Management Protocol Trap (SNMPTRAP) EC |Empfang von xref:ec#snmp[SNMP-Traps über die Event Console] _(optional aktivierbar)_
|443 |TCP |Hypertext Transfer Protocol over SSL/TLS (HTTPS) |Agent Updater (Agentenbäckerei), Discovery des Agent Controller Ports, mit Transportverschlüsselung
|514 |TCP und UDP |Syslog (EC) |Empfang von xref:ec#setup[Syslog-Nachrichten über die Event Console] _(optional aktivierbar)_
|4317 |TCP |OpenTelemetry (über gRPC) | Empfang von xref:opentelemetry#[OpenTelemetry] Metriken _(optional aktivierbar ab {CE})_
|4318 |TCP |OpenTelemetry (über HTTP/HTTPS) | Empfang von xref:opentelemetry#[OpenTelemetry] Metriken _(optional aktivierbar ab {CE})_
|6559 |UDP | link:https://checkmk.com/werk/8350[Echtzeitprüfungen^] |Empfang von UDP-Paketen für die Echtzeitprüfungen einzelner Dienste (selten verwendet, _optional aktivierbar_)
endif::[]
ifdef::saas[]
|443 |TCP |Hypertext Transfer Protocol over SSL/TLS (HTTPS) |xref:glossar#agent_updater[Agent Updater] (xref:glossar#agent_bakery[Agentenbäckerei]), Discovery des Agent Controller Ports
endif::[]
|8000 |TCP |Agent Controller TLS-Registrierung, Agenten im xref:glossar#push_mode[Push-Modus] |Wenn mehrere Instanzen auf dem {CMK}-Server laufen, sind eventuell weitere Ports (8001, 8002…) nötig.
|===

[#admonitions]
== Admonitions (Tipps, Warnungen)

[TIP]
====
Der Typ `pass:[[TIP]]` wird für Tipps und Anmerkungen wie Hintergrundinformationen verwendet.
Wir heben ihn nur durch einen Kasten in der Farbe `lightgray` leicht hervor, dass er den Lesefluss nicht zu sehr stört.
Als Breite wird die volle Breite der Mittelspalte verwendet.
// Quelle des Icons: Inhouse, erstellt durch Tanja H.
====

[IMPORTANT]
====
Der Typ `pass:[[IMPORTANT]]` warnt: Achtung, wenn Du hier einen Fehler machst, funktioniert nachher etwas nicht.
Da wir ein Software-Anbieter sind, ist kein Problem irreversibel, denn es gilt:
No backup, no mercy!
Aus diesem Grund benötigen wir keinen weiteren, rot ausgezeichneten Typen, der auf die Gefahr hoher Schäden bei Nichtbeachtung verweist.
// Quelle des Icons: https://uxwing.com/caution-icon/
// Lizenz: https://uxwing.com/license/
====

[#collapsibles]
== Collapsibles oder Expandables (eine Frage der Perspektive)

Wir erlauben Collapsibles bislang erst einmal als Block-Container.

.[#thisisanid]#Weisst Du, was lustig ist?#
[%collapsible]
====
Ich weiss es auch nicht.

Sed ut perspiciatis unde omnis iste natus error sit voluptatem accusantium doloremque laudantium, totam rem aperiam, eaque ipsa quae ab illo inventore veritatis et quasi architecto beatae vitae dicta sunt explicabo. Nemo enim ipsam voluptatem quia voluptas sit aspernatur aut odit aut fugit, sed quia consequuntur magni dolores eos qui ratione voluptatem sequi nesciunt.

Hier kann auch eine Liste rein...

. Eins
. Zwo
. Drei

Test mit einem Bild:

.Dieses Bild wohnt in einem Collapsible
image::wato_rules_setup_service_list.png[alt="Bild der Service-Discovery, mit einem Highlight um ein paar Knöpfe."]

Oder Shell-Zeugs.
====

Und etwas mehr folgender Text.

.Setzen wir Collapsibles sparsam genug ein?
[%collapsible]
====
Keine Ahnung.

Finden wir es heraus.

[.admonition-tip]
****
Achtung, Linux kann anstrengend sein.
****

[.admonition-important]
****
Egal, macht Spaß!
****
====

[#bilder]
== Bilder, Alt-Texte

.Die Bildunterschrift
image::wato_rules_setup_service_list.png[alt="Bild der Service-Discovery, mit einem Highlight um ein paar Knöpfe."]

Das folgende Bild sollte klickbar sein und eine Lightbox öffnen.

.Auch hier mit Bildunterschrift
image::internal_reference_ad_service.png[alt="Ein komplettes Dashboard.",lightbox=1]

[#aktionsknoepfe]
== Aktionsknöpfe (Buttons)

In {CMK} kann man über den Knopf icon:icon_new[alt="Symbol zum Erstellen eines Hosts."] [.guihint]#Add host# Hosts anlegen.


[#konsolensitzungen]
== Konsolensitzungen

=== shell

[{shell}]
----
{c-root} su - mysite
{c-omd} omd status
liveproxyd:     [red]#stopped#
rrdcached:      [green]#running#
cmcrushd:       [green]#running#
cmc:            [red]#stopped#
apache:         [green]#running#
crontab:        [green]#running#
-----------------------
Overall state:  [yellow]#partially running#
{c-omd} exit
{c-root} sudo su - central
{c-local}
{c-root} pass:[https://checkmk.com]
{c-root} https://checkmk.com
----

=== shell-raw

[{shell-raw}]
----
{c-root} su - mysite
{c-omd} omd status
liveproxyd:     [red]#stopped#
rrdcached:      [green]#running#
cmcrushd:       [green]#running#
cmc:            [red]#stopped#
apache:         [green]#running#
crontab:        [green]#running#
-----------------------
Overall state:  [yellow]#partially running#
{c-omd} exit
{c-root} sudo su - central
{c-local}
{c-root} https://checkmk.com
----

=== WIP: Copy-Button für die Eingabezeile:

Vorsicht, wenn ein Asterisk als Glob verwendet werden soll!
Bitte entweder `pass` nutzen oder das Makro `shell-raw`:

[.copybutton]
[{shell-raw}]
----
OMD[mysite]:~/etc/apache/mellon$ mv *.key mellon.key
OMD[mysite]:~/etc/apache/mellon$ mv *.cert mellon.cert
----

Das Makro `shell` lässt eingebettete Makros und CSS-Klassen für Farben zu:

[.copybutton]
[{shell}]
----
{c-omd} omd status
liveproxyd:     [red]#stopped#
rrdcached:      [green]#running#
cmcrushd:       [green]#running#
cmc:            [red]#stopped#
apache:         [green]#running#
crontab:        [green]#running#
-----------------------
Overall state:  [yellow]#partially running#
----

So finden Sie heraus, welches DEB-Paket installiert ist:

[.copybutton]
[{shell}]
----
{c-root} dpkg -l | grep check-mk-agent
ii  check-mk-agent          {current}-1          all          Checkmk Agent for Linux
----

Das geht ganz einfach in einer interaktiven Python-Session:

[.copybutton]
[{shell}]
----
{c-omd} python3
Python 3.8.10 (default, Jun  2 2021, 10:49:15)
----

Nach dem Öffnen müssen Sie das Modul `re` importieren. Im Beispiel schalten wir
zudem mit `re.IGNORECASE` die Unterscheidung zwischen Groß- und Kleinschreibung
ab.
Um das Verhalten der regulären Ausdrücke von C nachzubilden, das auch in vielen
Python-Komponenten genutzt wird, schränken Sie auf ASCII ein.

Standard: Ohne Copybutton!

// [.copybutton]
[{pycon}]
----
Python 3.8.10 (default, Jun  2 2021, 10:49:15)
[GCC 9.4.0] on linux
Type "help", "copyright", "credits" or "license" for more information.
>>> import re
>>> re.IGNORECASE
re.IGNORECASE
>>> re.ASCII
re.ASCII
----

Nun können Sie mit der Funktion `re.match()` direkt einen regulären Ausdruck
gegen einen String matchen und die xref:regexes#matchgroups[Match-Gruppe] ausgeben,
`group(0)` steht hierbei für den gesamten Match, mit `group(1)` wird der
Match ausgegeben, der zum ersten in einer runden Klammer gruppierten
Unterausdruck passt:

[.copybutton]
[{pycon}]
----
>>> x = re.match('M[ae]{1}[iy]{1}e?r', 'Meier')
>>> x.group(0)
'Meier'
>>> x = re.match('M[ae]{1}[iy]{1}e?r', 'Mayr')
>>> x.group(0)
'Mayr'
>>> x = re.match('M[ae]{1}[iy]{1}e?r', 'Myers')
>>> x.group(0)
[cpignore]#Traceback (most recent call last):#
[cpignore]#File "<stdin>", line 1, in <module>#
[cpignore]#IndexError: no such group#
>>> x = re.match('server-(.pass:[*])\.local', 'server-lnx23.local')
>>> x.group(0)
'server-lnx23.local'
>>> x.group(1)
'lnx23'
----

<<<<<<< HEAD
Hier wurde explizit `pass:[[cpignore]]#` verwendet, um den Traceback zu exkludieren!
=======
Den Traceback mussten wir hier explizit vom Kopieren ausschließen.
Sollen längere Tracebacks mit Syntaxhighlighting dargestellt wreden, ist der Dateityp xref:pytb[`pytb`] mit einer eigenen Box zu verwenden.

=== Ein SQL-Prompt

Wir verwenden derzeit den generischen SQL-Lexer, der den Prompt nicht korrekt erkennt.
Hier wird zuviel kopiert, manchmal sogar die Ausgabe.

[.copybutton]
[{sql}]
----
mssql> USE master;
      GRANT CONNECT SQL TO checkmk;
      GRANT CONNECT ANY DATABASE TO checkmk;
      GRANT VIEW SERVER STATE TO checkmk;    
      GO
----

Ein Workaround besteht darin, das generierte HTML anzupassen und direkt einzufügen.
Der Typ ist dabei auf `sql-session` abzuändern.

++++
<div class="listingblock copybutton"><div class="content"><pre class="pygments highlight"><code data-lang="sql-session"><span></span><span class="tok-gp">mssql</span><span class="tok-gp">&gt; </span><span class="tok-w"></span><span class="tok-n">USE</span><span class="tok-w"> </span><span class="tok-n">master</span><span class="tok-p">;</span>
<span class="tok-w">      </span><span class="tok-k">GRANT</span><span class="tok-w"> </span><span class="tok-k">CONNECT</span><span class="tok-w"> </span><span class="tok-k">SQL</span><span class="tok-w"> </span><span class="tok-k">TO</span><span class="tok-w"> </span><span class="tok-n">checkmk</span><span class="tok-p">;</span>
<span class="tok-w">      </span><span class="tok-k">GRANT</span><span class="tok-w"> </span><span class="tok-k">CONNECT</span><span class="tok-w"> </span><span class="tok-k">ANY</span><span class="tok-w"> </span><span class="tok-k">DATABASE</span><span class="tok-w"> </span><span class="tok-k">TO</span><span class="tok-w"> </span><span class="tok-n">checkmk</span><span class="tok-p">;</span>
<span class="tok-w">      </span><span class="tok-k">GRANT</span><span class="tok-w"> </span><span class="tok-k">VIEW</span><span class="tok-w"> </span><span class="tok-n">SERVER</span><span class="tok-w"> </span><span class="tok-k">STATE</span><span class="tok-w"> </span><span class="tok-k">TO</span><span class="tok-w"> </span><span class="tok-n">checkmk</span><span class="tok-p">;</span>
<span class="tok-w">      </span><span class="tok-k">GO</span></code></pre></div></div>
++++

[#dateiinhalte]
== Dateiinhalte

Auch Dateien formatieren wir mit Pygments.
Einige Dateitypen erhalten den Copy-Button per Default, andere nicht.

=== Einfache Dateien

Bei Logdateien, für die kein Pygments-Lexer bereitgestellt wird, kann der generische Typ `pass:[[{file}]]` verwendet werden.
Der Copybutton ist standardmäßig deaktiviert:

.~/var/log/cmc.log
[{file}]
----
2016-02-24 16:30:48 [5] Successfully initiated connection to Carbon/Graphite
2016-02-24 16:32:57 [4] Connection to Carbon/Graphite at 10.0.0.5:2003 failed
2016-02-24 16:32:57 [5] Closing connection to Carbon/Graphite
----

.~/var/log/cmc_mitHighlight.log
[{file},highlight=2..3]
----
2016-02-24 16:30:48 [5] Successfully initiated connection to Carbon/Graphite
2016-02-24 16:32:57 [4] Connection to Carbon/Graphite at 10.0.0.5:2003 failed
2016-02-24 16:32:57 [5] Closing connection to Carbon/Graphite
2016-02-24 16:32:57 [5] Something else concerning Carbon/Graphite
----

Für kopierbare Konfigurationsdateien, für die kein Lexer existiert, muss der Copybutton manuell aktiviert werden:

./etc/dhcp/dhcpd.conf
[.copybutton]
[{file}]
----
subnet 198.51.100.0 netmask 255.255.255.0 {
  range 198.51.100.100 198.51.100.199;
  option routers 198.51.100.1;
  option domain-name-servers 8.8.8.8;
}
----

=== Shellskripte, z.B. Bash

Und ein Shellscript, Bourne Shell oder Konsorten.
Standard ist der Copybutton.

./lqsample.sh
// [.copybutton]
[{bash}]
----
#!/bin/bash

cat << EOF | lq
GET services
Cache: reload
Columns: service_description host_name hostgroups servicegroups
Filter: host_name ~~ switch-intern
Filter: host_name ~~ localhost
Or: 2
Filter: service_description ~~ cpu
Filter: service_description ~~ mem
Or: 2
And: 2
Limit: 80

EOF
----

=== Konfiguration im YAML-Format

Sollten Sie auf dem Host mehrere MSSQL-Instanzen mit verschiedenen Benutzernamen und Passwörtern betreiben, erweitern Sie die `yml`-Datei entsprechend um die Angaben zu den Instanzen.
Ihre `yml`-Datei könnte dann beispielsweise so aussehen:

.C:\ProgramData\checkmk\agent\config\mk-sql.yml
[{yaml}]
----
# Beispielkonfiguration mk-sql.yml
mssql:
  main:
    authentication:
      username: ""
      type: integrated
    instances:
      - sid: myInstance 1
        auth:
          username: myUser1
          password: "123456"
          type: sql_server
      - sid: myInstance 2
        auth:
          username: myUser2
          password: "987654"
          type: sql_server
----

=== JSON-Objekte

Ein sauberer Workaround für das gelegentlich auftretende Problem, in Curl-Calls längeres Inline-JSON unterbringen zu müssen, kann darin bestehen, die Nutzlast in eine separate JSON-Datei zu schreiben.

Das erforderliche JSON-Objekt wird im Beispiel als `/tmp/payload.json` gespeichert:

./tmp/payload.json
[source,json]
----
{
    "attributes": {
        "tag_criticality": "prod"
    },
    "name": "production_hosts",
    "parent": "~linux",
    "title": "Production Hosts"
}
----

Für den Aufruf von `curl` wird das JSON-Objekt eingelesen, hier funktioniert Highlighting und Kopiervorgang:

[{shell}]
----
{c-user} curl \
    --request POST \
    --header "Authorization: Bearer $USERNAME $PASSWORD" \
    --header "Accept: application/json"     \
    --header "Content-Type: application/json" \
    --data-binary "@/tmp/payload.json" \
    "$API_URL/domain-types/folder_config/collections/all"
----

=== SQL-Skripte

Ist ein Skript eindeutig als solches zu erkennen (ein Beispieldateiname ist vorhanden), sorgt `sql` für die richtige Formattierung und den automatisch erzeugten Copy-Button:

./etc/check_mk/MyCustomSQL.sql
[{sql}]
----
/*Syntax help in comments. The first word is alwyas the key word and ends with a ":"*/

/*details:Text to display in the service detail output*/
prompt details: Some details for the service output;

/*perfdata:METRIKNAME=CURRENTVALUE;WARN;CRIT;MAX METRIKNAME=CURRENTVALUE2;WARN;CRIT;MAX*/
prompt perfdata:MyMetricName1=10;15;20;30 MyMetricName2=16;15;20;30;
prompt perfdata:MyMetricName3=21;15;20;30 MyMetricName4=15;15;20;30;

/*long:Text to display in the long output of the service*/
prompt long: Here comes some long output for the service;
prompt long: Here comes some more long output for the service;

/*exit:Status of the service as a number*/
prompt exit:2;
----

=== Apache-Konfiguration

./etc/apache2/sites-enabled/000-default
[source,apache]
----
RewriteEngine On
# Never forward request for .well-known (important when using Let's Encrypt)
RewriteCond %{REQUEST_URI} !^/.well-known
# Next 2 lines: Force redirection if incoming request is not on 443
RewriteCond %{SERVER_PORT} !^443$
RewriteRule (.*) https://%{HTTP_HOST}$1 [L]
# This section passes the system Apaches connection mode to the
# instance Apache. Make sure mod_headers is enabled, otherwise it
# will be ignored and "Analyze configuration" will issue "WARN".
<IfModule headers_module>
    RequestHeader set X-Forwarded-Proto expr=%{REQUEST_SCHEME}
    RequestHeader set X-Forwarded-SSL expr=%{HTTPS}
</IfModule>
----

[#pytb]
=== Python-Tracebacks

Python-Traceback dürfen nicht mit Shell-Sessions oder interaktiven Python-Sessions gemischt werden.
Sie bekommen keinen Copybutton.
Wozu auch?
>>>>>>> fe0644c7 (be more precise pick-24)

// No copy button for tracebacks!
[source,pytb]
----
Traceback (most recent call last):
  File "/omd/sites/mysite/lib/python3/cmk/discover_plugins/_python_plugins.py", line 195, in add_from_module
    module = importer(mod_name, raise_errors=True)
             ^^^^^^^^^^^^^
  File "/omd/sites/mysite/lib/python3/cmk/discover_plugins/_python_plugins.py", line 156, in _import_optionally
    return importlib.import_module(module_name)
           ^^^^^^^^^^^^
  File "/omd/sites/mysite/lib/python3.12/importlib/init.py", line 90, in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^
  File "<frozen importlib._bootstrap>", line 1387, in _gcd_import
  File "<frozen importlib._bootstrap>", line 1360, in _find_and_load
  File "<frozen importlib._bootstrap>", line 1331, in _find_and_load_unlocked
  File "<frozen importlib._bootstrap>", line 935, in _load_unlocked
  File "<frozen importlib._bootstrap_external>", line 995, in exec_module
  File "<frozen importlib._bootstrap>", line 488, in _call_with_frames_removed
  File "/omd/sites/mysite/local/lib/python3/cmk_addons/plugins/myhostgroups/agent_based/myhostgroups.py", line 110, in <module>
    agent_section_myhostgroups == AgentSection(
    ^^^^^^^^^^
NameError: name 'agent_section_myhostgroups' is not defined
----

[.copybutton]
[{shell}]
----
{c-user} curl \
--request PUT \
--header "Authorization: Bearer $USERNAME $PASSWORD" \
--header "Accept: application/json" \
--header "If-Match: "a200832df1b3c5ebe8f30809177630abbdcf8f7cbd9d0f69bd9f229b359f4d00"" \
--header "Content-Type: application/json" \
--data '{ "new_name": "mylinuxserver01" }' \
"$API_URL/objects/host_config/#mylinuxserver#/actions/rename/invoke"
----

Hier wird in [.guihint]#Main > Linux# ein Unterordner [.guihint]#Production Hosts# erstellt -- im Dateisystem als Verzeichnis `production_hosts`.
Dem neuen Ordner wird dabei das xref:glossar#host_tag[Host-Merkmal] [.guihint]#Productive system# aus der xref:host_tags#predefined_tags[vordefinierten Host-Merkmalsgruppe] [.guihint]#Criticality# zugewiesen.

Das erforderliche JSON-Objekt wird im Beispiel als `/tmp/payload.json` gespeichert:

./tmp/payload.json
[source,json]
----
{
    "attributes": {
        "tag_criticality": "prod"
    },
    "name": "production_hosts",
    "parent": "~linux",
    "title": "Production Hosts"
}
----

Für den Aufruf von `curl` wird das JSON-Objekt eingelesen

[.copybutton]
[{shell}]
----
{c-user} curl \
    --request POST \
    --header "Authorization: Bearer $USERNAME $PASSWORD" \
    --header "Accept: application/json"     \
    --header "Content-Type: application/json" \
    --data-binary "@/tmp/payload.json" \
    "$API_URL/domain-types/folder_config/collections/all"
----

[#dateiinhalte]
== Dateiinhalte

.~/var/log/cmc.log
[{file}]
----
2016-02-24 16:30:48 [5] Successfully initiated connection to Carbon/Graphite
2016-02-24 16:32:57 [4] Connection to Carbon/Graphite at 10.0.0.5:2003 failed
2016-02-24 16:32:57 [5] Closing connection to Carbon/Graphite
----

.~/var/log/cmc_mitHighlight.log
[{file},highlight=2..3]
----
2016-02-24 16:30:48 [5] Successfully initiated connection to Carbon/Graphite
2016-02-24 16:32:57 [4] Connection to Carbon/Graphite at 10.0.0.5:2003 failed
2016-02-24 16:32:57 [5] Closing connection to Carbon/Graphite
2016-02-24 16:32:57 [5] Something else concerning Carbon/Graphite
----

=== Eine kopierbare Konfigurationsdatei

./etc/dhcp/dhcpd.conf
[.copybutton]
[{file}]
----
subnet 198.51.100.0 netmask 255.255.255.0 {
  range 198.51.100.100 198.51.100.199;
  option routers 198.51.100.1;
  option domain-name-servers 8.8.8.8;
}
----

Diese Datei ist eine Datei, hat aber keinen Titel:

[.copybutton]
[{file}]
----
subnet 198.51.100.0 netmask 255.255.255.0 {
  range 198.51.100.100 198.51.100.199;
  option routers 198.51.100.1;
  option domain-name-servers 8.8.8.8;
}
----

Und ein Shellscript, Bourne Shell oder Konsorten:

./lqsample.sh
[.copybutton]
[{bash}]
----
#!/bin/bash

cat << EOF | lq
GET services
Cache: reload
Columns: service_description host_name hostgroups servicegroups
Filter: host_name ~~ switch-intern
Filter: host_name ~~ localhost
Or: 2
Filter: service_description ~~ cpu
Filter: service_description ~~ mem
Or: 2
And: 2
Limit: 80

EOF
----

[#tabs]
== Reiter für mehrfache Darreichung

[tabs]
====
Windows::
+
--
Hier stehen beliebig viele Blöcke.

Hier wird etwas für Windows erklärt.

.Dieses Bild wohnt in einer Tabgruppe
image::views_menu_context_host.png[alt="Irgendein Bild, das nicht zu groß ist."]
--
Linux::
+
--
Auch hier stehen beliebig viele Blöcke.

Hier wird etwas für Linux erklärt.

Erklärungen für Linux sind oft etwas länger als für Windows, daher steht hier ein dritter Absatz.
In der finalen Umsetzung von Tabs sollte der höchste Tab die Größe der umgebenden Box bestimmen, um ein Springen zu vermeiden.
Dennoch sollten wir darauf achten, dass die Höhen nicht zu dolle abweichen. Ich habe jetzt mal zum Testen die Höhe per JavaScript vereinheitlicht. (wieder rückgängig gemacht)

[.admonition-tip]
****
Achtung, Linux kann anstrengend sein.
****

[.admonition-important]
****
Egal, macht Spaß!
****

Und noch ein Satz, mit dem wir testen, dass die transformierte Admonition an der richtigen Stelle eingehängt wird.
--
OS/2::
+
--
Ganz wichtig sind halbe Betriebssysteme.

Auch für diese kann {CMK} dolles Monitoring gewährleisten!
Nein, nicht wirklich.
--
Zeugs::
+
--

./etc/dhcp/dhcpd.conf
[.copybutton]
[{file}]
----
subnet 198.51.100.0 netmask 255.255.255.0 {
  range 198.51.100.100 198.51.100.199;
  option routers 198.51.100.1;
  option domain-name-servers 8.8.8.8;
}
----
--
====


[#textauszeichnung]
== Textauszeichnung im Fließtext

Eine Mischung _kursiver,_ *gefetteter,* und `dicktengleicher` Schrift gefolgt von einem [.guihint]#GUI-Hint.#  


[#anfuehrungszeichen]
== Anführungszeichen

„Dieser deutschsprachige Text wird von schönen doppelten Anführungszeichen umgeben.“

'This english sentence is enclosed by apostrophes.'


[#sonderzeichen]
== Sonderzeichen

Hier folgen alle Sonderzeichen, die so im {CMK}-Handbuch erlaubt sind:
&#8230; (TM) (C) und ein paar geschützte {nbsp}{nbsp}{nbsp}{nbsp}{nbsp}{nbsp}{nbsp} Leerzeichen.


[#makros]
== Text- und Bild-Makros

Hier folgen alle Text- und Bildmakros, die im {CMK}-Handbuch verwendet werden können:

{OK} {WARN} {CRIT} {PEND} {UNKNOWN} {UP} {DOWN} {UNREACH}

{CMK} gibt es in den folgenden unterschiedlichen Editionen: {CRE}, {CSE}, {CCE} und {CME}

Das ganze gibt es auch noch mal in Kurzform ohne Fettung und Icons:
{RE}, {SE}, {CE} und {ME}

Als Abgrenzung zur {RE} werden die anderen drei Editionen als kommerzielle Editionen (_commercial editions_) bezeichnet.
Für die kommerziellen Editionen gibt es _kein_ Makro!

Und hier nur die Bildmarken ohne Text
{cee-only} {cre-only}

=== Versionen

Eine Major-Update-Kette: {oldoldstable} [.fa-light.fa-arrow-right-long]#&nbsp;# {oldstable} [.fa-light.fa-arrow-right-long]#&nbsp;# {current-major}

Im folgenden Beispiel wird nur dann korrekt ersetzt, wenn die Datei `cmk_versions.adoc` eingebunden ist.
Diese wird seit dem 6. November 2025 von Docserve und den Build-Skripten erzeugt.

Eine präzise Update-Kette: {oldoldstable-patch} [.fa-light.fa-arrow-right-long]#&nbsp;# {oldstable-patch} [.fa-light.fa-arrow-right-long]#&nbsp;# {current}


[#makros_com]
=== In bester Gesellschaft...

Da künftig vielleicht keine Umbenennung mehr droht, aber möglicherweise eine Änderung der Schreibweise oder wir werden Kommanditgesellschaft auf Aktien, hier der Firmenname in Kurzform: {com} und hier in Langform: {comfull}.


[#links]
== Verweise (Links) und Einsprungziele (Anker)

Ein Verweis zur xref:intro[Einleitung] hier oben im Artikel.
Der Anker für diesen Verweis heißt `pass:[[#intro]]` und ist vor der Überschrift definiert.

Ein weiterer Verweis zur xref:intro2[Einleitung], wobei hier ein anderer Anker als Ziel genutzt wird.
Der Anker heißt `pass:[[#intro2]]` und ist für das 1. Wort des 1. Absatzes der Einleitung gesetzt in folgender Syntax: `pass:[[#intro2]]pass:[#Dieser#]`

Ein Verweis zu einem xref:agent_linux#[Artikel im Handbuch].

Ein Verweis zu einem xref:agent_linux#disabled_sections[bestimmten Anker in diesem Artikel].

Ein Verweis auf eine Webseite außerhalb von docs.checkmk.com.
Ich verlinke mal die letten Neute von link:https://checkmk.com/[Checkmk^].


[#tasten]
== Tasten per Keyboard-Makro

Damit Keyboard-Makros funktionieren, muss das Dokumentattribut `:experimental:` gesetzt sein!
Keyboard-Makros funktionieren inline und in Tabellen oder Listen.
Bitte lange Makros wie kbd:[Ctrl+Alt+Del] inline sparsam einsetzen.
Sequenzen wie das für die link:https://www.mnemonic-device.com/computer/raising-elephants-is-so-utterly-boring/[Elefantenaufzucht^] sind nicht vorgesehen: kbd:[Alt+PrtScn+R] kbd:[E] kbd:[I] kbd:[S] kbd:[U] kbd:[B].
Dass wir Überschneidungen vermeiden sollten, seht Ihr, oder?

Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.  Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. kbd:[Ctrl+Alt+Del] Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum. Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. kbd:[Ctrl+Alt+Del] Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum. 

[cols="20,~",options="header"]
|===
|Kürzel |Aktion

|kbd:[F11]
|Toggle fullscreen

|kbd:[Ctrl+T]
|Open a new tab

|kbd:[Ctrl+Shift+N]
|New incognito window

|kbd:[\ ]
|Used to escape characters

|kbd:[Ctrl+\]]
|Jump to keyword

|kbd:[Ctrl + +]
|Increase zoom
|===


[#escaping]
== Ersetzungen verhindern (Escaping)

Ein Sternchen innerhalb von dicktengleichem Text -> `pass:[.*]temp`

Eckige Klammern innerhalb einer URL innerhalb von dicktengleichem Text -> `\http://myserver/mysite/check_mk/host_inv_api.py?request={"hosts":\pass:[[]"myhost","myhost2"pass:[]]}&output_format=json`

Oder doch besser so? -> `\http://myserver/mysite/check_mk/host_inv_api.py?request={"hosts":&#91;"myhost","myhost2"&#93;}&output_format=json`

Eine URL, die nicht zum Link werden soll -> \https://checkmk.com


[#tui_screenshots]
== TUI-Screenshots

Mit Gnome-Terminal kann man bunte Screenshots aus TUI-Oberflächen erstellen:
Achtet darauf, dass ein GNOME-Farbschema eingestellt ist, damit die Farben konsistent sind.
Schriftart und Schriftgröße sind egal.
Terminal auf 80x24 oder 132x43 einstellen (je nachdem, was besser aussieht) und dann mit [.guihint]#Edit > Select all# gefolgt von [.guihint]#Edit > Copy HTML# das HTML-Fragment kopieren.
Das kommt dann in eine eigene Datei, hier `includes/de/screen_opentelemetry_tui_collector.xml`.
Derzeit ist noch etwas Nacharbeit erforderlich (Leerzeilen entfernen, Padding entfernen, Schlagschatten unten reparieren), aber das wird bald gescriptet.

++++
include::screen_opentelemetry_tui_collector.xml[]
++++
