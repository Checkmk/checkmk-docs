// -*- coding: utf-8 -*-
// IGNORE bi_aggregation bi_aggregation_connection agent_bi checkmk_agent cmk_site_statistics livestatus_status mkbackup mkbackup_site mkeventd_status mknotifyd_connection_v2 mknotifyd omd_apache omd_broker_queues omd_broker_status omd_diskusage omd_status site_object_counts
// SKIPCOMMITS 
include::global_attr.adoc[]
= Das eigene System überwachen
:revdate: draft
:title: Das eigene System überwachen
:description: {CMK} kann nicht nur andere Systeme überwachen, auch das Monitoring der eigenen Gesundheit ist möglich. Lesen Sie hier, wie Sie die systeminterne Überwachung einstellen und anpassen.

{related-start}
xref:monitoring_basics#[Grundlagen des Monitorings mit {CMK}]
xref:hosts_setup#[Verwaltung der Hosts]
xref:wato_rules#[Regeln]
{related-end}


== Einleitung

Im xref:intro_setup_monitor.html#linux[Leitfaden für Einsteiger] haben wir Ihnen gezeigt, wie man die Basis schafft, um den {CMK}-Server zu überwachen.
Im folgenden Artikel geht es nun darum, diese Überwachung sinnvoll mit Leben zu füllen.
Schließlich kann {CMK} nicht nur prüfen, ob der {CMK}-Server läuft, sondern es gibt noch weitaus mehr Parameter, die geprüft -- und in der Folge auch optimiert -- werden können.
// ES: Perfekter Einstieg mit dem Verweis auf intro_setup_monitor. Der verlinkte Artikel könnte dann auch noch 1-2 Sätze bekommen, in denen hierhin verwiesen wird. Zum Beispiel könntest du in intro_setup_monitor.html#services erwähnen, dass in diesem Artikel hier mehr Infos zu den Services zu finden sind, die ein Checkmk-Server standardmäßig mitbringt.


== Prozessüberwachung

In der Prozessüberwachung beispielsweise existieren vorgefertigte Regeln für spezifische Services zur Selbstüberwachung.
// ES: Ist "Prozessüberwachung" hier wirklich der richtige Begriff?
Dorthin gelangen Sie über [.guihint]#Setup > Services > Service discovery rules > Process discovery#.
// ES: Im Setup-Menü heißt der Eintrag "Discovery rules", nicht "Service discovery rules"

Für jeden Host, der das Host-Merkmal `cmk/check_mk_server:yes` trägt, werden dank den mitgelieferten Regeln automatisch folgende Services gefunden:

// ES: Ich habe in der Liste guihints ergänzt und den vollen Namen für jeden Service ausgeschrieben. Du entscheidest, ob "mysite" besser zu "myhost" werden sollte und/oder ein Hinweis vor der Liste nötig ist (in Richtung "die Servicenamen in der Liste beziehen sich auf einen Beispiel-Host namens `myhost`")

[servlist_multicol]
* [.guihint]#Process mysite active check helpers#
* [.guihint]#Process mysite agent receiver#
* [.guihint]#Process mysite alert helper#
* [.guihint]#Process mysite apache#
* [.guihint]#Process mysite automation helpers#
* [.guihint]#Process mysite checker helpers#
* [.guihint]#Process mysite cmc#
* [.guihint]#Process mysite dcd#
* [.guihint]#Process mysite event console#
* [.guihint]#Process mysite fetcher helpers#
* [.guihint]#Process mysite jaeger#
* [.guihint]#Process mysite livestatus proxy#
* [.guihint]#Process mysite notification spooler#
* [.guihint]#Process mysite notify helper#
* [.guihint]#Process mysite piggyback hub#
* [.guihint]#Process mysite rabbitmq#
* [.guihint]#Process mysite real-time helper#
* [.guihint]#Process mysite redis-server#
* [.guihint]#Process mysite rrd helper#
* [.guihint]#Process mysite rrdcached#
// ES: In meiner Site (CCE 2.4.0p12) werden die Services jaeger, piggyback hub, rabbitmq, real-time helper nicht gefunden, obwohl alle 20 Regeln aktiv sind.
// Einige der aufgelisteten Services erscheinen in der Ausgabe für `omd status mysite`, andere fehlen.
// Ich halte es für wichtig, die Arbeit hier mit der Arbeit an KNW-1934 (ML) zu koordinieren, um entweder einen gemeinsamen Artikel anzulegen oder klar aufzuteilen, welche Informationen wo zu finden sein werden (und entsprechend querzuverweisen).
// Ich wünsche mir z.B. nach dieser Liste einen Hinweis, wo ich erfahren kann, was die einzelnen Services denn tun und wie ich sie starten und stoppen kann (also die Services selbst, nicht ihre Überwachung in CMK).
// Außerdem möchte ich verstehen, ob jeder der 20 Services in jeder Checkmk-Site gefunden wird oder ob das Entdecken der einzelnen Services von äußeren Faktoren beeinflusst wird.


Die Services werden nach Instanzen gruppiert ausgegeben.
// ES: Was bedeutet das, nach Instanzen gruppiert? Sie enthalten ja den Instanznamen im Servicenamen selbst. Wenn der volle Name in der Liste oben ergänzt wird (siehe Änderungen oben), ist dieser Hinweis vermutlich nicht mehr nötig.
Jede Regel, die Sie nicht benötigen, können Sie sowohl deaktivieren als auch löschen.
Wir empfehlen, nicht benötigte Regeln zu deaktivieren, insbesondere, wenn Sie keine der Regeln nutzen wollen.
Denn wenn Sie alle Regeln löschen -- anstatt sie nur zu deaktivieren -- , dann werden beim nächsten Einspielen eines {CMK}-Patches alle Regeln erneut erstellt.
(Die Regeln sind ja Standardbestandteil von {CMK}.)
// ES: Ich würde den Einschub hier drüber entweder löschen oder die Klammern entfernen
Was sie nun mit diesen Services anfangen können, lesen Sie im Artikel xref:wato_services#[Services verstehen und konfigurieren.]


== Selbstüberwachung des Systems (Plugins)

Auch im link:https://checkmk.com/integrations[{CMK} Plugins-Katalog] gibt es diverse Möglichkeiten zur Selbstüberwachung Ihres Systems:

// ES: In der verlinkten Plugin-Übersicht erscheinen die einzelnen Plugins nicht mit ihrem Kurznamen, sondern mit einer natürlichsprachlichen Bezeichnung. Ich fände es hilfreich, beide Namen in der Tabelle aufzuführen. Um horizontalen Platz zu sparen, könntest du überlegen, ob du in der ersten Spalte jeweils in einer Zeile den kurzen Namen angibst und in einer zweiten Zeile den lesbareren Namen (oder umgekehrt).
// Zum Beispiel heißt bi_aggregation in der Liste "Checkmk: State of BI Aggregation"

// ES: In der Tabelle mit Plugins erscheinen auch Themen, die eigentlich schon von den Standard-Services in Abschnitt 2 abgedeckt sind. Zum Beispiel scheinen [.guihint]#Process mysite notification spooler# und das Plugin mknotifyd deckungsgleich zu sein. mknotifyd läuft bei mir auch in der Site (laut der Ausgabe von `omd status mysite`), ohne dass ich mir ein Plugin explizit geladen hätte.
// Zum Verständnis wäre es hilfreich, im Text zu benennen, wie die Auswahl in der Tabelle zustande gekommen ist. Und bei inhaltlichen Überschneidungen würde ich das entsprechende Plugin gern entweder gar nicht sehen oder mit einem deutlichen Hinweis, dass ich es nicht brauche, weil die dazu passende Regel zur Process Discovery das Thema schon ausreichend abdeckt.

// ES: Für die Plugins, die am Ende in der Tabelle übrig bleiben, fände ich es hilfreich, zu den relevanten Handbuchartikeln zu verlinken. Beispielhaft habe ich das für Livestatus umgesetzt.

[cols=4,options="header"]
|====
|Name | Funktion | Parameter | Ausgabe
|bi_aggregation |Gibt den Status einer BI-Aggregation aus. Zeigt auch an, ob sich die Aggregation derzeit in einer Wartungszeit befindet oder quittiert wurde. |Name der Aggregation |ein Service pro BI-Aggregation
|bi_aggregation_connection |Status-Informationen zum Spezialagenten agent_bi. Beinhaltet Verbindungsfehler, fehlende Instanz-Daten und fehlende Aggregationen aufgrund fehlender Daten. | n/a |ein Service pro Verbindung
|check-mk |Ruft Statusinformationen aus den konfigurierten Datenquellen ab, z.B. von konfigurierten Agenten, Spezialagenten, SNMP, Piggyback-Daten und Management-Boards. Der von den Ergebnissen abhängige Gesamtstatus des Services kann mit dem Regelsatz [.guihint]#Status of the {CMK} services# konfiguriert werden. Aktualisiert auch alle passiven Services und eventuelle Piggyback-Daten des Hosts. |n/a |n/a
|check-mk-inventory |Wird auf neuen Instanzen automatisch erstellt. Geht automatisch auf {WARN}, sobald sich ein Service der Host-Merkmale ändert. Eine Konfiguration ist über den Regelsatz [.guihint]#Periodic service discovery# möglich. Hier kann auch ein automatisches Update der {CMK}-Konfiguration mit den gefundenen Services aktiviert werden. |n/a |ein Service für jeden Host, der diesen Check unterstützt
|checkmk_agent |Stellt die ordnungsgemäße Funktion des {CMK}-Agent-Bereitstellungsmechanismus (falls verwendet) sicher. Überprüft den Zeitpunkt der letzten erfolgreichen Verbindung zum Bereitstellungsserver und das Vorliegen von Fehlermeldungen, zeigt die Anzahl der bereitgestellten Agent-Plugins und lokalen Checks. Weitere Einstellungen sind möglich, siehe link:https://checkmk.com/integrations/checkmk_agent[Plugin-Beschreibung] |n/a |ein Service
|cmk_site_statistics | Überwacht die Anzahl der Hosts und Services von {CMK}-Standorten, meldet die Gesamtzahl der Hosts, die Anzahl der Hosts, die nicht {UP} sind, sowie die Anzahl der Hosts, die {UP}, {DOWN}, in Wartungszeit und {UNREACH} sind. Meldet die Gesamtzahl der Services, die Anzahl der Services, die nicht {OK} sind, sowie die Anzahl der Services, die {OK} sind, sich in Wartungszeit befinden, auf ausgefallenen Hosts laufen, {WARN}, {UNKNOWN} und {CRIT} sind. Der Check ist immer {OK} und nicht vom Benutzer konfigurierbar. |Name der {CMK}-Instanz |ein Service pro laufender {CMK}-Instanz auf einem {CMK}-Server
|livestatus_status |Erhält über xref:livestatus#[Livestatus] verschiedene Performance-Daten eines OMD Monitoring-Kerns. Gibt damit Auskunft über die Leistung des Kerns, die Anzahl der pro Sekunde ausgeführten Checks usw. Stellt fest, ob bestimmte Einstellungen deaktiviert wurden (z. B. Benachrichtigungen). Zustände können über Prüfparameter konfiguriert werden. |Name der OMD-Instanz |ein Service pro laufender OMD-Instanz.
|mkbackup |Prüft den Status von Backup-Aufträgen auf einer {CMK} Appliance. Meldet {CRIT}, wenn der Auftrag fehlschlägt oder seine nächste Ausführung überfällig ist. |ID des Auftrags |ein Service pro Backup-Auftrag
|mkbackup_site |Prüft den Status der Backup-Aufträge einer {CMK}-Instanz. Meldet {CRIT}, wenn der Auftrag fehlschlägt oder seine nächste Ausführung überfällig ist. |ID der Instanz, gefolgt von `{{backup}}`` und der ID des Auftrags |ein Service pro Instanz und Backup-Auftrag
|mkeventd_status |Erhält diverse Performancewerte von einer {CMK} Event Console Instanz. Warnung bei aktiven Ereignislimits, Aufzeichnung von Performance-Metriken bzgl. der Event Console. |Name der {CMK}-Instanz |ein Service pro laufender {CMK}-Instanz
// ES: Findest du eine elegante Umformulierung für "{CMK} Event Console Instanz"?
|mknotifyd_connection_v2 |Prüft den Status einzelner TCP-Verbindungen vom {CMK} Notification Spooler zu einem Remote Spooler. Für jede ein- und ausgehende TCP-Verbindung wird ein Service erstellt. Der Status geht auf {CRIT}, wenn die Verbindung nicht aufgebaut ist. |Name der Instanz, gefolgt vom Namen der verbundenen Remote-Instanz, getrennt durch einen Strich. Gibt es mehr als eine eingehende Verbindung vom gleichen Remote-Host, wird ein Index angehängt. |ein Service pro Instanz und Verbindung
|mknotifyd |Prüft den Status des {CMK} Notification Spooler. {WARN}, wenn zurückgestellte Spool-Dateien zu lange liegen bleiben oder beschädigte Spool-Dateien gefunden werden. {CRIT}, wenn Spooler nicht läuft. |Name der Instanz | ein Service pro Instanz
|omd_apache |Erstellt Statistiken über die Anfragen, die vom Apache-Webserver auf OMD-Instanzen bearbeitet werden, zeichnet die Anzahl der Anfragen, die gesendeten Bytes und die für die Bearbeitung der Anfragen benötigte Zeit auf -- gruppiert nach Art der Anfrage, z. B. {CMK}-Tabellenansichten, NagVis-AJAX-Aufrufe, aber auch nach Typ, z. B. für Bilder, Stylesheets usw. Der Check verwendet eine bestimmte Logdatei, die sich unter `var/log/apache/stats` befinden muss, um die Zugriffsstatistiken zu erfassen. Diese Datei wird bei jeder Überprüfung gekürzt. |Name der Instanz |ein Service pro Instanz
// ES: Der Text zu omd_apache ist schwer zu lesen. Sätze aufteilen oder anderweitig kürzen?
// Außerdem: Ist omd_apache analog zu omd_broker_queues und cmk_site_statistics immer {OK}?
|omd_broker_queues |Überwacht die Anzahl der Benachrichtigungen in Broker-Warteschlangen jeder Instanz-Applikation. Service-Name enthält die Instanz und den Applikationsnamen. Der Check ist immer {OK}. |Instanz und Applikationsname |ein Service pro Instanz-Applikation
|omd_broker_status |Überwacht den allgemeinen Status des Message Brokers auf jeder Instanz. Zeigt den vom Broker belegten Speicher, die Zahl der Warteschlangen und die Zahl der Shovels im Status _running_. Der Check ist immer {OK}. |Name der Instanz |ein Service pro Instanz, auf der ein Broker installiert ist und läuft
|omd_diskusage |Überwacht die Festplattenauslastung einer Instanz, um bei Bedarf die Suche nach Anomalien zu erleichtern. Eine Liste der aktuell überwachten Verzeichnisse finden Sie in der link:https://checkmk.com/integrations/omd_diskusage[Plugin-Beschreibung.] |Name der Instanz |ein Service pro Instanz
|omd_status |Prüft den Status der OMD-Instanzen, die auf dem System gefunden wurden, mithilfe von `omd status --bare --auto`. Wenn alle Services laufen, ist die Instanz {OK}, andernfalls {CRIT}. Wenn die Instanz nur teilweise läuft, enthält die Check-Ausgabe die Namen der gestoppten Services. In geclusterten Umgebungen listet der Check alle Knoten, auf denen Instanzen laufen, sowie deren Status auf. Der Gesamtstatus des Services ist {CRIT}, wenn eine Instanz auf einem Knoten nur partiell läuft oder alle Instanzen auf allen Knoten gestoppt sind. | Name der Instanz |ein Service je Instanz, auf der die Option [.guihint]#Autostart# auf ON gesetzt ist, unabhängig vom aktuellen Instanz-Status
|site_object_counts |Sammelt Informationen über die Anzahl unterschiedlicher Host-Typen oder genutzter Check-Kommandos auf den {CMK}-Instanzen. Einstellung und Funktionalität des Checks sind umfangreich, weitere Informationen hierzu finden Sie in der link:https://checkmk.com/integrations/site_object_counts[Plugin-Beschreibung.] Der Check ist immer im Status {OK}. |n/a |ein Service

|====

// ES: Bitte überall in der Tabelle korrigieren, wo beim Übersetzen versehentlich "Checks" zu "Prüfungen", "Überprüfungen", "Prüfparametern" o.ä. wurden. Möglicherweise sind noch weitere Anpassungen ans Dictionary nötig.

