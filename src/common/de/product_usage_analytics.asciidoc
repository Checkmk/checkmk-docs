// -*- coding: utf-8 -*-
// IGNORE umentscheiden
include::global_attr.adoc[]

= Analyse der Produktnutzung
:title: Analyse der Produktnutzung
:description: Wenn Sie die Übermittlung von Daten über Ihre Produktnutzung an die {comfull} aktivieren, unterstützen Sie damit die stetige Verbesserung des Produkts. 


[#intro]
== Einleitung

{CMK} bietet eine Vielzahl von Features, die kontinuierlich xref:cmk_versions.html[weiterentwickelt und verbessert] werden.
Für die Entwicklungsarbeit an der Software birgt Ihr Nutzungsverhalten wertvolle Informationen:
Welche Features nutzen Sie oft?
Wie viele Objekte überwachen Sie?
Mit wie vielen Ordnern organisieren Sie Ihre Hosts?
ifdef::onprem[]
Nutzen Sie das Grafana-Plugin, und falls ja, in welcher Version?
endif::[]

Diese und ähnliche Informationen über Ihre Nutzung von {CMK} können uns helfen, die wichtigsten Features bei der Entwicklung höher zu priorisieren.
Abkündigungen von Features können vermieden werden, wenn aus den Nutzungsdaten ersichtlich ist, dass die Features weiterhin gefragt sind.

ifdef::onprem[]
Ab Version {v25} kann {CMK} Daten über Ihre Produktnutzung automatisch in regelmäßigen Abständen an die {comfull} übermitteln.
Für die vorigen Versionen ist diese Funktion ab 2.4.0p99999 und ab 2.3.0p99999 vorhanden.
// ES: Genaue Patchversionen hier nachtragen, sobald bekannt
Ohne Ihr Zutun werden zunächst keinerlei Nutzungsdaten übertragen -- als Admin von {CMK}-Instanzen entscheiden Sie selbst, ob Sie diese Datenübermittlung aktivieren, um die Weiterentwicklung der Software auf diese Weise mit zu beeinflussen.
endif::[]
ifdef::saas[]
{CE} übermittelt Daten über Ihre Produktnutzung automatisch in regelmäßigen Abständen an die {comfull}.
endif::[]


ifdef::onprem[]
[#consent]
== Datenübermittlung erlauben oder ablehnen

{CMK} wird Sie selbständig dazu auffordern, eine Entscheidung zur Übermittlung von Nutzungsdaten zu treffen.
Ein Dialog dazu wird Ihnen 30 Tage nach dem Update auf eine entsprechende Version beziehungsweise 30 Tage nach dem Anlegen einer neuen Instanz mit einer entsprechenden Version in der GUI angezeigt.
// ES: Hilfe, Bandwurmsatz

[#settings_gui]
=== Einstellungen in der GUI

Die Entscheidung über die Übermittlung von Nutzungsdaten obliegt denjenigen Benutzern Ihrer Instanz, die Administratorrechte haben.
Sobald ein solcher Benutzer sich nach Ablauf von 30 Tagen in der Weboberfläche Ihrer {CMK}-Instanz anmeldet, erscheint ein Pop-up zur Analyse der Produktnutzungsdaten.

.Pop-up zur Einwilligung oder Ablehnung der Übermittlung von Produktnutzungsdaten an die {comfull}
image::product_usage_analytics_popup.png[alt="Das Pop-up zur Analyse der Produktnutzungsdaten erscheint beim Einloggen nach 30 Tagen.",fullscreen=1]
// ES: finalen Screenshot einfügen

Falls Sie die Option [.guihint]#Ask me later# wählen, wird Ihre Instanz weiterhin keinerlei Nutzungsdaten erheben und übermitteln.
Das Pop-up wird bei jedem folgenden Admin-Login angezeigt, bis Sie eine Entscheidung getroffen haben.

Die Option [.guihint]#Enable in global settings# führt Sie zur Seite für die Einstellung Ihrer Entscheidung zur Übermittlung der Produktnutzungsdaten.
// ES: Guihint korrigieren, sobald final
Hier stehen Ihnen drei Möglichkeiten zur Verfügung.
Vorausgewählt ist die Option [.guihint]#Disabled. Reminder scheduled#.

// ES: Ist das ohne zusätzlichen Screenshot der Einstellungsseite nachvollziehbar? (Sonst füge ich nach Fertigstellung der Funktion doch noch einen ein)

Um die Übermittlung von Nutzungsdaten zu aktivieren, wählen Sie die Option [.guihint]#Allow collection and transmission of product usage data#.
Sie können dann noch Details zum [.guihint]#HTTP proxy# hinterlegen, der verwendet werden soll.
Diese Informationen werden benötigt, falls von Ihrem {CMK}-Server aus keine direkte Verbindung ins Internet möglich oder gewünscht ist.

Selbstverständlich können Sie die Übermittlung auch ablehnen.
In diesem Fall sind keine weiteren Einstellungen notwendig.
Nachdem Sie die Option [.guihint]#Do not collect and transmit product usage data# ausgewählt haben, werden Sie keine weiteren Aufforderungen zum Übermitteln von Daten erhalten.

Über [.guihint]#Setup > Global settings > Product usage analytics# erreichen Sie jederzeit die Einstellung für Ihre Zustimmung oder Ablehnung, falls Sie sich später umentscheiden sollten.


=== Einstellungen in Ihrer Systemumgebung

Möglicherweise sind noch zusätzliche Einstellungen in Ihrer Systemumgebung nötig, bevor die Daten an die {comfull} gesendet werden können.
Erlauben Sie ausgehende https-Verbindungen von Port 443 Ihres {CMK}-Servers zu `\https://analytics.checkmk.com/upload` beziehungsweise zur IP-Adresse `10.10.10.10`.
// ES: alles hier korrigieren, sobald endgültige Informationen bereitgestellt wurden
// ES: finale Infos auch in ports.asciidoc nachtragen

endif::[]

[#usage_data]
== Ihre Nutzungsdaten
ifdef::onprem[]
Damit Sie entscheiden können, ob Sie mit der Übermittlung von Nutzungsdaten einverstanden sind, geben wir Ihnen hier einen Überblick darüber, welche Nutzungsdaten gemeint sind und wie sie gesammelt und verarbeitet werden.
endif::[]
ifdef::saas[]
Hier geben wir Ihnen einen Überblick darüber, welche Nutzungsdaten gesammelt werden und wie sie übermittelt und ausgewertet werden.
endif::[]

[#manifest]
=== Welche Daten werden übermittelt?

Selbstverständlich werden nur allgemeine Daten über Ihre Produktnutzung gesammelt und übermittelt.
Sensible Daten über die Benutzer Ihrer Instanz oder Details über Ihre IT-Infrastruktur werden weder erhoben noch an {com} gesendet.
// ES: Hier bitte besonders kritisch lesen: Gelten Namen von Check-Plugins als "Details über Ihre Infrastruktur"?
Einen vollständigen Überblick über die Daten, die gesammelt werden, erhalten Sie im _Product usage analytics manifest_.
// ES: verlinken, sobald vorhanden
Einen Link zu diesem Dokument finden Sie auch im [.guihint]#Help#-Menü in Ihrer {CMK}-Instanz.
// ES: Satz finalisieren abhängig davon, ob der Link im Produkt tatsächlich vorhanden ist

ifdef::onprem[]
Ihre Nutzungsdaten werden in Form eines JSON-Objekts dargestellt.

Um zu erfahren, welche Daten Ihre Instanz zum aktuellen Zeitpunkt übermitteln würde, können Sie als xref:omd_basics#site_user[Instanzbenutzer] den Befehl `cmk-product-usage --dry-run` ausführen.
// ES: sicherstellen, ob der Befehl weiterhin so heißt oder umbenannt wurde
Zum jederzeit aktuellen JSON-Datensatz gelangen Sie alternativ auch mit einem Klick auf [.guihint]#Download the full JSON report# auf der xref:#settings_gui[Einstellungsseite] für die Übermittlung der Produktnutzungsdaten.

In der folgenden Beispielausgabe wurde das JSON-Objekt aus Gründen der Lesbarkeit gekürzt.

[{shell}]
----
{c-omd} cmk-product-usage --dry-run
{
    "id": "2f1a0be7-69bd-44f4-b6af-cdce64136f57",
    "count_hosts": 596,
    "count_services": 11502,
    "count_folders": 35,
    "edition": "ultimate",
    "cmk_version": "2.5.0-2026.02.07",
    "timestamp": 1770628100,
    "checks": {
        "check-mk": {
            "count": 593,
            "count_hosts": 593,
            "count_disabled": 0
        },
        "check_mk-uptime": {
            "count": 286,
            "count_hosts": 286,
            "count_disabled": 0
        },
        // ... weitere Checks nach dem gleichen Muster...
        "check_mk-liebert_chilled_water": {
            "count": 9,
            "count_hosts": 3,
            "count_disabled": 0
        },
        // ... und noch mehr Checks...
    },
    "grafana": null
}
----
// ES: Vor Veröffentlichung aktualisieren, sinnvolle cmk_version einfügen

Wie Sie in der Beispielausgabe sehen, werden vor allem quantitative Daten gesammelt.
Anhand der enthaltenen Check-Namen kann die {comfull} auswerten, welche Check-Plugins wie viel genutzt werden.
Auch Plugins, die Sie xref:devel_check_plugins#[selbst geschrieben] oder aus der link:https://exchange.checkmk.com/[{CMK} Exchange^] bezogen haben, werden hier aufgelistet.

Der Befehl `cmk-product-usage --dry-run` führt im Hintergrund alle Aktionen zum Sammeln der Daten aus, sendet aber keine Daten nach außen.
// ES: auch hier Befehl updaten, falls er sich geändert hat
Er dient allein zu Ihrer Information.
Sie können ihn jederzeit ausführen, unabhängig von Ihren Einstellungen für die Analyse der Produktnutzung.
Übrigens wird die Sammlung von Nutzungsdaten mithilfe einer Reihe von xref:livestatus#[Livestatus-Abfragen] umgesetzt.
endif::[]


[#processing]
=== Was passiert mit den Daten?

ifdef::onprem[]
Falls Sie sich entschieden haben, Ihre Produktnutzungsdaten an die {comfull} übermitteln zu lassen, läuft ab jetzt alles im Hintergrund.
Es ist vorstellbar, dass dabei gelegentlich Probleme auftauchen, zum Beispiel wenn Ihr Server zum Zeitpunkt der Übermittlung nicht in der Lage ist, eine Verbindung zum Server der {comfull} aufzubauen.
In diesem Fall schlägt der Vorgang fehl, ohne dass Sie darüber informiert werden.
Sie können als Instanzbenutzer in der Logdatei unter `~/var/log/product_usage_analytics.log` nachsehen, zu welchen Zeitpunkten die Übermittlung stattgefunden hat und ob sie erfolgreich war.
// ES: ändern, wenn die Logdatei anders benannt ist
endif::[]
ifdef::saas[]
Die Sammlung und Übertragung Ihrer Produktnutzungsdaten läuft vollständig im Hintergrund ab.
endif::[]


[#transmission]
==== Übermittlung an die {comfull}

ifdef::onprem[]
Zu einem zufälligen Zeitpunkt in den ersten 30 Tagen nach dem Erteilen Ihrer Zustimmung wird der erste Datensatz zusammengestellt und versendet.
Ab diesem Zeitpunkt wird die Sammlung und Übermittlung immer im Abstand von 30 Tagen wieder ausgeführt.

Ihre Instanz übermittelt die gesammelten Daten mit einer verschlüsselten POST-Anfrage von Port 443 Ihres {CMK}-Servers via https an `\https://analytics.checkmk.com/upload` beziehungsweise an die IP-Adresse `10.10.10.10`.
// ES: korrigieren, nachdem endgültige Infos hierüber bereitgestellt wurden
endif::[]
ifdef::saas[]
Ihre Nutzungsdaten werden jeweils im Abstand von 30 Tagen gesammelt und übermittelt.
Die erste Übermittlung findet zu einem zufälligen Zeitpunkt innerhalb der ersten 30 Tage nach dem Anlegen Ihrer Instanz statt.
endif::[]


[#storage_and_analysis]
==== Speicherung und Auswertung

ifdef::onprem[]
Unabhängig davon, wo Sie Ihre {CMK}-Instanz betreiben, werden Ihre Nutzungsdaten immer an einen Server der {comfull} in der AWS-Region Europe (Frankfurt) übermittelt (`eu-central-1`).
endif::[]
ifdef::saas[]
Ihre Nutzungsdaten werden immer an einen Server der {comfull} in der AWS-Region Europe (Frankfurt) übermittelt (`eu-central-1`).
endif::[]
Die Datensätze, die Ihre Instanz an diesen Server schickt, werden nicht mit Ihren persönlichen Daten verknüpft.
Sie werden anonym ausgewertet.

// ES: brauche hier noch einen Satz zur Speicherdauer, warte dazu auf Infos

ifdef::onprem[]
[#distributed]
== Nutzungsdaten übermitteln im verteilten Monitoring
Auch im verteilten Monitoring können Daten über die Produktnutzung gesammelt und übermittelt werden.

=== Zentrale Instanz und Remote-Instanzen konfigurieren

Die Aufforderung zum Erlauben oder Ablehnen wird nur auf der zentralen Instanz angezeigt.
Hier können Sie die gewünschte Einstellung festlegen wie im Abschnitt xref:#consent[Datenübermittlung erlauben oder ablehnen] beschrieben.

Für jede Remote-Instanz haben Sie beim xref:distributed_monitoring#connect_remote_sites[Einrichten des verteilten Monitoring] festgelegt, ob die Konfiguration der zentralen Instanz auf die jeweilige Remote-Instanz repliziert werden soll.
Die Einstellung hierfür finden Sie in den Eigenschaften der Remote-Instanz unter [.guihint]#Setup > General > Distributed monitoring#.
Von dieser Option hängt das Verhalten der Instanzen im verteilten Monitoring in Bezug auf die Übermittlung von Produktnutzungsdaten ab:

* Haben Sie für eine Remote-Instanz die Option [.guihint]#Enable replication# auf den Wert [.guihint]#Push configuration to this site# gesetzt, werden Ihre Einstellungen zur Übermittlung der Produktnutzungsdaten automatisch für diese Instanz übernommen.
* Haben Sie die Replikation der Konfiguration für eine Remote-Instanz deaktiviert ([.guihint]#No replication with this site#), wird auch Ihre Entscheidung zur Übermittlung von Nutzungsdaten nicht auf die Remote-Instanz übertragen.
* Sie können selbstverständlich jederzeit aktiv die Einstellung zur Datenübermittlung für jede Remote-Instanz individuell ändern, indem Sie unter [.guihint]#Setup > General > Distributed monitoring# auf die [.guihint]#Site specific global settings# für die jeweilige Instanz zugreifen.

=== Übermittlungsverhalten von zentraler Instanz und Remote-Instanzen

Falls Sie sich in einem Szenario mit verteiltem Monitoring entscheiden, Produktnutzungsdaten an die {comfull} übermitteln zu lassen, werden Ihre Instanzen sich folgendermaßen verhalten:

* Jede Remote-Instanz mit aktivierter Übermittlung der Produktnutzungsdaten wird ihre eigenen Nutzungsdaten sammeln und diese auch eigenständig direkt an die {comfull} übermitteln.
* Die zentrale Instanz wird ausschließlich ihre eigenen Nutzungsdaten sammeln und diese direkt an die {comfull} übermitteln.
* Jede Instanz mit aktivierter Übermittlung der Produktnutzungsdaten übermittelt genau die Daten, die im Abschnitt zum xref:#manifest[_Product usage analytics manifest_] beschrieben werden.
* Auf jeder Instanz mit aktivierter Übermittlung der Produktnutzungsdaten wird die Logdatei `~/var/log/telemetry.log` angelegt.

=== Konfiguration in {ME}

Das Verhalten von Instanzen in {ME} in Bezug auf die Übermittlung von Produktnutzungsdaten ist analog zum beschriebenen Verhalten im verteilten Monitoring.
endif::[]