// -*- coding: utf-8 -*-
include::global_attr.adoc[]
= Benachrichtigungen per Slack
:revdate: 2020-08-14
:title: Benachrichtigungen per Slack (notifications)
:description: Sie können Benachrichtigungen von {CMK} an den Instant-Messaging-Dienst Slack senden lassen. Wie Sie die Anbindung durchführen, erfahren Sie hier.

{related-start}
xref:notifications#[Benachrichtigungen]
{related-end}


Über den Messenger link:https://slack.com/[Slack^] können Sie Benachrichtigungen einfach über einen Webhook empfangen.
Das funktioniert sowohl auf selbst gehosteten oder gemieteten Servern, als auch über den kostenlosen öffentlichen Slack-Dienst.


[#config_slack]
== Slack konfigurieren

Um Webhooks zu aktivieren und einen neuen Webhook zu erstellen, müssen Sie zunächst eine Slack App erstellen.
Melden Sie sich bei Slack an und erstellen Sie einen _Workspace._
Gehen Sie dann wie folgt vor:

. Erstellen Sie über link:https://api.slack.com/messaging/webhooks[diesen Link^] eine neue App über die Slack-API.
. Vergeben Sie einen beliebigen Namen und wählen Sie Ihren Workspace.
. Im nächsten Dialog wählen Sie als Funktion der App [.guihint]#Incoming Webhook.#
. Aktivieren Sie anschließend Webhooks, indem Sie den Schalter auf [.guihint]#on# setzen.
. Erstellen Sie den Webhook über den Knopf [.guihint]#Add New Webhook to Workspace.#
. Legen Sie zum Abschluss den Channel (Gruppe) fest, in den die App senden soll, und bestätigen Sie die Rechteanfrage.

Zum Testen bekommen Sie nach Abschluss eine `curl`-Anweisung, die _Hello World_ in den gewünschten Channel sendet.
Kopieren Sie die Webhook-URL und wechseln Sie zu {CMK}.


[#config_checkmk]
== {CMK} konfigurieren

Wie Sie Benachrichtigungen im Allgemeinen in {CMK} einrichten, haben Sie bereits im Artikel über xref:notifications#[Benachrichtigungen] erfahren.

In {CMK} genügt es nun, die oben kopierte URL anzugeben:

. Erstellen Sie eine neue Benachrichtigungsregel mit [.guihint]#Setup > Events >  Notifications > Add rule.#
. Wählen Sie als [.guihint]#Notification Method# den Eintrag [.guihint]#Slack or Mattermost.#
. Geben Sie die kopierte Webhook-URL ein:
+
image::notifications_slack.png[alt="Die Einstellungen zur Benachrichtigungsmethode für Slack und Mattermost."]
+
Statt die URL hier direkt einzugeben, können Sie diese auch aus dem xref:password_store#[Passwortspeicher] auslesen -- sofern sie vorher dort hinterlegt wurde.

Optional dürfen Sie URL-Präfixe angeben, um Links auf Ihre {CMK}-GUI innerhalb der Benachrichtigung zu steuern.

Bei der Kontaktauswahl im folgenden Kasten [.guihint]#Contact selection# beachten Sie die folgenden beiden Punkte:

include::include_ticketsystem.asciidoc[]

Mit der neuen Funktion xref:notifications#notification_testing[Test notifications] können Sie überprüfen, ob Ihre neue Benachrichtigungsregel für bestimmte Hosts und Services zutrifft.

Um Test-Benachrichtigungen über diese Benachrichtigungsmethode auch tatsächlich zu versenden, müssen Sie in {CMK} {v23} weiterhin xref:notifications#fake_check_results[Fake check results] verwenden.
