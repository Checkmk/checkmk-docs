// -*- coding: utf-8 -*-
// IGNORE
// NONASCII
include::global_attr.adoc[]
= Product usage analytics
:title: Product usage analytics
:description: By enabling the transmission of data about your product usage to {comfull}, you are supporting the continuous improvement of the product. 


[#intro]
== Introduction

{CMK} offers a wide range of features that are continuously being developed and improved.
How you use {CMK} in your daily work provides us with valuable information for planning and developing the next versions of {CMK}:
Which features do you use regularly?
How many objects do you monitor?
How many folders do you use to organize your hosts?
ifdef::onprem[]
Do you use the Grafana plug-in, and if so, which version?
endif::[]

This and similar information about your use of {CMK} can help us prioritize the most important features during development.
Feature discontinuations can also be avoided if usage data shows that the features are still in demand.

ifdef::onprem[]
{CMK} can automatically transmit data about your product usage to {comfull} at regular intervals.
// This feature is available in versions {v25}, 2.4.0p99999 and above, and 2.3.0p99999 and above.
This feature is available in version {v25} and in a patch update that will be released soon for {v24} and {v23}.

No usage data will be transmitted without your active consent—as a {CMK} xref:wato_user#predefined_roles[administrator], you decide for yourself whether to activate this data transmission in order to influence the further development of the software in this way.
endif::[]
ifdef::saas[]
{CE} automatically transmits data about your product usage to {comfull} at regular intervals.
endif::[]

ifdef::onprem[]
This article describes how you can decline or activate the transmission of product usage data in your {CMK} site.
For an overview of the type of data that will be collected when usage data transmission is active, have a look at the link:https://checkmk.com/product-usage-analytics/manifest[_product usage analytics manifest_^].
endif::[]
ifdef::saas[]
For an overview of the type of data that will be collected, have a look at the link:https://checkmk.com/product-usage-analytics/manifest[_product usage analytics manifest_^].
endif::[]


ifdef::onprem[]
[#consent]
== Allow or deny usage data transmission

{CMK} will automatically ask you if you want to provide data for product usage analytics.
// A modal dialog box will appear in the GUI after 30 days on a {CMK} version that includes this functionality ({v25}, 2.4.0p99999, or 2.3.0p99999).
A modal dialog box will appear in the GUI after 30 days on a {CMK} version that includes this functionality.


[#settings_gui]
=== Settings in the GUI

The decision to transmit usage data is up to those users of your site who have administrator rights.
As soon as an administrator logs into the web interface of your {CMK} site after the first 30 days, a pop-up about product usage analytics appears.

.Pop-up for transmitting product usage data to {comfull}
image::product_usage_analytics_popup.png[alt=“The pop-up for analyzing product usage data appears when logging in after 30 days.”,fullscreen=1]

If you select the option [.guihint]#Remind me again in 30 days#, your site will continue to not collect or transmit any usage data.
After another 30 days, the pop-up will appear again.

[#settingspage]
The option [.guihint]#Manage in global settings# takes you to the page where you can manage your decision about transmitting product usage data.
There are three options available here.
The option [.guihint]#Disabled. Reminder scheduled# is preselected.

.Settings for transmitting product usage data
image::product_usage_analytics_settings.png[alt=“In the global settings of your site, you will find the page for configuring the transmission of product usage data”]

To enable the transmission of usage data, select the option [.guihint]#Allow collection and transmission of product usage data#.
You can then enter details about the [.guihint]#HTTP proxy# to be used.
This information is required if a direct connection to the Internet is not possible or desired from your {CMK} server.

You can, of course, decline to transmit data.
In this case, no further settings are necessary.
After selecting the option [.guihint]#Do not collect and transmit product usage data#, you will not receive any further requests to transmit data.

You can access the setting for your consent or refusal at any time via [.guihint]#Setup > Global settings > Product usage analytics# if you change your mind later.


=== Settings in your system environment

Additional settings may be required in your system environment before data can be sent to {comfull}.
Allow outgoing https connections from port 443 of your {CMK} server to `\https://analytics.checkmk.com/upload`.
endif::[]


[#usage_data]
== Your usage data
ifdef::onprem[]
To help you decide whether you agree to the transmission of usage data, we provide you with an overview of what usage data is involved and how it is collected and processed.
endif::[]
ifdef::saas[]
Here we provide an overview of what usage data is collected and how it is transmitted and evaluated.
endif::[]


[#manifest]
=== What data is transmitted?

Primarily, quantitative data relating to your product usage is collected and transmitted.
A complete overview of the data that is collected can be found in the link:https://checkmk.com/product-usage-analytics/manifest[_product usage analytics manifest_^].
// A link to this document can also be found in the [.guihint]#Help# menu in your {CMK} site.

ifdef::onprem[]
Your usage data is displayed and transmitted in the form of a JSON object.

To find out what data your site would transmit at the current time, as xref:omd_basics#site_user[site user] you can execute the `cmk-product-usage --dry-run` command.
Alternatively, you can access the current JSON data set at any time by clicking [.guihint]#Download the full JSON report# on the xref:#settingspage[settings page] for product usage data transmission.

In the following example output, the JSON object has been shortened for readability.

[{shell}]
----
{c-omd} cmk-product-usage --dry-run
{
    "id": "2f1a0be7-69bd-44f4-b6af-cdce64136f57",
    "count_hosts": 596,
    "count_services": 11502,
    "count_folders": 35,
    "edition": "ultimate",
    "cmk_version": "2.5.0p1",
    "timestamp": 1770628100,
    "checks": {
        "check-mk": {
            "count": 593,
            "count_hosts": 593,
            "count_disabled": 0
        },
        "check_mk-uptime": {
            "count": 286,
            "count_hosts": 286,
            "count_disabled": 0
        },
        // ... some additional checks following the same pattern...
        "check_mk-liebert_chilled_water": {
            "count": 9,
            "count_hosts": 3,
            "count_disabled": 0
        },
        // ... and more checks...
    },
    "grafana": null
}
----

Based on the check names contained, {comfull} can evaluate which check plug-ins are used, and how extensively.
Plug-ins that you have written yourself or obtained from link:https://exchange.checkmk.com/[{CMK} Exchange^] are also listed here.

The command `cmk-product-usage --dry-run` performs all actions for collecting data in the background, but does not send any data externally.
It is for your information only.
You can run it at any time, regardless of your settings for product usage analysis.

Incidentally, usage data is collected using a series of xref:livestatus#[livestatus queries].
endif::[]


[#processing]
=== What happens to the data?

ifdef::onprem[]
If you have decided to send your product usage data to {comfull}, everything will now run in the background.
It is conceivable that problems may occasionally arise, for example if your server is unable to connect to the {comfull} server at the time of transmission.
In this case, the process will fail without you being notified.
As a site user, you can refer to the log file at `~/var/log/product_usage_analytics.log` to see when the transmission took place and whether it was successful.
endif::[]
ifdef::saas[]
The collection and transmission of your product usage data runs entirely in the background.
endif::[]


[#transmission]
==== Transmission to {comfull}

ifdef::onprem[]
At a random point in time within the first 30 days after you give your consent, the first data set will be compiled and sent.
From this point on, the collection and transmission will always be repeated at 30-day intervals.

Your site transmits the collected data with an encrypted POST request from port 443 of your {CMK} server via https to `\https://analytics.checkmk.com/upload`.
endif::[]
ifdef::saas[]
Your usage data is collected and transmitted every 30 days.
The first transmission takes place at a random time within the first 30 days after your site is created.
endif::[]


[#storage_and_analysis]
==== Storage 

ifdef::onprem[]
Regardless of where you operate your {CMK} site, your usage data is always transmitted to a {comfull} server in the AWS Europe (Frankfurt) region (`eu-central-1`) and stored there.
endif::[]
ifdef::saas[]
Your usage data is always transmitted to a {comfull} server in the AWS Europe (Frankfurt) region (`eu-central-1`) and stored there.
endif::[]


ifdef::onprem[]
[#distributed]
== Transmitting usage data in distributed monitoring
Data on product usage can also be collected and transmitted in setups with distributed monitoring.


=== Configuring the central and remote sites

The modal dialog box for transmitting product usage data is only displayed on the central site.
Here you can specify the desired setting as described in the section xref:consent[Allow or deny data transmission].
You can control whether or not the individual remote sites transmit usage data.

When xref:distributed_monitoring#connect_remote_sites[setting up distributed monitoring], you specified for each remote site whether the configuration of the central site should be replicated to the respective remote site.
The setting for this can be found in the properties of the remote site under [.guihint]#Setup > General > Distributed monitoring#.
This option determines the behavior of the sites in distributed monitoring with regard to the transmission of product usage data:

* If you have set the option [.guihint]#Enable replication# to the value [.guihint]#Push configuration to this site# for a remote site, this is a xref:glossary#central_setup[distributed monitoring with central setup].
In this case, your settings for transmitting product usage data are automatically applied to this site.
* If you have disabled configuration replication for a remote site ([.guihint]#No replication with this site#), your decision about the transmission of usage data is not transferred to the remote site.
* You can, of course, actively change the data transmission setting for each remote site individually at any time by accessing the [.guihint]#Site specific global settings# for the respective site under [.guihint]#Setup > General > Distributed monitoring#.


=== Transmission behavior of central and remote sites

If in a distributed monitoring scenario you decide to transmit product usage data to {comfull}, your sites will behave as follows:

* Each remote site with enabled product usage data transmission will collect its own usage data and independently transmit it directly to {comfull}.
* The central site will only collect its own usage data and transmit it directly to {comfull}.
* Each site with enabled product usage data transmission will transmit exactly the data as described in the section on xref:#manifest[_Product usage analytics manifest_].
* The log file `~/var/log/product_usage_analytics.log` will be created on each site with enabled product usage data transmission.


[#multi_tenancy]
=== Configuration in {ME}

The behavior regarding  the transmission of product usage data  of sites in {ME} is analogous to the behavior as described in distributed monitoring.
endif::[]