// -*- coding: utf-8 -*-
// IGNORE 
// NONASCII
include::global_attr.adoc[]
= Certificate overview in {CMK}
:title: Certificate overview in {CMK}
:description: The Certificate overview page in the Checkmk GUI lists the internal certificates. Read here which information you can retrieve from this page.
:keywords: certificate, CA

{related-start}
ifdef::onprem[]
xref:omd_https#[Securing the web interface with HTTPS]
xref:distributed_monitoring#[Distributed monitoring]
endif::[]
xref:security#[Security]
{related-end}

[TIP]
====
This article is currently being prepared for publication. +
Please be patient. Thank you! +
By the way, the https://docs.checkmk.com/master/de/certificates.html[German version] of this article has already been updated – if that is an option for you.
====

// start translation for AH
////
[#intro]
== Einleitung

ifdef::onprem[]
Zertifikate gewährleisten den sicheren Betrieb Ihres Monitoring: Für die ein- und ausgehende Kommunikation in Ihrer {CMK}-Umgebung bestätigen sie die Vertrauenswürdigkeit der verwendeten Schlüssel, zum Beispiel zwischen den xref:glossar#agent[Agenten] und Ihrer xref:glossar#site[{CMK}-Instanz] oder im xref:distributed_monitoring#[verteilten Monitoring] bei der Kommunikation zwischen Zentralinstanz und Remote-Instanzen.
endif::[]

ifdef::saas[]
Zertifikate gewährleisten den sicheren Betrieb Ihres Monitoring: Für die ein- und ausgehende Kommunikation in Ihrer {CMK}-Umgebung bestätigen sie die Vertrauenswürdigkeit der verwendeten Schlüssel, zum Beispiel zwischen den xref:glossar#agent[Agenten] und Ihrer xref:glossar#site[{CMK}-Instanz].
endif::[]

Bei {CMK} sind Zertifikate im PEM-Format hinterlegt – auch für die {CMK}-seitigen Certificate Authorities (CA), die sich mit je einem CA-Zertifikat jeweils die eigene Vertrauenswürdigkeit attestieren.
PEM steht für Privacy-Enhanced Mail und ist ein einfach handhabbares Textdateiformat zum Aufbewahren und Teilen kryptografischer Schlüssel, Zertifikate und Anfragen. 
Dateien im PEM-Format sind Klartextdateien und lassen sich als solche per Texteditor leicht einsehen und bearbeiten.

{CMK} stattet Ihre {CMK}-Instanzen mit eigenen Certificate Authorities und Zertifikaten aus, die für den Betrieb und für die Kommunikation zwischen den Komponenten eines {CMK}-Setups (etwa zwischen den Agenten und der Instanz) unerlässlich sind.
Die von einer CA ausgegebenen Zertifikate werden "CA-Zertifikate" genannt. 
CA-Zertifikate dienen als digitaler Ausweis für verschlüsselte Kommunikation: 
Sie erben das Vertrauen von ihrer CA und geben es weiter in einer _Chain of Trust_ (zu Deutsch: Vertrauens- beziehungsweise Zertifikatskette).

.[#certificates]#Wie Zertifikate funktionieren#
[%collapsible]
====

Die Root-CA ist eine vertrauenswürdige Stelle, die in einer Zertifikatskette als Vertrauensanker fungiert:
Sie stellt sich ein selbstsigniertes _Root-Zertifikat_ aus (ein CA-Zertifikat), das die Glaubwürdigkeit und digitale Identität der von ihr abgeleiteten Zertifikate und CAs begründet. 
Am Ende der Zertifikatskette steht das _Leaf-Zertifikat_ als individuelle Einheit.
Es erbt das Vertrauen von den ihm übergeordneten höherrangigen Zertifikatsgliedern der Kette. 
Das Vertrauen wird durch Signiervorgänge mit digitalen Unterschriften weitergegeben und bestätigt.
Zwischen dem Root- und dem Leaf-Zertifikat können ein oder mehrere _Intermediate-Zertifikate_ stehen (bildlich: die Äste am Zertifikat-Baum).
Das oberste Intermediate-Zertifikat wird von der Root-CA signiert, darunter fungieren die Intermediates als untergeordnete CAs. 
Bei {CMK} gibt es keine zwischengeschalteten Intermediates, da sie für die Sicherheitsarchitektur der {CMK}-Software nicht notwendig sind. 

Praktisch können Sie sich den Ablauf wie folgt vorstellen:
Eine CA signiert das von ihr ausgegebene Zertifikat mit ihrem privaten Schlüssel und garantiert damit dessen Echtheit und Gültigkeit.
Die beteiligten Systemkomponenten vertrauen auf eine vordefinierte Liste von CA-Zertifikaten.
Webbrowser zum Beispiel liefern eine Liste von CA-Zertifikaten mit (von einem Konsortium der großen Browserhersteller abgesegnet) und vertrauen damit Webseiten, die von diesen CA-Zertifikaten signierte Intermediate Certificates und wiederum damit signierte Serverschlüssel verwenden.
Zertifikate, die die Identität eines Clients oder einer Person hinter einem Server (oder einer Webdomain) bestätigen, werden Server-Zertifikate genannt – ein Beispiel dafür ist das Server-Zertifikat einer Webseite, das diese dem Browser vorlegt. 
Für Server-Zertifikate wird der Begriff _TLS/SSL-Zertifikate_ oft synonym verwendet.

Vereinfacht gesagt prüft die CA den öffentlichen Schlüssel eines Antragstellers (Mensch, Website oder Softwarekomponente), indem sie dessen Zertifikat auf Echtheit und Gültigkeit prüft. 
ifdef::onprem[]
Fällt das Ergebnis positiv aus, ist die systeminterne Kommunikation freigegeben, beispielsweise zwischen einer Instanz und den ihr zugeordneten xref:glossar#host[Hosts] oder im verteilten Monitoring zwischen den Instanzen.
endif::[]
ifdef::saas[]
Fällt das Ergebnis positiv aus, ist die systeminterne Kommunikation freigegeben, beispielsweise zwischen einer Instanz und den ihr zugeordneten xref:glossar#host[Hosts].
endif::[]

Bei {CMK} geschieht die Absicherung der Agentenkommunikation in einer Form, die über SSL/TLS sogar noch hinausgeht: 
Die Kommunikation zwischen Agent Receiver (in der Instanz) und Agent Controller (auf dem überwachten Host) findet per mTLS statt, asynchron und in Ende-zu-Ende-Verschlüsselung. 
Das "m" in mTLS steht für das gegenseitige (mutual) Bestätigen einer Vertrauensbasis: eine Authentifizierung von Client und Server, die das Standard-TLS-Protokoll erweitert.
Eine Certificate Authority (CA) beantwortet Signierungsanfragen des Agent Controller von Hosts im Monitoring.
So können auch kompromittierte Agenten leicht identifiziert werden.

Die Echtheit jedes Zertifikats lässt sich mittels Fingerprint feststellen:
Aus allen Daten des Zertifikats wird ein Prüfwert berechnet und als hexadezimale Zahl dargestellt.
Dieser "Fingerabdruck" ist die eindeutige digitale Kennung des Zertifikats.
Eingriffe in ein Zertifikat verändern dessen Fingerprint und fallen beim Abgleich mit einer vertrauenswürdigen Stelle auf.
Kommunikation findet erst nach erfolgreicher Prüfung der dafür benötigten Zertifikate statt, und zwar in verschlüsselter Form.
SSL/TLS-Zertifikate zum Beispiel ermöglichen beim Internetprotokoll HTTPS eine sichere Kommunikation zwischen Webbrowser und Website und stellen sicher, dass Daten während der Übertragung weder mitgelesen noch manipuliert werden können.

====

Die in {CMK} vorinstallierten Zertifikate können Sie über die Seite [.guihint]#Certificate overview# einsehen.

[#overview]
== Zertifikatsübersicht in {CMK}
Über [.guihint]#Setup > Maintenance > Certificate overview# öffnen Sie die Seite [.guihint]#Certificate overview#.
Hier finden Sie auf einen Blick alle grundlegenden Zertifikate, die beim Einrichten Ihrer Instanz {CMK}-seitig erstellt und hinterlegt wurden.
Die Seite hat reinen Informationscharakter und dient als interner Schnellzugriff – etwa, um die Gültigkeit und die Fingerprints der vorinstallierten Zertifikate zu überprüfen. 
Beim Verdacht auf Zertifikatsprobleme kann die Übersicht das Troubleshooting beschleunigen.
Dafür ist die Seite [.guihint]#Certificate overview# die erste Anlaufstelle.

.Übersicht der {CMK}-Zertifikate
image::certificate_overview_page.png[alt="Die Seite 'Certificate Overview' in {CMK}.",fullscreen=1]

Die [.guihint]#Certificate overview#-Seite listet Ihnen die Zertifikate der Checkmk-Komponenten mit ihren Metadaten auf: in der Rubrik [.guihint]#Common Name (Subject)# die ausgegebenen Zertifikate und unter [.guihint]#Common Name (Issuer)# deren Herausgeber (Certificate Authority), jeweils mit dem dazugehörigen Erstellungs- und Ablaufdatum.
Für jedes Zertifikat sind neben der Laufzeit der individuelle Fingerprint, der Schlüsseltyp (RSA), die Schlüssellänge in Bits, der Speicherort mit Dateipfad und ein knapper Verwendungszweck ([.guihint]#Purpose#) hinterlegt.
Der vollständige Fingerprint wird beim jeweiligen Fingerprint-Eintrag als Hinweistext (Mouse-Over-Text) eingeblendet, wenn Sie die Maus auf den Eintrag bewegen.
Werfen Sie zur Orientierung ruhig einen Blick in Ihre eigene Instanz, die Schlüssellänge und andere Elemente können vom Beispiel abweichen.

Drei Certificate Authorities (CA) werden beim Erzeugen einer {CMK}-Instanz als vertrauenswürdige Herausgeber von Zertifikaten stets individuell erzeugt, die Seite listet deren CA-Zertifikate auf: je ein CA-Zertifikat zum Signieren des Instanz-Zertifikats, ein CA-Zertifikat für die Agentenschlüssel bei der mTLS-Authentifizierung und ein CA-Zertifikat der Message-Broker-Zertifikate bei RabbitMQ.

Standardmäßig sind bei einer einzelnen Instanz fünf Zertifikate aufgelistet.
Im verteilten Monitoring enthält die Zertifikatsübersicht Ihrer Zentralinstanz für jede angebundene Remote-Instanz einen weiteren Eintrag – denn jede Remote-Instanz erhält ein Remote-Instanz-Zertifikat zum Bestätigen der Echtheit des Schlüssels, der für die Kommunikation zwischen Zentral- und Remote-Site verwendet wird. 
ifdef::saas[]
Dieser Eintrag ist derzeit nur in den On-Premises-Editionen von {CMK} relevant.
endif::[]

[#table]
=== Zertifikate der {CMK}-Komponenten

{CMK} stattet alle Monitoring-Instanzen mit Certificate Authorities (CAs) und Zertifikaten aus, die für den Betrieb und für die Kommunikation zwischen den Komponenten eines {CMK}-Setups unerlässlich sind. 
Die folgende Tabelle schlüsselt auf, welche Funktion jedes dieser Zertifikate erfüllt, an welcher Stelle es in der Zertifikatskette steht und in welche Features und Prozesse der Software es jeweils eingebunden ist.

Weiterführende Informationen finden Sie in der letzten Spalte: "{CMK}-Komponenten" ist hier ein bewusst offen gehaltener Sammelbegriff für verschiedene Bestandteile und Funktionalitäten Ihrer Monitoring-Software.
ifdef::saas[]
Die letzten beiden Einträge sind derzeit nur in den On-Premises-Editionen von {CMK} relevant.
endif::[]

ifdef::onprem[]
[cols="20,24,35,~",options="header"]
|===
| Dateipfad im Ordner `~/etc` 
| Position in Zertifikatskette 
| Funktionsbeschreibung 
| {CMK}-Komponenten 

| `ssl/ca.pem` 
| CA-Zertifikat 
| _Root-Zertifikat_ zum Signieren des Instanz-Zertifikats. Sichert die Instanz ab.
| xref:glossar#livestatus[Livestatus], xref:glossar#agent[Monitoring-Agenten]

| `ssl/sites/mysite.pem` 
| Server-Zertifikat 
| _Instanz-Zertifikat_ zur Absicherung der Kommunikation zwischen Instanz (Agent Receiver) und Host (Agent Controller). 
Es ist ein SSL-Zertifikat und bestätigt die Echtheit des Schlüssels für die Netzwerkkommunikation, wird an mehreren Stellen verwendet. 
| xref:glossar#livestatus[Livestatus] und xref:glossar#agent[Monitoring-Agenten]

| `ssl/agents/ca.pem` 
| CA-Zertifikat  
| _CA-Zertifikat_ zum Signieren der Zertifikate für den Agenten (Agent Controller). 
Sichert mTLS ab – zuständig für die beidseitige (mutual) sichere Authentifizierung von Client und Server, die das Standard-TLS-Protokoll erweitert. 
| xref:glossar#agent[Monitoring-Agenten]

| `rabbitmq/ssl/ca_cert.pem` 
| CA-Zertifikat 
| _CA-Zertifikat_ zum Signieren der individuellen Message-Broker-Zertifikate.
Message Broker werden zur Weiterleitung von xref:piggyback#distributed_piggyback[Piggyback-Daten im verteilten Monitoring] benötigt. 
Als Message Broker verwendet {CMK} die quelloffene Broker-Software RabbitMQ. 
| xref:glossar#piggyback[Piggyback] im xref:glossar#distributed_monitoring[verteilten Monitoring]

| `rabbitmq/ssl/cert.pem` 
| Server-Zertifikat 
| _Server-Zertifikat_ zur Absicherung der Netzwerkkommunikation des lokalen Message Brokers. Es ist ein SSL-Zertifikat.  
| xref:glossar#piggyback[Piggyback] im xref:glossar#distributed_monitoring[verteilten Monitoring]

| `rabbitmq/ssl/multisite_certs/&#8203;myremotesite_cert.pem` 
| Server-Zertifikat 
| _Server-Zertifikat_ des Remote-Message-Brokers – zur Absicherung der Netzwerkkommunikation des Message Brokers der Remote-Instanz `myremotesite`. 
| xref:glossar#piggyback[Piggyback] im xref:glossar#distributed_monitoring[verteilten Monitoring]
|===
endif::[]

ifdef::saas[]
[cols="20,24,35,~",options="header"]
|===
| Dateipfad im Ordner `~/etc` 
| Position in Zertifikatskette 
| Funktionsbeschreibung 
| {CMK}-Komponenten 

| `ssl/ca.pem` 
| CA-Zertifikat 
| _Root-Zertifikat_ zum Signieren des Instanz-Zertifikats. Sichert die Instanz ab.
| xref:xref:glossar#agent[Monitoring-Agenten]

| `ssl/sites/mysite.pem` 
| Server-Zertifikat 
| _Instanz-Zertifikat_ zur Absicherung der Kommunikation zwischen Instanz (Agent Receiver) und Host (Agent Controller). 
Es ist ein SSL-Zertifikat und bestätigt die Echtheit des Schlüssels für die Netzwerkkommunikation, wird an mehreren Stellen verwendet. 
| xref:xref:glossar#agent[Monitoring-Agenten]

| `ssl/agents/ca.pem` 
| CA-Zertifikat  
| _CA-Zertifikat_ zum Signieren der Zertifikate für den Agenten (Agent Controller). 
Sichert mTLS ab – zuständig für die beidseitige (mutual) sichere Authentifizierung von Client und Server, die das Standard-TLS-Protokoll erweitert. 
| xref:glossar#agent[Monitoring-Agenten]

| `rabbitmq/ssl/ca_cert.pem` 
| CA-Zertifikat 
| _CA-Zertifikat_ zum Signieren der individuellen Message-Broker-Zertifikate.
Message Broker werden zur Weiterleitung von xref:piggyback#distributed_piggyback[Piggyback-Daten im verteilten Monitoring] benötigt. 
Als Message Broker verwendet {CMK} die quelloffene Broker-Software RabbitMQ. 
| xref:glossar#piggyback[Piggyback] im xref:glossar#distributed_monitoring[verteilten Monitoring]

| `rabbitmq/ssl/cert.pem` 
| Server-Zertifikat 
| _Server-Zertifikat_ zur Absicherung der Netzwerkkommunikation des lokalen Message Brokers. Es ist ein SSL-Zertifikat.  
| xref:glossar#piggyback[Piggyback] im xref:glossar#distributed_monitoring[verteilten Monitoring]
|===
endif::[]

Die allgemeine Steuerung vertrauenswürdiger Zertifikate für die TLS-verschlüsselte Kommunikation zwischen dem {CMK}-Server und den Agenten auf Ihren überwachten Hosts ist in einem gesonderten Bereich der Benutzeroberfläche zu finden.
Die Einstellungen dafür lassen sich unter [.guihint]#Setup > General > Global Settings > Edit global setting > Trusted certificate authorities for SSL# einsehen und verwalten.
Von der Seite [.guihint]#Certificate overview# aus können Sie diese Einstellung öffnen mit dem Menüeintrag [.guihint]#Related > Trusted certificate authorities for SSL#.

ifdef::onprem[]
[IMPORTANT]
====
Schlüssel und zugehörige Zertifikate für den System-Apache müssen mit Root-Rechten durch den Serveradministrator hinterlegt werden!
====

Die Zertifikate des System-Apache (also des Apache-HTTP-Webservers Ihres Systems) sind zwar wichtig, werden in der Seite [.guihint]#Certificate overview# aber nicht aufgelistet, weil sie nicht Bestandteil der {CMK}-Software sind.
Für diese Zertifikate ist der Serveradministrator verantwortlich, Instanzbenutzer einer {CMK}-Instanz haben in der Regel keine Zugriffsrechte. 
Zertifikate des System-Apache sind relevant etwa für ein Agenten-Update, für die Weboberfläche und für die Nutzung der REST-API. 

Beachten Sie: In einem xref:glossar#central_setup[verteilten Monitoring mit zentralem Setup] läuft die Weitergabe von Einstellungen über die REST-API.
Wenn Sie wissen wollen, wie Sie Ihre xref:omd_https#[Weboberfläche mit HTTPS absichern], können Sie im gleichnamigen Artikel weiterlesen. 
endif::[]
// end translation